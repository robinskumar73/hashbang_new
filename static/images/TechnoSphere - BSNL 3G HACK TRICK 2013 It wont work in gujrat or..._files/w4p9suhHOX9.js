/*!CK:1616262730!*//*1407358611,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["9XbLM"]); }

__d("BlackbirdUpsellConstants",[],function(a,b,c,d,e,f){e.exports={ACTION_EDUCATE:"educate",ACTION_UPSELL:"upsell",CLICK_TYPE_DISMISS_PROMO:"dismiss_promo",CLICK_TYPE_ENABLE_CHAT:"enable_chat",CLICK_TYPE_OPEN_SETTINGS:"open_settings"};},null);
__d("GenderConst",[],function(a,b,c,d,e,f){e.exports={NOT_A_PERSON:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11,UNKNOWN:0};},null);
__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){e.exports={CHAT:"source:chat",EMAIL:"source:email",MESSENGER:"source:messenger",MOBILE:"source:mobile"};},null);
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){e.exports={TODAY:0,WEEK_AGO:1,MONTH_AGO:2,CURRENT_YEAR:3,OTHER_YEAR:4};},null);
__d("BlackbirdUpsell",["Event","Arbiter","AsyncRequest","LegacyContextualDialog","DOM","LayerDestroyOnHide","LayerHideOnTransition","PresencePrivacy","copyProperties","BlackbirdUpsellConfig","BlackbirdUpsellConstants","BlackbirdUpsellTemplates"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s='/ajax/chat/blackbird/update_clicks.php',t='/ajax/chat/blackbird/update_impressions.php',u='/ajax/chat/blackbird/dismiss.php',v=235,w=null,x=null,y=false,z=false;function aa(){}o(aa,{shouldShow:function(){if(this._dialogDismissed)return false;if(this.isEducation()){return !p.EducationDismissed&&p.EducationImpressions<p.EducationImpressionLimit;}else return !!p.UpsellGK&&!p.UpsellDismissed&&p.UpsellImpressions<p.UpsellImpressionLimit&&p.FriendCount>=p.UpsellMinFriendCount;},isEducation:function(){return p.TimeOffline<=p.EducationTimeOfflineThresdhold;},getOfflineContent:function(){if(this.isEducation()){return this._getEducationContent();}else return this._getUpsellContent();},_getEducationContent:function(){ga();var ka=r[':fb:chat:blackbird:offline-educate'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ja(q.CLICK_TYPE_OPEN_SETTINGS);da();});return ka.getRoot();},_getUpsellContent:function(){fa();var ka=r[':fb:chat:blackbird:upsell'].build(),la=ka.getNode('chatSettingsButton');g.listen(la,'click',function(){h.inform('chat/advanced-settings-dialog-opened');ia(q.CLICK_TYPE_OPEN_SETTINGS);ca();});var ma=ka.getNode('enableChatButton');g.listen(ma,'click',function(){ia(q.CLICK_TYPE_ENABLE_CHAT);ca();});return ka.getRoot();},getBlackbirdContent:function(ka){ga();switch(ka){case n.ONLINE:return r[':fb:chat:blackbird:most-friends-educate'].build().getRoot();case n.OFFLINE:return r[':fb:chat:blackbird:some-friends-educate'].build().getRoot();}},showOfflineDialog:function(ka){this.showDialog(ka,this.getOfflineContent.bind(this));},showBlackbirdDialog:function(ka,la){this.showDialog(ka,this.getBlackbirdContent.bind(null,la));},showDialog:function(ka,la){!w&&this._constructDialog();k.setContent(x,la());w.setContext(ka);w.show();},hide:function(){if(w&&w.isShown())w.hide();},dismiss:function(){this.hide();if(this.isEducation()){da();}else ca();},registerDismissClick:function(){if(this.isEducation()){ja(q.CLICK_TYPE_DISMISS_PROMO);}else ia(q.CLICK_TYPE_DISMISS_PROMO);},isVisible:function(){return z&&!y;},_constructDialog:function(){var ka=r[':fb:chat:blackbird:dialog-frame'].build();x=ka.getNode('dialogContent');w=new j();w.init(ka.getRoot());w.setPosition('above').setWidth(v).setFixed(true).disableBehavior(l).disableBehavior(m);g.listen(ka.getNode('dialogCloseButton'),'click',this.dismiss.bind(this));g.listen(ka.getNode('dialogCloseButton'),'click',this.registerDismissClick.bind(this));}});function ba(ka,la){if(!y&&z){y=true;n.inform('privacy-user-presence-changed');var ma=new i(u);ma.setData({source:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){y=false;});ma.send();}}function ca(){ba(q.ACTION_UPSELL,p.UpsellImpressions);}function da(){ba(q.ACTION_EDUCATE,p.EducationImpressions);}function ea(ka,la){if(!z){z=true;var ma=new i(t);ma.setData({action:ka,impressions:la,time_offline:p.TimeOffline});ma.setErrorHandler(function(){z=false;});ma.send();}}function fa(){ea(q.ACTION_UPSELL,p.UpsellImpressions);}function ga(){ea(q.ACTION_EDUCATE,p.EducationImpressions);}function ha(ka,la,ma,na){var oa=new i(s);oa.setData({action:ka,impressions:ma,source:la,time_offline:na});oa.send();}function ia(ka){ha(ka,q.ACTION_UPSELL,p.UpsellImpressions,p.TimeOffline);}function ja(ka){ha(ka,q.ACTION_EDUCATE,p.EducateImpressions,p.TimeOffline);}h.subscribe('chat/advanced-settings-dialog-opened',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-online',aa.dismiss.bind(aa));h.subscribe('chat-visibility/go-offline',aa.dismiss.bind(aa));e.exports=aa;},null);
__d("Chat",["Arbiter"],function(a,b,c,d,e,f,g){var h={buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'};function i(k,l){g.subscribe(h[k],function(event,m){l(m);});}var j={openBuddyList:function(){i('buddyListNub',function(k){k.show();i('sidebar',function(l){l.enable();});});},closeBuddyList:function(){i('buddyListNub',function(k){k.hide();});},toggleSidebar:function(){i('sidebar',function(k){k.toggle();});}};a.Chat=e.exports=j;},3);
__d("ChatOptions",["Arbiter","ChannelConstants","JSLogger","PresenceUtil","copyProperties","ChatOptionsInitialData"],function(a,b,c,d,e,f,g,h,i,j,k){var l=i.create('chat_options'),m={};(function(){var o=b('ChatOptionsInitialData');for(var p in o){var q=o[p];m[p]=!!q;}})();var n=k(new g(),{getSetting:function(o){return m[o];},setSetting:function(o,p,q){if(this.getSetting(o)==p)return;if(q){q='from_'+q;l.log(q,{name:o,new_value:p,old_value:this.getSetting(o)});}m[o]=!!p;g.inform('chat/option-changed',{name:o,value:p});}});g.subscribe(h.getArbiterType('setting'),function(o,p){var q=p.obj;if(q.window_id===j.getSessionID())return;n.setSetting(q.setting,!!q.value,'channel');});g.subscribe(i.DUMP_EVENT,function(o,p){p.chat_options=m;});e.exports=n;},null);
__d("OrderedFriendsList",["AvailableList","ChatConfig","createArrayFrom","ShortProfiles","WorkModeConfig","InitialChatFriendsList"],function(a,b,c,d,e,f,g,h,i,j,k){var l=[],m={},n=[],o={contains:function(p){return p in m;},getList:function(){if(k.is_work_user)return i(l);if(h.get('chat_web_ranking_with_presence'))o.reRank();var p=i(l);p=p.filter(function(q){var r=j.getNowUnsafe(q);return !r||r.type=="friend";});return p;},getRank:function(p){return p in m?m[p]:l.length;},reRank:function(){var p={},q={};n.forEach(function(s,t){var u=s.substr(0,s.length-2),v=s.substring(s.length-1);if(typeof(q.uid)=='undefined'){if(typeof(p.uid)=='undefined')p[u]=g.get(u);var w=p[u];if(w==v)q[t]=u;}});l=[];for(var r in q)l.push(q[r]);l.forEach(function(s,t){m[s]=t;});}};(function(){var p=b('InitialChatFriendsList');l=p.list.length?p.list:[];if(h.get('chat_web_ranking_with_presence')&&!(k.is_work_user)){n=l.slice();o.reRank();}l.forEach(function(q,r){m[q]=r;});})();e.exports=a.OrderedFriendsList||o;},null);
__d("TypingDetector",["ArbiterMixin","Event","Input","Run","TypingStates","copyProperties","createObjectFrom","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(p){this._input=p;this._ignoreKeys={};}l(o.prototype,g,{_timeout:7000,_currentState:k.INACTIVE,init:function(){this.init=n;this.reset();h.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=k.INACTIVE;},setIgnoreKeys:function(p){this._ignoreKeys=m(p);},_onunload:function(){if(this._currentState==k.TYPING)this._transition(k.QUITTING);},_update:function(event){var p=h.getKeyCode(event),q=this._currentState;if(!this._ignoreKeys[p])if(i.getValue(this._input).trim().length===0){if(q==k.TYPING)this._transition(k.INACTIVE);}else if(q==k.TYPING){this._recordKeystroke();}else if(q==k.INACTIVE){this._transition(k.TYPING);this._recordKeystroke();}},_transition:function(p){this.reset();this._currentState=p;this.inform('change',p);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=setTimeout(this._checkTyping.bind(this),this._timeout);},_checkTyping:function(){var p=this._lastKeystrokeTime+this._timeout,q=Date.now();if(q>p){this._transition(k.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=setTimeout(this._checkTyping.bind(this),p-q+10);}}});e.exports=o;},null);
__d("TypingDetectorController",["AsyncRequest","AvailableList","AvailableListConstants","ChannelConnection","ChatVisibility","Keys","PresencePrivacy","ShortProfiles","TypingDetector","TypingStates","copyProperties","emptyFunction","setTimeoutAcrossTransitions","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){function u(w){if(!k.isOnline())return false;if(w){var x=n.getNow(w);return x&&x.type=="friend"&&m.allows(w);}return true;}function v(w,x,y,z,aa){"use strict";this.userID=w;this.input=x;this.source=y;this.threadID=aa;this.remoteState=p.INACTIVE;this.notifyTimer=null;z=z||{};this.notifyDelay=z.notifyDelay||this.notifyDelay;this._typingDetector=new o(x);this._typingDetector.init(z);this._typingDetector.subscribe('change',this._stateChange.bind(this));}v.prototype.setUserAndThread=function(w,x){"use strict";if(this.userID!==w||this.threadID!==x){this.resetState();this.userID=w;this.threadID=x;}};v.prototype.setIgnoreEnter=function(w){"use strict";var x=w?[l.RETURN]:[];this._typingDetector.setIgnoreKeys(x);};v.prototype.resetState=function(){"use strict";this._notifyState(p.INACTIVE);this.remoteState=p.INACTIVE;this._typingDetector.reset();clearTimeout(this.notifyTimer);this.notifyTimer=null;};v.prototype._stateChange=function(w,x){"use strict";if(x!=p.QUITTING){clearTimeout(this.notifyTimer);this.notifyTimer=s(t(this._notifyState,this,x),this.notifyDelay);}else this._notifyState(x,true);};v.prototype._notifyState=function(w,x){"use strict";if(!this.userID&&!this.threadID)return;var y=this.userID,z=u(y);if(z&&w!=this.remoteState){this.remoteState=w;if(j.disconnected())return;var aa={typ:w,to:y,source:this.source,thread:this.threadID};new g().setHandler(this._onTypResponse.bind(this,y)).setErrorHandler(r).setData(aa).setURI('/ajax/messaging/typ.php').setAllowCrossPageTransition(true).setOption('asynchronous',!x).send();}};v.prototype._onTypResponse=function(w,x){"use strict";var y=x.getPayload()||{};if(y.offline)h.set(w,i.OFFLINE,'typing_response');};q(v.prototype,{notifyDelay:1000});e.exports=v;},null);
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","ChatConfig","copyProperties","MercuryConstants","ChatSidebarCalloutData"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryConstants').ChatNotificationConstants,m=b('ChatSidebarCalloutData').isShown,n=h.getWebChatNotification(),o=m,p=true,q=k(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return n!==l.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return o;},showsTabUnreadUI:function(){if(j.get('web_messenger_suppress_tab_unread'))return p;return true;}});function r(){q.inform(q.ON_CHANGED);}h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var s=n,t=h.getWebChatNotification();n=t;if(s!=t)r();});g.subscribe('chat/set_does_page_occlude_tabs',function(s,t){o=!!t;r();});g.subscribe('chat/set_show_tab_unread_ui',function(s,t){p=!!t;r();});e.exports=q;},null);
__d("ChatSidebarSheet",["ArbiterMixin","BlackbirdUpsell","ChannelConnection","ChannelConstants","ChatBehavior","ChatConfig","ChatVisibility","CSS","DOM","Event","JSLogger","PresencePrivacy","copyProperties","mixin","setTimeoutAcrossTransitions","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=q.create('sidebar_sheet');function x(da){switch(da){case j.HINT_AUTH:return "Your session has timed out. Please log in.";case j.HINT_CONN:return v._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});case j.HINT_MAINT:return v._("Facebook {Chat} is currently down for maintenance.",{Chat:"Chat"});default:return v._("Facebook {Chat} is currently unavailable.",{Chat:"Chat"});}}function y(da){var ea;if(da===null||false===navigator.onLine){ea="Unable to connect to chat. Check your Internet connection.";}else if(da>l.get('warning_countdown_threshold_msec')){var fa=o.create('a',{href:'#',className:'fbChatReconnectLink'},"Try again");ea=o.tx._("Unable to connect to chat. {try-again-link}",{'try-again-link':fa});}else if(da>1000){ea=v._("Unable to connect to chat. Reconnecting in {seconds}...",{seconds:Math.floor(da/1000)});}else ea="Unable to connect to chat. Reconnecting...";return ea;}var z=t(g);for(var aa in z)if(z.hasOwnProperty(aa))ca[aa]=z[aa];var ba=z===null?null:z.prototype;ca.prototype=Object.create(ba);ca.prototype.constructor=ca;ca.__superConstructor__=z;function ca(da){"use strict";this._root=da;this._message=o.find(da,'div.fbChatSidebarMessage div.message');i.subscribe([i.CONNECTED,i.SHUTDOWN,i.RECONNECTING],this._handleConnectionChange.bind(this));i.subscribe([i.MUTE_WARNING,i.UNMUTE_WARNING],this._render.bind(this));r.subscribe('privacy-user-presence-changed',this._render.bind(this));k.subscribe(k.ON_CHANGED,this._render.bind(this));this._render();}ca.prototype._handleConnectionChange=function(da,ea){"use strict";this._channelStatus=da;this._channelData=ea;this._render();};ca.prototype._renderChannelDisconnect=function(){"use strict";if(this._channelStatus===i.SHUTDOWN){return o.setContent(this._message,x(this._channelData));}else if(this._channelStatus===i.RECONNECTING){var da=this._channelData;o.setContent(this._message,y(da));if(da>1000){if(da>l.get('warning_countdown_threshold_msec'))this._warningMsgEventListener=p.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),'fbChatReconnectLink')){i.reconnect();return false;}});this._showWarningTimeout=u(this._handleConnectionChange.bind(this,i.RECONNECTING,da-1000),1000);}}};ca.prototype._renderOffline=function(){"use strict";var da='fbChatGoOnlineLink',ea="Turn on chat",fa=o.create('a',{href:'#',className:da},ea),ga=o.tx._("{=Go online} to see who's available.",{'=Go online':fa});o.setContent(this._message,ga);this._goOnlineEventListener=p.listen(this._message,'click',function(event){if(n.hasClass(event.getTarget(),da)){w.log('sidebar_go_online');m.goOnline();return false;}});};ca.prototype._renderBlackbirdUpsell=function(){"use strict";o.setContent(this._message,h.getOfflineContent());};ca.prototype._renderBlackbird=function(da){"use strict";o.setContent(this._message,h.getBlackbirdContent(da));};ca.prototype._clear=function(){"use strict";if(this._showWarningTimeout){clearTimeout(this._showWarningTimeout);this._showWarningTimeout=null;}if(this._warningMsgEventListener){this._warningMsgEventListener.remove();this._warningMsgEventListener=null;}if(this._goOnlineEventListener){this._goOnlineEventListener.remove();this._goOnlineEventListener=null;}n.removeClass(this._root,'upsell');n.removeClass(this._root,'offline');n.removeClass(this._root,'blackbird');n.removeClass(this._root,'error');n.removeClass(this._root,'notice');o.empty(this._message);};ca.prototype._render=function(){"use strict";this._clear();if(h.shouldShow()){if(m.hasBlackbirdEnabled()){var da=m.isOnline()?'blackbird':'upsell';n.addClass(this._root,da);this._renderBlackbird(r.getVisibility());}else if(!m.isOnline()){n.addClass(this._root,'upsell');this._renderBlackbirdUpsell();}}else if(!m.isOnline()){n.addClass(this._root,'offline');this._renderOffline();}else if(i.disconnected()){n.addClass(this._root,'error');this._renderChannelDisconnect();}else if(!k.notifiesUserMessages()){n.addClass(this._root,'notice');var ea="Alerts are off while you use another client to chat.";o.setContent(this._message,ea);}this.inform('updated');};s(ca.prototype,{_channelStatus:null,_channelData:null,_showWarningTimeout:null,_warningMsgEventListener:null,_goOnlineEventListener:null});e.exports=ca;},null);
__d("SidebarFitWindowHeight",["Arbiter","ArbiterMixin","Event","Style","SubscriptionsHandler","TinyViewport","Vector","mixin","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=n(h);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t){"use strict";this.$SidebarFitWindowHeight0=t;this.onViewportUpdate();l.subscribe('change',this.onViewportUpdate.bind(this));}s.prototype.onViewportUpdate=function(){"use strict";if(l.isTiny()){this.onScroll();var t=this.onScroll.bind(this);this.$SidebarFitWindowHeight1=new k();this.$SidebarFitWindowHeight1.addSubscriptions(i.listen(window,'scroll',t),g.subscribe('dom-scroll',t));}else{if(this.$SidebarFitWindowHeight2!==0){j.set(this.$SidebarFitWindowHeight0,'margin-top','0');this.$SidebarFitWindowHeight2=0;}this.$SidebarFitWindowHeight1&&this.$SidebarFitWindowHeight1.release();}};s.prototype.onScroll=function(){"use strict";o(this.updateScrollPosition.bind(this),this.resizeSidebar.bind(this),'SidebarFitWindowHeight/scroll');};s.prototype.updateScrollPosition=function(){"use strict";this.$SidebarFitWindowHeight3=m.getScrollPosition().y;this.$SidebarFitWindowHeight4||(this.$SidebarFitWindowHeight4=this.$SidebarFitWindowHeight0.offsetHeight);};s.prototype.resizeSidebar=function(){"use strict";var t=-Math.max(Math.min(this.$SidebarFitWindowHeight3,this.$SidebarFitWindowHeight4),0);j.set(this.$SidebarFitWindowHeight0,'margin-top',t+'px');if(t!=this.$SidebarFitWindowHeight2){this.$SidebarFitWindowHeight2=t;this.inform('resized',t);}};s.prototype.getOffset=function(){"use strict";return this.$SidebarFitWindowHeight2;};e.exports=s;},null);
__d("ChatSidebar",["Arbiter","ArbiterMixin","AsyncRequest","Banzai","BanzaiLogger","BootloaderConfig","ChatConfig","ChatImpressionLogger","ChatOptions","ChatSidebarSheet","CSS","DOM","DOMDimensions","Event","JSLogger","JSXDOM","KeyEventController","LitestandClassicPlaceHolders","ModalLayer","OrderedFriendsList","Parent","PresencePrivacy","ScrollableArea","ShortProfiles","SidebarFitWindowHeight","Style","ViewportBounds","copyProperties","createArrayFrom","csx","debounce","emptyFunction","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){var na,oa=false,pa=false,qa=false,ra=false,sa=false,ta=false,ua,va,wa,xa,ya,za=null,ab,bb,cb=u.create('chat_sidebar'),db='succeeded',eb=k.create(ha({retry:true},j.VITAL));function fb(){q.removeClass(document.documentElement,'sidebarMode');if(!ra||!ob.isVisible()){g.inform('reflow');return;}qa=false;za=null;wa.hide();xa.getCore().reset();q.hide(ua);cb.rate('sidebar_hide',ra);ob.inform('sidebar/hide',ob);g.inform('sidebar/hide',ob);g.inform('reflow');}function gb(){var pb=ob.shouldShowSidebar();q.conditionClass(document.documentElement,'sidebarCapable',pb);if(ob.isEnabled()&&pb){jb();var qb=ia(ua.childNodes),rb=ib(qb),sb=wa.getItemHeight(),tb=8,ub=Math.floor((rb-tb)/sb);fa.set(na,'height',rb+'px');wa.setNumTopFriends(ub);var vb=Math.floor((rb-tb)/sb);vb=(vb-2)>0?vb-2:0;xa.getData().setMaxResults(vb);ob.inform('sidebar/resized',ob);g.inform('sidebar/resized',ob);g.inform('reflow');}else fb();if(!ra){mb();ra=true;}za=null;}function hb(){if(xa&&ob.isVisible())xa.getCore().getElement().focus();}function ib(pb){if(!pb)pb=ia(ua.childNodes);var qb=ya.height;pb.forEach(function(rb){if(rb&&rb!==na)qb-=s.getElementDimensions(rb).height;});if(ab)qb-=ab.getOffset();return Math.max(0,qb);}function jb(){if(ob.isVisible())return;qa=true;za=null;q.show(ua);q.addClass(document.documentElement,'sidebarMode');wa.show();cb.rate('sidebar_show',ra);ob.inform('sidebar/show',ob);g.inform('sidebar/show',ob);x.destroy('sidebar');}function kb(){o.setSetting('sidebar_mode',ob.isEnabled(),'sidebar');new i('/ajax/chat/settings.php').setHandler(la).setErrorHandler(la).setData({sidebar_mode:ob.isEnabled()}).setAllowCrossPageTransition(true).send();}function lb(){return z.getList().length<=m.get('sidebar.min_friends');}function mb(){var pb=true;if(!ob.isEnabled()){cb.log('state_not_enabled');pb=false;}if(!ob.isViewportCapable()){cb.log('state_not_shown_viewport');pb=false;}if(pa){cb.log('state_not_shown_hidden');pb=false;}if(lb()){cb.log('state_not_shown_num_friends');pb=false;}cb.log(pb?'state_shown':'state_not_shown');}function nb(event,pb){if(!ob.isVisible())return;if(pb){fa.set(ua,'right',pb+'px');}else fa.set(ua,'right','');}var ob={init:function(pb,qb,rb,sb){ob.init=la;sa=true;ua=pb;wa=qb;xa=rb;va=sb;na=r.find(pb,'div.fbChatSidebarBody');t.listen(window,'resize',gb);w.registerKey('q',function(event){if(qa){var wb=null;if(bb){wb=r.scry(bb,'.inputsearch')[0];}else wb=r.scry(pb,'.inputsearch')[0];if(wb){wb.focus();event.prevent();}}});var tb=new p(pb);tb.subscribe('updated',gb);g.subscribe('sidebar/invalidate',gb);qb.setScrollContainer(aa.byClass(qb.getRoot(),'uiScrollableAreaWrap'));qb.subscribe(['render','show','hide'],ka(function(wb){if(wb==='render'&&!ta){ta=true;ob.inform('sidebar/chatRendered',null,g.BEHAVIOR_PERSISTENT);}var xb=qb.getRoot(),yb=ca.getInstance(xb);yb&&yb.adjustGripper();}));g.subscribe('chat/option-changed',function(wb,xb){if(xb.name=="sidebar_mode"){oa=!!o.getSetting('sidebar_mode');gb();}});rb.getCore().subscribe('sidebar/typeahead/active',ob.updateOnActiveTypeahead);rb.subscribe('reset',function(){if(!rb.getCore().getValue()&&!wa.isVisible())ob.updateOnActiveTypeahead(null,false);});g.subscribe('buddylist-nub/initialized',function(wb,xb){t.listen(xb.getButton(),'click',function(event){var yb=pa;pa=false;ob.enable();var zb=ob.shouldShowSidebar();pa=yb&&!zb;return !zb;});});oa=!!o.getSetting('sidebar_mode');ba.subscribe('privacy-user-presence-changed',gb);gb();n.init(wa);ga.addPersistentRight(ob.getVisibleWidth);ob.inform('sidebar/initialized',ob,g.BEHAVIOR_PERSISTENT);g.inform('sidebar/initialized',ob,g.BEHAVIOR_PERSISTENT);if(m.get('sidebar_below_bluebar')){var ub=r.find(pb,"._5qqe");ab=new ea(ub);ab.subscribe('resized',gb);}if(m.get('chat_sidebar_load_log')){var vb={event:db,session_token:sb.session_token,country_code:sb.viewer_country_code,buddylist_short:m.get('buddylist_short_group'),bootloader_retry:l.retry_on_timeout};eb.log('MessagesSidebarLoadLoggerConfig',vb);}y.subscribe('CompensateForScrollbar',nb);},updateOnActiveTypeahead:function(pb,qb){if(!qa)return;if(qb){wa.hide();}else{wa.show();gb();}},isInitialized:function(){return ra;},disable:function(){if(!ob.isEnabled())return;oa=false;kb();fb();},enable:function(){if(ob.isEnabled())return;oa=true;kb();gb();setTimeout(hb,0);},forceEnsureLoaded:function(){if(sa)return;if(ma('pagelet_sidebar'))return;d(['UIPagelet'],function(pb){var qb=v.div({id:"pagelet_sidebar"});r.appendContent(document.body,qb);pb.loadFromEndpoint('SidebarPagelet','pagelet_sidebar');});sa=true;},ensureLoaded:function(){if(!oa)return;ob.forceEnsureLoaded();},hide:function(){if(pa)return;pa=true;fb();},unhide:function(){if(!pa)return;pa=false;gb();},getBody:function(){return na;},getRoot:function(){return ua;},getVisibleWidth:function(){if(!qa||!ua)return 0;if(za===null)za=ua.offsetWidth;return za;},isEnabled:function(){return oa;},isViewportCapable:function(){ya=s.getViewportWithoutScrollbarDimensions();var pb=m.get('sidebar.minimum_width');return ya.width>pb;},shouldShowSidebar:function(){var pb=ob.isViewportCapable();return pb&&!pa&&!lb();},isVisible:function(){return qa;},resize:gb,toggle:function(){ob.isEnabled()?ob.disable():ob.enable();}};ha(ob,h);e.exports=ob;},null);
__d("VideoCallingTour",["Arbiter","ArbiterMixin","Chat","ChatSidebar","ChatVisibility","CSS","DOM","PresencePrivacy","Run","Toggler","Vector","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t,u,v,w=[],x=function(){};function y(){if(j.isVisible()){z();}else if(u)aa();}function z(){s.setContext(t.getBody());ba();s.show();ca();}function aa(){if(!v)v=p.createInstance(u.getRoot());var fa=m.scry(u.getRoot(),'div.fbNubFlyout')[0];if(fa){s.setContext(fa);ba();s.show();ca();}}function ba(){var fa=q.getElementDimensions(s.getContext()).y;s.setOffsetY(fa*.6);s.updatePosition();}function ca(){if(u)w.push(u.subscribe('hide',function(){da();if(!j.isVisible())s.hide();}),u.subscribe('show',function(){s.show();}),u.subscribe('resize',function(){ba();s.updatePosition();}));w.push(g.subscribe('sidebar/show',z),g.subscribe('sidebar/hide',aa),g.subscribe('sidebar/resized',ba));}function da(){if(v){v.setSticky(false);v=null;}}function ea(){while(w.length)w.pop().unsubscribe();if(u)da();s.hide();l.show('fbVideoCallingGetStarted');}r(x,h,{start:function(fa){s=fa;l.hide('fbVideoCallingGetStarted');k.goOnline(function(){w.push(n.subscribe('privacy-user-presence-changed',ea));o.onLeave(ea);i.openBuddyList();var ga=null;w.push(j.subscribe('sidebar/initialized',function(ha,ia){t=ia;clearTimeout(ga);ga=setTimeout(y,0);}),x.subscribe('videocallingtour/end',ea));w.push(g.subscribe('buddylist-nub/initialized',function(ha,ia){u=ia;clearTimeout(ga);ga=setTimeout(y,0);}));});x.inform('videocallingtour/start');}});e.exports=x;},null);
__d("MercuryMessages",["AsyncRequest","BanzaiODS","CurrentUser","KeyedCallbackManager","MercuryActionStatus","MercuryActionTypeConstants","MercuryAssert","MercuryAttachmentType","MercuryGenericConstants","MercuryIDs","MercuryLogMessageType","MercuryMessageClientState","MercuryMessageSourceTags","MercuryPayloadSource","MercurySendLogger","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercuryMessageIDs","MercuryParticipants","PresenceUtil","RangedCallbackManager","ReportState","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","copyProperties","debounceAcrossTransitions","formatDate","invariant","isNode","randomInt","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma){'use strict';function na(fb,gb){var hb=gb;if(fb._localIdsMap[gb])hb=fb._localIdsMap[gb];return fb._messages[hb];}var oa=new j();function pa(fb,gb){if(gb.status===undefined)gb.status=k.UNSENT;gb.timestamp_absolute="Today";gb.message_id=gb.message_id||fb.generateNewClientMessageID(gb.timestamp);var hb=z.getIDForUser(fb._fbid);gb.specific_to_list=gb.specific_to_list||[];if(gb.specific_to_list.length&&gb.specific_to_list.indexOf(hb)===-1)gb.specific_to_list.push(hb);if(!gb.thread_id){if(gb.specific_to_list.length==1){gb.thread_id='user:'+fb._fbid;}else if(gb.specific_to_list.length==2){var ib=gb.specific_to_list[0]==hb?gb.specific_to_list[1]:gb.specific_to_list[0];if(p.tokenize(ib).type=='email'){gb.thread_id=o.PENDING_THREAD_ID;}else gb.thread_id=fb._threads.getThreadIDForParticipant(ib);}gb.thread_id=gb.thread_id||'root:'+gb.message_id;}if(!gb.specific_to_list.length){var jb=fb._serverRequests.tokenizeThreadID(gb.thread_id);if(jb.type=='user')gb.specific_to_list=['fbid:'+jb.value,hb];}}function qa(fb,gb,hb,ib){var jb=bb(hb)?[s.CHAT]:[],kb=Date.now(),lb=ia(new Date(kb),'g:ia'),mb={action_type:gb,thread_id:ib,author:z.getIDForUser(fb._fbid),author_email:null,coordinates:null,timestamp:kb,timestamp_absolute:(new Date(kb)).toLocaleDateString(),timestamp_relative:lb,timestamp_time_passed:x.TODAY,is_unread:false,is_cleared:false,is_forward:false,is_filtered_content:false,is_spoof_warning:false,source:hb,source_tags:jb};return mb;}function ra(fb){switch(fb){case t.UNKNOWN:case t.SERVER_INITIAL_DATA:case t.SERVER_FETCH_THREAD_INFO:case t.SERVER_THREAD_SYNC:return true;}return false;}function sa(fb){return fb&&fb.substr(0,6)==='server';}function ta(fb,gb){if(!fb._threadsToMessages[gb])fb._threadsToMessages[gb]=new ba(function(hb){return na(fb,hb).timestamp;},function(hb,ib){return ib-hb;});return fb._threadsToMessages[gb];}function ua(fb){var gb=[];return JSON.stringify(fb,function(hb,ib){if(typeof ib==='object'&&ib!==null){if(ka(ib))return '<'+ib.nodeName+'>';if(gb.indexOf(ib)!==-1)return 'CIRCULAR';gb.push(ib);}return ib;});}ca.registerCallback('mercury-messages',function(){var fb={},gb={},hb=wa._getInstances();for(var ib in hb){fb[ib]={};for(var jb in hb[ib]._messages){var kb=hb[ib]._messages[jb];if(Object.keys(kb).length===0)continue;var lb=kb.thread_id;fb[ib][lb]=fb[ib][lb]||{};fb[ib][lb][kb.message_id]=JSON.parse(ua(kb));}gb[ib]=ga({},hb[ib]._localIdsMap);}var mb={};mb.local_message_ids=gb;mb.messages=fb;return mb;});function va(fb,gb,hb){gb.forEach(function(ib){var jb=ta(fb,ib);jb.setReachedEndOfArray();fb._threadInformer.reorderedMessages(ib,hb);});}function wa(fb){this._fbid=fb;this._serverRequests=da.getForFBID(this._fbid);this._threadInformer=ea.getForFBID(this._fbid);this._threads=fa.getForFBID(this._fbid);this._failedHistoryFetchThreads={};this._threadsToMessages={};this._titanMessagesCount={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(gb,hb){var ib=(hb.actions||[]).filter(function(kb){var lb=kb.action_type;return (kb.is_forward||kb.thread_id)&&(lb==l.LOG_MESSAGE||lb==l.USER_GENERATED_MESSAGE||lb==l.SEND_MESSAGE||lb==l.CLEAR_CHAT||lb==l.DELETE_THREAD||lb==l.DELETE_MESSAGES);}),jb=ra(hb.payload_source);if(sa(hb.payload_source))ib.forEach(function(kb){if(!kb.is_forward){var lb=this._threads.getThreadMetaNow(kb.thread_id);if(lb)kb.is_cleared=kb.timestamp<lb.chat_clear_time;}}.bind(this));this.handleUpdates(ib,jb,hb.payload_source,hb.from_client);if(hb.end_of_history)va(this,hb.end_of_history,hb.payload_source);}.bind(this));}ga(wa.prototype,{getMessagesFromIDs:function(fb){return (fb||[]).map(na.bind(null,this)).filter(function(gb){return gb;});},hasLoadedNMessages:function(fb,gb){var hb=ta(this,fb);return hb.hasReachedEndOfArray()||hb.getCurrentArraySize()>=gb;},hasLoadedExactlyNMessages:function(fb,gb){var hb=ta(this,fb);return hb.getCurrentArraySize()==gb;},clearMercuryInternalState_DO_NOT_USE:function(){this._failedHistoryFetchThreads={};this._threadsToMessages={};this._titanMessagesCount={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};},getThreadMessagesRange:function(fb,gb,hb,ib,jb,kb){var lb=ta(this,fb),mb=function(sb){ib(xa(this,sb));}.bind(this),nb=lb.executeOrEnqueue(gb,hb,mb),ob=lb.getUnavailableResources(nb),pb=this._failedHistoryFetchThreads[fb];if(ob.length&&!pb){var qb=(this._titanMessagesCount[fb]||0)-(this._localTitanMessagesCount[fb]||0),rb=ob.length+(this._localTitanMessagesCount[fb]||0);this._serverRequests.fetchThreadMessages(fb,qb,rb,jb,kb);}else this._failedHistoryFetchThreads[fb]=false;return nb;},getThreadMessagesSinceTimestamp:function(fb,gb){var hb=ta(this,fb),ib=hb.getElementsUntil(gb);return xa(this,ib);},hasLoadedAllMessages:function(fb){return ta(this,fb).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(fb){var gb=ta(this,fb).getAllResources();return xa(this,gb);},unsubscribe:function(fb,gb){m.isThreadID(gb);var hb=ta(this,gb);hb.unsubscribe(fb);},addAttachmentData:function(fb,gb,hb){var ib=na(this,fb);if(ib){var jb=ib.attachments.indexOf(gb);if(jb!=-1){ib.attachments[jb]=hb;this._threadInformer.updatedMessage(ib.thread_id,ib.message_id,'attach');}}else{if(!this._attachmentData[fb])this._attachmentData[fb]=[];this._attachmentData[fb].push({attach_key:gb,data:hb});}},shouldSortOutOfOrderMessages:function(fb,gb,hb){if(fb==t.CLIENT_CHANNEL_MESSAGE){var ib=this.getThreadMessagesSinceTimestamp(gb,hb);if(ib.length>0){h.bumpEntityKey('chat.web','channel.messages_reordered');return true;}}return false;},handleUpdates:function(fb,gb,hb,ib){var jb,kb={},lb={};for(var mb=0;mb<fb.length;mb++){var nb=fb[mb];if(nb.is_forward||hb==t.SERVER_SEARCH){if(!this._messages[nb.message_id]){this._messages[nb.message_id]=nb;cb(this,nb);}continue;}if(nb.client_state===r.SEND_TO_SERVER){this._messages[nb.message_id]=nb;cb(this,nb);continue;}var ob=nb.action_type;if(hb==t.CLIENT_CHANNEL_MESSAGE&&ob==l.USER_GENERATED_MESSAGE&&nb.threading_id&&this._localIdsMap[nb.threading_id]===nb.threading_id){nb.client_message_id=nb.threading_id;nb.status=k.SUCCESS;nb.action_type=l.SEND_MESSAGE;ob=nb.action_type;}if(ob==l.SEND_MESSAGE){var pb=nb.client_message_id;if(pb&&this._localIdsMap[pb]&&nb.status){var qb=na(this,pb),rb=qb.status;if(qb.status==k.SUCCESS)continue;if(nb.status==k.UNCONFIRMED){if(!lb[nb.thread_id])lb[nb.thread_id]=[];lb[nb.thread_id].push(pb);}else if(!kb[nb.thread_id])kb[nb.thread_id]=[];this.updateLocalMessage(nb,hb);if(typeof rb!==undefined||nb.status==k.FAILED_UNKNOWN_REASON||nb.status==k.UNABLE_TO_CONFIRM||nb.status==k.SUCCESS||nb.status==k.ERROR)this._threadInformer.updatedMessage(nb.thread_id,na(this,pb).message_id,hb);}continue;}else if(ob==l.DELETE_THREAD){ta(this,nb.thread_id).removeAllResources();continue;}else if(ob==l.DELETE_MESSAGES){var sb=nb.message_ids.map(function(zb){return na(this,zb).message_id;}.bind(this));jb=ta(this,nb.thread_id);jb.removeResources(sb);this._threadInformer.reorderedMessages(nb.thread_id,hb);continue;}else if(ob==l.LOG_MESSAGE){if(nb.log_message_type==q.SERVER_ERROR)this._failedHistoryFetchThreads[nb.thread_id]=true;}else if(ob==l.CLEAR_CHAT){var tb=ta(this,nb.thread_id).getAllResources();tb.map(na.bind(null,this)).forEach(function(zb){zb.is_cleared=true;});continue;}var ub=na(this,nb.message_id);if((nb.threading_id&&this._localIdsMap[nb.threading_id])||(ub&&!ub.is_forward))continue;if(!kb[nb.thread_id])kb[nb.thread_id]=[];kb[nb.thread_id].push(nb.message_id);this._messages[nb.message_id]=nb;cb(this,nb);if(nb.threading_id&&nb.threading_id!=nb.message_id)y.addServerID(nb.threading_id,nb.message_id);gb=gb||this.shouldSortOutOfOrderMessages(hb,nb.thread_id,nb.timestamp);if(!gb)this._threadInformer.receivedMessage(nb);}for(var vb in kb){jb=ta(this,vb);var wb=jb.getAllResources(),xb=wb.filter(function(zb){var ac=this._messages[zb];return ac.action_type==l.LOG_MESSAGE&&ac.log_message_type==q.SERVER_ERROR;}.bind(this));jb.removeResources(xb);ya(this,vb,kb[vb]);if(ib)za(this,vb,kb[vb]);if(gb){jb.addResources(kb[vb]);this._threadInformer.reorderedMessages(vb,hb);}else jb.addResourcesWithoutSorting(kb[vb].reverse(),0);this._threadInformer.updatedThread(vb);}var yb=Object.keys(lb);if(yb.length)this._serverRequests.requestMessageConfirmation(lb);},sendMessage:function(fb,gb,hb){var event=u.CLIENT_SEND_ATTEMPTED;if(fb.status===k.RESENDING)event=u.CLIENT_RESEND_ATTEMPTED;var ib=false;if(p.isValid(fb.thread_id))ib=!p.isMultichat(fb.thread_id);setTimeout(function(){u.log(event,fb.message_id,{canonical:ib});},0);gb=gb||Function.prototype;pa(this,fb);this._localIdsMap[fb.message_id]=fb.message_id;if(fb.thread_id=='root:'+fb.message_id)ta(this,fb.thread_id).setReachedEndOfArray();this._serverRequests.sendNewMessage(fb,hb);if(fb.thread_id==o.PENDING_THREAD_ID){this._messages[fb.message_id]=fb;return oa.executeOrEnqueue(fb.message_id,gb);}else gb(fb.thread_id);},isOutbound:function(fb){return fb.author==z.user;},isInbound:function(fb){return !this.isOutbound(fb);},isSending:function(fb){return (fb.status===k.UNSENT||fb.status===k.UNCONFIRMED||fb.status===k.UNABLE_TO_CONFIRM||fb.status===k.RESENDING);},isFirstMessage:function(fb){var gb=ta(this,fb.thread_id);if(gb.getCurrentArraySize()===0)return false;var hb=gb.getResourceAtIndex(gb.getCurrentArraySize()-1),ib=na(this,hb).message_id,jb=na(this,fb.message_id).message_id;return gb.hasReachedEndOfArray()&&ib==jb;},unsubscribeSend:function(fb){oa.unsubscribe(fb);},resendMessage:function(fb,gb){var hb=ga({},fb);hb.status=k.RESENDING;hb.timestamp=Date.now();hb.message_id=fb.message_id;this._messages[fb.message_id]=hb;var ib=ta(this,fb.thread_id);ib.resortResources([fb.message_id]);this.sendMessage(hb,null,gb);this._threadInformer.reorderedMessages(fb.thread_id,t.CLIENT_SEND_MESSAGE);},deleteMessages:function(fb,gb){if(gb.length){var hb=ta(this,fb),ib=hb.getCurrentArraySize()==gb.length&&hb.hasReachedEndOfArray();this._serverRequests.deleteMessages(fb,gb,ib);}},deleteLocalMessage:function(fb){if(this._localTitanMessagesCount[fb])this._localTitanMessagesCount[fb]--;},markMessagesSpam:function(fb,gb){if(gb.length){var hb=ta(this,fb),ib=hb.getCurrentArraySize()==gb.length&&hb.hasReachedEndOfArray();if(ib){this._serverRequests.markThreadSpam(fb);}else this._serverRequests.markMessagesSpam(fb,gb);}},updateLocalMessage:function(fb,gb){var hb=na(this,fb.client_message_id);hb.status=fb.status;if(fb.status===k.SUCCESS||fb.error_data)hb.error_data=fb.error_data;var ib=fb.message_id,jb=fb.client_message_id;if(this._messages[ib])return false;this._localIdsMap[jb]=ib;this._messages[ib]=this._messages[jb];y.addServerID(jb,ib);this._messages[jb]={};var kb=na(this,jb);if(fb.timestamp)kb.timestamp=fb.timestamp;if(fb.attachments&&fb.attachments.length){kb.raw_attachments=null;kb.attachments=fb.attachments;cb(this,kb,ib);}if(fb.log_message_data)kb.log_message_data=fb.log_message_data;if(ab(kb))this._localTitanMessagesCount[kb.thread_id]--;return true;},constructUserGeneratedMessageObject:function(fb,gb,hb,ib,jb){var kb=qa(this,l.USER_GENERATED_MESSAGE,gb,hb);if(typeof fb=='string')fb=fb.replace(/^\s+/,'').replace(/\s+$/,'');kb.body=fb;kb.has_attachment=false;kb.html_body=false;kb.attachments=[];kb.specific_to_list=ib||[];kb.creator_info=jb;return kb;},constructLogMessageObject:function(fb,gb,hb,ib){var jb=qa(this,l.LOG_MESSAGE,fb,gb);jb.log_message_type=hb;jb.log_message_data=ib;return jb;},generateNewClientMessageID:function(fb){var gb=fb+':'+(la(0,4294967295)+1)+'-'+aa.getSessionID();return '<'+gb+'@mail.projektitan.com>';},getNumberLocalMessages:function(fb){return this._localTitanMessagesCount[fb]||0;},_uploadMessages:{},updateNewMessage:function(fb,gb,hb){if(hb.preview_attachments.length>0){fb.has_attachment=true;fb.preview_attachments=hb.preview_attachments;}fb.client_state=r.DO_NOT_SEND_TO_SERVER;fb.status=k.RESENDING;this._uploadMessages[gb]=fb;return fb;},updateMessageAfterUpload:function(fb,gb){var hb=this._uploadMessages[fb];ja(hb);hb.image_ids=gb.image_ids;hb.client_state=r.SEND_TO_SERVER;return hb;},clearUploadedMessage:function(fb){delete this._uploadMessages[fb];}});ga(wa,v,{addAttachmentData:function(fb,gb,hb,ib){ib=ib||i.getID();wa.getForFBID(ib).addAttachmentData(fb,gb,hb);}});function xa(fb,gb){var hb=gb.map(na.bind(null,fb));return hb.reverse();}function ya(fb,gb,hb){var ib=hb.filter(function(jb){return ab(na(fb,jb));});if(!fb._titanMessagesCount[gb])fb._titanMessagesCount[gb]=0;fb._titanMessagesCount[gb]+=ib.length;}function za(fb,gb,hb){var ib=hb.filter(function(jb){return ab(na(fb,jb));});if(!fb._localTitanMessagesCount[gb])fb._localTitanMessagesCount[gb]=0;fb._localTitanMessagesCount[gb]+=ib.length;}function ab(fb){var gb=fb.action_type;if(gb==l.USER_GENERATED_MESSAGE)return true;switch(fb.log_message_type){case q.SUBSCRIBE:case q.UNSUBSCRIBE:case q.SERVER_ERROR:case q.LIVE_LISTEN:return false;default:return true;}}function bb(fb){switch(fb){case w.CHAT_WEB:case w.CHAT_JABBER:case w.CHAT_IPHONE:case w.CHAT_MEEBO:case w.CHAT_ORCA:case w.CHAT_TEST:case w.CHAT:case w.DESKTOP:return true;default:return false;}}function cb(fb,gb,hb){hb=hb||gb.message_id;var ib=fb._attachmentData[hb];if(ib){ib.forEach(function(jb){var kb=gb.attachments.indexOf(jb.attach_key);if(kb!==-1)gb.attachments[kb]=jb.data;});delete fb._attachmentData[hb];}else if(!gb.is_forward&&db(fb,gb)){fb._messagesNeedingAttachmentData[hb]=true;eb(fb);}}function db(fb,gb){if(!gb||!gb.attachments)return false;for(var hb=0;hb<gb.attachments.length;hb++){var ib=gb.attachments[hb];if(typeof ib==='string'&&ib.indexOf(n.SHARE)===0)return true;}var jb=gb.forward_message_ids||[];for(hb=0;hb<jb.length;hb++){var kb=na(fb,jb[hb]);if(db(fb,kb))return true;}return false;}var eb=ha(function(fb){var gb={};for(var hb in fb._messagesNeedingAttachmentData){var ib=na(fb,hb);if(db(fb,ib))gb[hb]=true;}var jb=Object.keys(gb);if(jb.length){var kb={message_ids:jb};if(fb._fbid!=i.getID())kb.request_user_id=fb._fbid;new g('/ajax/mercury/attachments/fetch_shares.php').setData(kb).setAllowCrossPageTransition(true).send();}fb._messagesNeedingAttachmentData={};},0,this);e.exports=wa;},null);
__d("MercuryTimestampTracker",["MercuryActionTypeConstants","MercuryPayloadSource","MercurySingletonMixin","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m){this._fbid=m;this._serverRequests=j.getForFBID(this._fbid);this._lastTimestamp=0;this._serverRequests.subscribe('update-messages',function(n,o){if(!o.actions||!o.actions.length)return;if(o.payload_source==h.CLIENT_SEND_MESSAGE||o.payload_source==h.UNKNOWN)return;for(var p=0;p<o.actions.length;p++){var q=o.actions[p],r=q.action_type;if(r==g.USER_GENERATED_MESSAGE&&q.thread_id&&q.timestamp>this._lastTimestamp)this._lastTimestamp=q.timestamp;}}.bind(this));}k(l.prototype,{getLastUserMessageTimestamp:function(){return this._lastTimestamp;}});k(l,i);e.exports=l;},null);
__d("ChatTabModel",["Arbiter","ArbiterMixin","ChatBehavior","ChatConfig","JSLogger","MercuryAssert","PresenceInitialData","PresenceState","PresenceUtil","areJSONRepresentationsEqual","arrayContains","copyProperties","MercuryServerRequests","MercuryMessages","MercuryThreads","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=b('MercuryServerRequests').get(),t=b('MercuryMessages').get(),u=b('MercuryThreads').get(),v=b('MercuryTimestampTracker').get(),w=[],x=null,y=null,z=null,aa=null;function ba(){return parseInt(m.serverTime,10);}var ca=j.get('tab_max_load_age')||3600000,da=ba()-ca,ea=0,fa=20,ga=k.create('chat_tab_model'),ha=false;function ia(bb){var cb=n.verifyNumber(bb.uct2);if(!cb||typeof cb!=='number'){ga.warn('bad_cookie_version',bb.uct2);return null;}if(cb<ea||cb<da)return null;return cb;}function ja(bb){var cb=ia(bb);if(!cb){var db={};db.old_tabs=bb&&bb.t2&&JSON.stringify(bb.t2);db.old_promoted=bb&&bb.lm2;db.old_time=bb&&bb.uct2;db.old_reason=bb&&bb.tr;db.old_window=bb&&bb.tw;var eb;if(y&&bb.t2)for(var fb=0;fb<bb.t2.length;fb++){var gb=bb.t2[fb];if(gb.i===y)eb=gb.r;}var hb=[];w.forEach(function(ib){if(!ib.fragile){var jb={i:ib.id,si:ib.server_id};if(ib.raised||(ib.id===y&&eb))jb.r=1;hb.push(jb);}});bb.t2=hb;bb.uct2=ea;bb.lm2=x;bb.tr=aa;bb.tw=o.getSessionID();db.new_tabs=JSON.stringify(bb.t2);db.new_promoted=bb.lm2;db.new_time=bb.uct2;db.new_reason=bb.tr;db.new_window=bb.tw;ga.debug('store',db);}else ga.warn('store_bad_state',bb);return bb;}function ka(bb){if(bb){var cb=ia(bb);if(cb&&cb!==ea){var db={};db.old_tabs=JSON.stringify(w);db.old_promoted=x;db.old_time=ea;db.old_reason=aa;db.window_id=o.getSessionID();db.cookie_tabs=bb&&bb.t2&&JSON.stringify(bb.t2);db.cookie_promoted=bb&&bb.lm2;db.cookie_time=bb&&bb.uct2;db.cookie_reason=bb&&bb.tr;db.cookie_window=bb&&bb.tw;ea=cb;aa='load';var eb=la(bb.t2,bb.lm2||null);db.load_result=eb;db.new_tabs=JSON.stringify(w);db.new_promoted=x;db.new_time=ea;db.new_reason=aa;var event='load';if(!ha)event+='_init';ga.log(event,db);return eb;}}else ga.warn('load_bad_state',bb);return false;}function la(bb,cb){if(ma(bb,cb)){var db=w.filter(function(gb){return gb.fragile;}),eb={};x=null;w=bb.map(function(gb){var hb={id:gb.i,server_id:gb.si};if(hb.id==cb)x=hb.id;if(y==gb.i){var ib=ra(y);if(ib!=-1){hb.raised=w[ib].raised;return hb;}else return null;}if(gb.r)hb.raised=true;eb[hb.id]=hb;return hb;});w=w.filter(function(gb){return gb!=null;});if(z)for(var fb in z)if(!eb[fb]||!eb[fb].raised)delete z[fb];db=db.filter(function(gb){return !eb[gb.id];});w=w.concat(db);qa();return true;}return false;}function ma(bb,cb){if(cb!=x)return true;var db=w.filter(function(gb){return !gb.fragile;});if(bb.length!=db.length)return true;for(var eb=0,fb=bb.length;eb<fb;eb++){if(bb[eb].id===y)continue;if(!p(bb[eb],db[eb]))return true;}return false;}function na(bb,cb,db){var eb=ka(n.get());if(cb===undefined||cb>ea){if(bb()){eb=true;aa=db||null;pa(cb);}}else ga.error('rejected',{change_time:cb,state_time:ea});eb&&oa();}function oa(){if(ha)za.inform('chat/tabs-changed',za.get());}function pa(bb){if(bb===undefined)bb=Math.max(v.getLastUserMessageTimestamp()||1,ea+1);ea=bb;n.doSync();}function qa(bb){var cb=w.length-fa;if(cb>0)w=w.filter(function(db){return db.raised||db.id==bb||cb--<=0;});if(cb>0)w=w.filter(function(db){return db.id==x||db.id==bb||cb--<=0;});}function ra(bb){for(var cb=0;cb<w.length;cb++)if(w[cb].id==bb)return cb;return -1;}function sa(bb,cb){var db=u.getThreadMetaNow(bb);if(!db)return false;if(db.is_canonical_user){return va(bb,cb);}else{var eb=ta(bb);if(eb)s.getServerThreadID(bb,function(fb){if(xa(bb,fb)){pa();oa();}});return eb;}}function ta(bb){if(ra(bb)===-1){w.push({id:bb,fragile:true});ga.log('open_fragile_tab',{tabs:JSON.stringify(w),opened:bb,window_id:o.getSessionID()});return true;}return false;}function ua(bb){var cb=[];bb.forEach(function(db){var eb=ra(db);if(eb!==-1)cb.push(w[eb]);});w.forEach(function(db){if(!q(bb,db.id))cb.push(db);});na(function(){if(ma(cb,x)){w=cb;return true;}return false;});}function va(bb,cb){var db=ra(bb);if(db!=-1)if(w[db].fragile){w.splice(db,1);}else{cb&&(w[db].signatureID=cb);return true;}for(var eb=0;eb<=w.length;eb++)if(eb==w.length||w[eb].fragile){w.splice(eb,0,{id:bb,signatureID:cb});qa(bb);ga.log('open_tab',{tabs:JSON.stringify(w),opened:bb,window_id:o.getSessionID()});return true;}}function wa(bb){var cb=ra(bb);if(cb!=-1&&(!w[cb].raised||x!==bb)){w[cb].raised=true;x=bb;return true;}return false;}function xa(bb,cb){var db=ra(bb);if(db!=-1&&w[db].fragile){var eb=w[db];eb.fragile=false;eb.server_id=cb;var fb=[];w.forEach(function(gb){if(gb.id!=bb){if(eb&&gb.fragile){fb.push(eb);eb=null;}fb.push(gb);}});if(eb)fb.push(eb);w=fb;ga.log('make_permanent',{tabs:JSON.stringify(w),tab_id:bb,window_id:o.getSessionID()});return true;}return false;}function ya(bb){var cb=ra(bb);if(bb==x)x=null;if(cb!=-1){w.splice(cb,1);ga.log('close_tab',{tabs:JSON.stringify(w),closed:bb,window_id:o.getSessionID()});return true;}return false;}n.registerStateStorer(ja);n.registerStateLoader(function(bb){if(ka(bb))oa();});function za(){}r(za,h,{isTabPromoted:function(bb){if(bb)return bb==x;return false;},indexOf:function(bb){return ra(bb);},getTab:function(bb){l.isThreadID(bb);var cb=this.indexOf(bb);if(cb>-1){var db=w[cb];return r({},db);}return null;},getEmptyTab:function(){var bb;for(var cb=0;cb<w.length;cb++){bb=w[cb].id;if(u.isNewEmptyLocalThread(bb))return bb;}bb='root:'+t.generateNewClientMessageID(Date.now());u.createNewLocalThread(bb,[]);return bb;},getServerTime:function(){return ba();},changeShowingTabs:function(bb){return ua(bb);},closeAllTabs:function(){if(w.length){ga.log('close_all_tabs',{closed_tabs:JSON.stringify(w),window_id:o.getSessionID()});w=[];x=null;if(z)z={};pa();oa();}},closeFragileTabs:function(){var bb=[];for(var cb=0;cb<w.length;cb++)if(w[cb].fragile&&!u.isNewEmptyLocalThread(w[cb].id)){bb.push(w[cb]);w.splice(cb);oa();break;}ga.log('close_fragile_tabs',{tabs:JSON.stringify(w),fragile_closed:bb,window_id:o.getSessionID()});},closeTab:function(bb,cb){l.isThreadID(bb);var db=false;if(z){delete z[bb];db=true;}na(function(){if(ya(bb))db=true;return db;},undefined,cb);},raiseTab:function(bb,cb,db){l.isThreadID(bb);var eb=false;if(z&&cb){z[bb]=true;eb=true;}if(!cb&&bb===y){eb&&oa();return;}na(function(){if(sa(bb,db))eb=true;var fb=ra(bb);if(fb!=-1&&!w[fb].raised){w[fb].raised=true;eb=true;ga.log('raise_tab',{tabs:JSON.stringify(w),raised:bb,window_id:o.getSessionID()});}return eb;});},get:function(){var bb=w.map(function(cb){var db=r({},cb);delete db.fragile;if(z)db.raised=z[db.id];return db;});return {tabs:bb,promoted:x};},openFragileTab:function(bb){l.isThreadID(bb);if(ta(bb))oa();},openTab:function(bb){l.isThreadID(bb);na(sa.bind(null,bb));},lowerTab:function(bb){l.isThreadID(bb);var cb=false;if(z){delete z[bb];cb=true;}na(function(){var db=ra(bb);if(db!=-1&&w[db].raised){delete w[db].raised;ga.log('lower_tab',{tabs:JSON.stringify(w),lowered:bb,window_id:o.getSessionID()});cb=true;}return cb;});},raiseAndPromoteTab:function(bb,cb,db,eb,fb){l.isThreadID(bb);var gb=false;if(z&&cb){z[bb]=true;gb=true;}if(!cb&&bb===y){gb&&oa();return;}na(function(){if(sa(bb,db))gb=true;if(wa(bb)){gb=true;ga.log('raise_and_promote_tab',{tabs:JSON.stringify(w),promoted:bb,window_id:o.getSessionID()});}return gb;},eb,fb);},setPromotedTab:function(bb){l.isThreadID(bb);na(wa.bind(null,bb));},promoteThreadInPlaceOfThread:function(bb,cb,db,eb){l.isThreadID(bb);l.isThreadID(cb);na(function(){var fb=ra(bb),gb=ra(cb);if(eb){x=bb;}else if(x===cb)return true;var hb=w[fb];if(db){l.isThreadID(db);var ib=ra(db),jb=w[gb];w[gb]=hb;w.splice(fb,1);w.splice(ib,0,jb);}else{w[fb]=w[gb];w[gb]=hb;}return true;});},squelchTab:function(bb){l.isThreadID(bb);y=bb;this.lowerTab(bb);ga.log('squelch_tab',{squelched:bb,tabs:JSON.stringify(w),window_id:o.getSessionID()});},clearSquelchedTab:function(){if(y)ga.log('unsquelch_tab',{squelched:y,tabs:JSON.stringify(w),window_id:o.getSessionID()});y=null;},persistLocalRaised:function(){if(z){na(function(){var bb=false;w.forEach(function(cb){if(cb.raised!=z[cb.id]){bb=true;if(z[cb.id]){cb.raised=true;}else delete cb.raised;}});return bb;});ga.log('persist_local_raise',{tabs:JSON.stringify(w),window_id:o.getSessionID()});}}});g.subscribe(k.DUMP_EVENT,function(bb,cb){cb.chat_tabs={promoted:x,tabs:w.map(function(db){return r({},db);}),time:ea,max_load_age:ca};});function ab(){var bb=i.ignoresRemoteTabRaise();if(bb&&!z){ga.log('start_ignore_remote_raise');z={};oa();}else if(!bb&&z){ga.log('stop_ignore_remote_raise');z=null;oa();}}i.subscribe(i.ON_CHANGED,ab);ab();ka(n.getInitial(),true);if(ea===0)ea=ba()-600000;ha=true;e.exports=za;},null);
__d("ChatTabPresence",["AvailableList","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f,g,h){var i=b('MercuryThreads').get(),j={};function k(l){var m=i.getCanonicalUserInThread(l);if(m)g.updateForID(m);}h.subscribe('chat/tabs-changed',function(event,l){l.tabs.forEach(function(m){if(m.raised&&!j[m.id])k(m.id);});j={};l.tabs.forEach(function(m){if(m.raised)j[m.id]=true;});});e.exports={};},null);
__d("ChatActivity",["Event","Arbiter","AvailableList","AvailableListConstants","JSLogger","MercuryConfig","PresenceState","UserActivity","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=l.activity_limit||60000,q=l.idle_limit||1800000,r=l.idle_poll_interval||300000,s=k.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&(aa-t<p));}var x=o(new h(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);m.doSync();}x.inform('activity');}i.subscribe(j.ON_AVAILABILITY_CHANGED,function(){if(!i.isUserIdle())u=Date.now();});g.listen(window,'focus',function(){v=true;y();});g.listen(window,'blur',function(){v=false;});n.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&m.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(m.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);m.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});h.subscribe(k.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});e.exports=x;},null);
__d("ChatMentionsNotifications",["fbt","CurrentUser","MercuryParticipants"],function(a,b,c,d,e,f,g,h,i){var j={notifyIfMessageToMe:function(k){var l='fbid:'+h.getID(),m=k.body;i.get(l,function(n){var o=new RegExp(n.short_name,"i");if(o.test(m))j._notify(k);});},_notify:function(k){var l=48,m=k.body;if(m.length>l)m=m.substr(0,l-3)+"...";new Notification("\"You were tagged in a message!\"",{body:m,icon:"http://facebook.com//images/icons-large/fb-xl.png"});}};e.exports=j;},null);
__d("VideoCallSupport",["MercuryConfig","UserAgent"],function(a,b,c,d,e,f,g,h){var i={newVCIsSupported:function(){return g.NewVCGK&&(h.chrome()>=24||h.firefox()>=22);}};e.exports=i;},null);
__d("VideoCallRecordMessageDialog",["AsyncDialog","AsyncRequest","Dialog","URI","tx"],function(a,b,c,d,e,f,g,h,i,j,k){var l={get:function(m,n){var o="Would you like to leave a message?",p="New Message";return new i().setTitle(k._("{firstname} is Unavailable",{firstname:n})).setBody(o).setButtons([{name:'record-message',label:p},i.CANCEL]).setHandler(function(){var q=j('/ajax/messaging/composer.php').setQueryData({ids:[m],autoloadvideo:true}).toString();g.send(new h(q));});}};e.exports=l;},null);
__d("VideoCallCore",["Event","ActiveXSupport","Arbiter","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","ChannelConstants","Cookie","CSS","Dialog","MercuryConfig","UserAgent","VideoCallSupport","emptyFunction","ge","VideoCallTemplates","ShortProfiles","VideoCallRecordMessageDialog"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){b('VideoCallTemplates');var w=[],x=[],y={isSupported:function(){if(t.newVCIsSupported())return true;if(s.windows()){if(s.ie()>=9&&!s.ie64()){return h.isSupported();}else return (s.ie()>=7&&!s.ie64())||s.firefox()>=3.6||s.chrome()>=5||s.opera()>=12;}else if(s.osx()>10.5)return (s.firefox()>=3.6||s.chrome()>=5||s.webkit()>=500||s.opera()>=12);return false;},isInstalled:function(){var ca=false;if(this.isSupported())if(z()){var da=null;try{da=new ActiveXObject('SkypeLimited.SkypeWebPlugin');ca=!!da;}catch(ea){}da=null;}else ca=aa();return ca;},mightReloadPostInstall:function(){return s.windows();},onVideoMessage:function(ca){w.push(ca);m.loadModules(["VideoCallController"],u);},onRTCMessage:function(ca){if(t.newVCIsSupported()){x.push(ca);m.loadModules(["FBRTCOfferHandler"],u);}},setMessageHandler:function(ca){this.onVideoMessage=ca;if(ca)while(w.length)ca(w.shift());},setRTCMessageHandler:function(ca){this.onRTCMessage=ca;if(ca)while(x.length)ca(x.shift());},availableForCall:function(ca){var da=k.get(ca);return da==l.ACTIVE||da==l.IDLE;},onProfileButtonClick:function(ca){y.startCallOrLeaveMessage(ca,'profile_button_click');},attachListenerToProfileButton:function(ca){var da=v('videoCallProfileButton');if(da){if(!y.isSupported()){p.hide(da);return;}g.listen(da,'click',function(event){y.startCallOrLeaveMessage(ca,'profile_button_click_timeline');});}},startCallOrLeaveMessage:function(ca,da){if(this.availableForCall(ca)){y.showOutgoingCallDialog(ca,da);}else b('ShortProfiles').get(ca,function(ea){b('VideoCallRecordMessageDialog').get(ca,ea.firstName).show();});},showOutgoingCallDialog:function(ca,da){var ea=da||'unknown';y.logClick(ca,ea);var fa=y.isInstalled()||r.NewVCGK?'outgoing_dialog.php':'intro.php',ga='/ajax/chat/video/'+fa+'?idTarget='+ca;new q().setAllowCrossPageTransition(true).setAsync(new j(ga).setHandler(u).setServerDialogCancelHandler(u)).show();},logClick:function(ca,da){new j().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:ca,clickSource:da}).setAllowCrossPageTransition(true).setErrorHandler(u).send();}};function z(){return s.ie()&&s.windows()&&!s.opera();}function aa(){if(!navigator)return null;navigator.plugins.refresh(false);var ca=navigator.mimeTypes['application/skypesdk-plugin'];return ca&&ca.enabledPlugin;}function ba(){if(!y.mightReloadPostInstall())return;var ca=o.get('vcpwn');if(ca){o.clear('vcpwn');var da=o.get('vctid');if(da){o.clear('vctid');if(o.get('vctid'))return;if(da&&y.isInstalled()){var ea='/ajax/chat/video/outgoing_dialog.php?idTarget='+da;new q().setAllowCrossPageTransition(true).setAsync(new j(ea)).show();}}}}i.subscribe(n.getArbiterType('video'),function(ca,da){y.onVideoMessage(da.obj);});i.subscribe(n.getArbiterType('webrtc'),function(ca,da){y.onRTCMessage(da.obj);});i.subscribe(n.getArbiterType('chat_event'),function(ca,da){if(da.obj.event_name=="missed-call")m.loadModules(["VideoCallController"],function(ea){ea.onMissedCallEvent(da.obj);});});ba();e.exports=y;},null);
__d("VideoCallPromo",["ArbiterMixin","AsyncRequest","ChatConfig","ChatVisibility","LegacyContextualDialog","CSS","MercuryParticipants","ChatTabTemplates","VideoCallCore","copyProperties","emptyFunction","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=b('MercuryThreads').get();function s(){this._dialog=null;}function t(v){if(!(o.isSupported()&&i.get('video.show_promo')))return false;var w=r.getCanonicalUserInThread(v);if(!w)return false;return j.isOnline()&&o.availableForCall(w);}function u(v){new h().setURI('/ajax/chat/video/log_promo.php').setData({viewedUserID:v}).setAllowCrossPageTransition(true).setErrorHandler(q).send();}p(s.prototype,g);p(s.prototype,{render:function(v,w){var x=t(w);if(!x)return;var y=r.getCanonicalUserInThread(w);m.get('fbid:'+y,function(z){if(!z.call_promo)return;var aa=n[':fb:mercury:call:promo'].build();this._dialog=new k();this._dialog.init(aa.getRoot()).setWidth(250).setAlignH('center').setContext(v).show();l.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');l.addClass(v,'video_call_promo');u(r.getCanonicalUserInThread(w));this.inform('chat/dialog-rendered',{dialog:this,thread_id:w});}.bind(this));},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=s;},null);
__d("VideoCallTourDialog",["ArbiterMixin","LegacyContextualDialog","CSS","ChatTabTemplates","VideoCallCore","VideoCallingTour","copyProperties","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b('MercuryThreads').get();function o(){this._dialog=null;}m(o.prototype,g);m(o.prototype,{render:function(p,q){var r=n.getCanonicalUserInThread(q);if(!r||!k.availableForCall(r))return;var s=j[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();i.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');i.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});l.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;},null);
__d("ChatContextualDialogController",["Event","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallPromo","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=60000,p=false,q=false,r=function(y,z){this._videoCallPromo=new k();this._videoCallTour=new l();this._threadID=y;this._tabMainElement=z;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function s(y,event,z){if(y._openDialog)y._openDialog.updatePosition();}function t(y){if(y._openDialog)y._openDialog.updatePosition();}function u(y){if(y._openDialog){y._openDialog.hide();y._openDialog=null;}if(y._timeout){clearTimeout(y._timeout);y._timeout=null;}while(y._subscriptionTokens.length)y._subscriptionTokens.pop().unsubscribe();if(y._scrollListener){y._scrollListener.remove();y._scrollListener=null;}}function v(y,event,z){if(z.thread_id===y._threadID){y._openDialog=z.dialog;p=true;x(y);y._timeout=n(y.destroy.bind(y,y._threadID),o);y._scrollListener=g.listen(window,'scroll',t.bind(null,y));}}function w(y,z){if(!y._openDialog){y._subscriptionTokens.push(z.subscribe('chat/dialog-rendered',v.bind(null,y)));z.render(y._tabMainElement,y._threadID);}}function x(y){y._subscriptionTokens.push(i.subscribe('chat/tabs-changed',s.bind(null,y)),r.subscribe('dialog/close-all',u.bind(null,y)));}m(r,h);m(r.prototype,{destroy:function(){u(this);},tabFocused:function(){if(q){w(this,this._videoCallTour);return;}if(!p)w(this,this._videoCallPromo);},tabNotActive:function(){u(this);},hideVideoCallouts:function(){u(this);}});j.subscribe('videocallingtour/start',function(){q=true;r.inform('dialog/close-all');});j.subscribe('videocallingtour/end',function(){q=false;});e.exports=r;},null);
__d("ChatFileUploaderMixin",["SubscriptionsHandler","React"],function(a,b,c,d,e,f,g,h){var i={propTypes:{attachmentsShelf:h.PropTypes.object,onFileUploaderMounted:h.PropTypes.func,onUploadFinished:h.PropTypes.func,onUpdateAttachmentsShelf:h.PropTypes.func,onSubmit:h.PropTypes.func},setUpSubscriptionsHandler:function(j){this._uploader=j;this._subscriptions=new g();this._subscriptions.addSubscriptions(this._uploader.subscribe(['all-uploads-completed','upload-canceled'],this._handleUploadFinished),this._uploader.subscribe('dom-updated',this._handleUpdateAttachmentsShelf),this._uploader.subscribe('submit',this._handleSubmit));this.props.onFileUploaderMounted(this._uploader);},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();},isUploading:function(){return this._uploader.isUploading();},getAttachments:function(){return this._uploader.getAttachments();},getImageFiles:function(){return this._uploader.getImageFiles();},getVideoFiles:function(){return this._uploader.getVideoFiles();},removeAttachments:function(){return this._uploader.removeAttachments();},_handleUploadFinished:function(){if(this.props.onUploadFinished)this.props.onUploadFinished();},_handleUpdateAttachmentsShelf:function(){if(this.props.onUpdateAttachmentsShelf)this.props.onUpdateAttachmentsShelf();},_handleSubmit:function(){if(this.props.onSubmit)this.props.onSubmit();}};e.exports=i;},null);
__d("PhotosUploadID",[],function(a,b,c,d,e,f){var g=1024,h={getNewID:function(){return (g++).toString();}};e.exports=h;},null);
__d("ChatFileUploader.react",["ChatFileUploaderMixin","InlineBlock.react","MercuryConfig","MercuryFileUploader","React","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){'use strict';var n=k.createClass({displayName:'ChatFileUploader',mixins:[g],shouldComponentUpdate:function(){return false;},componentDidMount:function(){var o=new j(this.props.attachmentsShelf,this.refs.form.getDOMNode(),this.refs.input.getDOMNode(),this.refs.attachID.getDOMNode());this.setUpSubscriptionsHandler(o);},render:function(){return (k.createDescriptor(k.DOM.form,{ref:"form",action:i.upload_url,method:"post"},k.createDescriptor(k.DOM.input,{type:"hidden",ref:"attachID",name:"attach_id"}),k.createDescriptor(h,{className:"_m _4q60 itemLabel"},k.createDescriptor(k.DOM.input,{type:"file",className:"_n",name:"attachment[]",multiple:"true",ref:"input"}),k.createDescriptor(k.DOM.span,{className:"_4q61 itemAnchor"},"Add Files..."))));}});e.exports=n;},null);
__d("ChatPhotoEditorContextualDialog",["ContextualDialog","CSS","Event","LayerHideOnBlur","PhotoEditorConfig","URI"],function(a,b,c,d,e,f,g,h,i,j,k,l){function m(n,o,p,q,r){"use strict";var s=l(k.Constants.CHAT_DIALOG_PATH).addQueryData({thread_id:r}).toString();p.setAttribute('ajaxify',s);this.$ChatPhotoEditorContextualDialog0=n;this.$ChatPhotoEditorContextualDialog1=q;i.listen(n,'click',this.$ChatPhotoEditorContextualDialog2.bind(this));i.listen(q,'click',this.$ChatPhotoEditorContextualDialog3.bind(this));}m.prototype.$ChatPhotoEditorContextualDialog2=function(){"use strict";var n=this.$ChatPhotoEditorContextualDialog4();if(n.isShown()){n.hide();}else n.show();};m.prototype.$ChatPhotoEditorContextualDialog3=function(){"use strict";this.$ChatPhotoEditorContextualDialog4().hide();};m.prototype.$ChatPhotoEditorContextualDialog4=function(){"use strict";if(!this.$ChatPhotoEditorContextualDialog5){var n={context:this.$ChatPhotoEditorContextualDialog0,width:115,alignment:'center',addedBehaviors:[j]};this.$ChatPhotoEditorContextualDialog5=new g(n,this.$ChatPhotoEditorContextualDialog1);h.show(this.$ChatPhotoEditorContextualDialog1);}return this.$ChatPhotoEditorContextualDialog5;};e.exports=m;},null);
__d("Emscripten",[],function(a,b,c,d,e,f){e.exports={isSupported:function(){return (typeof Int32Array!=='undefined'&&typeof Float64Array!=='undefined'&&!!new Int32Array(1).subarray&&!!new Int32Array(1).set);}};},null);
__d("XHRHttpError",[],function(a,b,c,d,e,f){var g='HTTP_CLIENT_ERROR',h='HTTP_PROXY_ERROR',i='HTTP_SERVER_ERROR',j='HTTP_TRANSPORT_ERROR',k='HTTP_UNKNOWN_ERROR';function l(m,n){if(n===0){var o=m.getProtocol();if(o==='file'||o==='ftp')return null;return j;}else if(n>=100&&n<200){return h;}else if(n>=200&&n<300){return null;}else if(n>=400&&n<500){return g;}else if(n>=500&&n<600){return i;}else if(n>=12001&&n<12156){return j;}else return k;}e.exports={getErrorCode:l,HTTP_CLIENT_ERROR:g,HTTP_PROXY_ERROR:h,HTTP_SERVER_ERROR:i,HTTP_TRANSPORT_ERROR:j,HTTP_UNKNOWN_ERROR:k};},null);
__d("XHRRequest",["ErrorUtils","URI","XHRHttpError","getSameOriginTransport","invariant","xhrSimpleDataSerializer"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={errorCode:null,errorMsg:null,errorType:null},n={loadedBytes:null,totalBytes:null};function o(p){"use strict";this.setURI(p);this.setMethod('POST');this.setIsAsynchronous(true);this.setTransportBuilder(j);this.setDataSerializer(l);this.$XHRRequest0=this.$XHRRequest0.bind(this);}o.prototype.setURI=function(p){"use strict";this.$XHRRequest1=new h(p);return this;};o.prototype.getURI=function(){"use strict";return this.$XHRRequest1;};o.prototype.setMethod=function(p){"use strict";this.$XHRRequest2=p;return this;};o.prototype.getMethod=function(){"use strict";return this.$XHRRequest2;};o.prototype.setData=function(p){"use strict";this.$XHRRequest3=p;return this;};o.prototype.getData=function(){"use strict";return this.$XHRRequest3;};o.prototype.setRawData=function(p){"use strict";this.$XHRRequest4=p;return this;};o.prototype.setRequestHeaderField=function(p,q){"use strict";if(!this.$XHRRequest5)this.$XHRRequest5={};this.$XHRRequest5[p]=q;return this;};o.prototype.setTimeout=function(p){"use strict";this.$XHRRequest6=p;return this;};o.prototype.setResponseHandler=function(p){"use strict";this.$XHRRequest7=p;return this;};o.prototype.setErrorHandler=function(p){"use strict";this.$XHRRequest8=p;return this;};o.prototype.setAbortHandler=function(p){"use strict";this.$XHRRequest9=p;return this;};o.prototype.setTimeoutHandler=function(p){"use strict";this.$XHRRequesta=p;return this;};o.prototype.setUploadProgressHandler=function(p){"use strict";this.$XHRRequestb=p;return this;};o.prototype.setIsAsynchronous=function(p){"use strict";this.$XHRRequestc=p;return this;};o.prototype.setTransportBuilder=function(p){"use strict";this.$XHRRequestd=p;return this;};o.prototype.setDataSerializer=function(p){"use strict";this.$XHRRequeste=p;return this;};o.prototype.send=function(){"use strict";var p=this.$XHRRequest6,q=this.$XHRRequestd(),r=this.getURI();this.$XHRRequestf=q;var s;k(this.$XHRRequest2==='POST'||!this.$XHRRequest4);if(this.$XHRRequest2==='GET'||this.$XHRRequest4){r.addQueryData(this.$XHRRequest3);s=this.$XHRRequest4;}else s=this.$XHRRequeste(this.$XHRRequest3);q.onreadystatechange=this.$XHRRequest0;if(q.upload&&this.$XHRRequestb)q.upload.onprogress=this.$XHRRequestg.bind(this);if(p)this.$XHRRequesth=setTimeout(this.$XHRRequesti.bind(this),p);q.open(this.$XHRRequest2,r.toString(),this.$XHRRequestc);if(this.$XHRRequest5)for(var t in this.$XHRRequest5)q.setRequestHeader(t,this.$XHRRequest5[t]);q.send(s);if(!this.$XHRRequestc)q.onreadystatechange(null,true);};o.prototype.abort=function(){"use strict";this.$XHRRequestj();if(this.$XHRRequest9)g.applyWithGuard(this.$XHRRequest9,null,null,null,'XHRRequest:_abortHandler');};o.prototype.$XHRRequestj=function(){"use strict";var p=this.$XHRRequestf;if(p){p.onreadystatechange=null;p.abort();}this.$XHRRequestk();};o.prototype.$XHRRequesti=function(){"use strict";this.$XHRRequestj();if(this.$XHRRequesta)g.applyWithGuard(this.$XHRRequesta,null,null,null,'XHRRequest:_abortHandler');};o.prototype.$XHRRequest0=function(p,q){"use strict";if(!this.$XHRRequestc&&q!==true)return;var r=this.$XHRRequestf,s=r,t=s.readyState;if(t>=2){var u=t===4,v=this.getURI(),w=i.getErrorCode(v,r.status),x=this.$XHRRequest7;if(w!==null){if(u){m.errorCode=w;m.errorMsg=r.responseText;m.errorType='HTTP';if(this.$XHRRequest8)g.applyWithGuard(this.$XHRRequest8,null,[m],null,'XHRRequest:_errorHandler');}}else if(x){var y=null;if(x.includeHeaders)y=r.getAllResponseHeaders();if(u||(x.parseStreaming&&t===3))g.applyWithGuard(x,null,[r.responseText,y,u],null,'XHRRequest:handler');}if(u)this.$XHRRequestk();}};o.prototype.$XHRRequestg=function(p){"use strict";n.loadedBytes=p.loaded;n.totalBytes=p.total;if(this.$XHRRequestb)g.applyWithGuard(this.$XHRRequestb,null,[n],null,'XHRRequest:_uploadProgressHandler');};o.prototype.$XHRRequestk=function(){"use strict";clearTimeout(this.$XHRRequesth);delete this.$XHRRequestf;};e.exports=o;},null);
__d("filterObject",[],function(a,b,c,d,e,f){"use strict";function g(h,i,j){if(!h)return null;var k={};for(var l in h)if(h.hasOwnProperty(l)&&i.call(j,h[l],l))k[l]=h[l];return k;}e.exports=g;},null);
__d("PooledWebWorker",["WebWorker"],function(a,b,c,d,e,f,g){for(var h in g)if(g.hasOwnProperty(h))j[h]=g[h];var i=g===null?null:g.prototype;j.prototype=Object.create(i);j.prototype.constructor=j;j.__superConstructor__=g;function j(k,l,m){"use strict";i.constructor.call(this,m);this.$PooledWebWorker0=l;this.$PooledWebWorker1=k;}j.prototype.getIndex=function(){"use strict";return this.$PooledWebWorker0;};j.prototype.getPool=function(){"use strict";return this.$PooledWebWorker1;};e.exports=j;},null);
__d("WebWorkerPool",["PooledWebWorker","emptyFunction"],function(a,b,c,d,e,f,g,h){i.isSupported=function(){"use strict";return g.isSupported();};function i(j,k){"use strict";this.$WebWorkerPool0=[];for(var l=0;l<k;l++)this.$WebWorkerPool0.push(new g(this,l,j).setErrorHandler(this.$WebWorkerPool1).setMessageHandler(this.$WebWorkerPool2).execute());this.$WebWorkerPool3=0;}i.prototype.setMessageHandler=function(j){"use strict";this.$WebWorkerPool4=j||h;return this;};i.prototype.setAllowCrossPageTransition=function(j){"use strict";this.$WebWorkerPool0.forEach(function(k){return k.setAllowCrossPageTransition(j);});return this;};i.prototype.setErrorHandler=function(j){"use strict";this.$WebWorkerPool5=j||h;return this;};i.prototype.postMessage=function(){"use strict";var j=Array.prototype.slice.call(arguments,0),k=this.getWorker();k.postMessage.apply(k,j);return k;};i.prototype.$WebWorkerPool2=function(){"use strict";var j=Array.prototype.slice.call(arguments,0);j.unshift(this);this.getPool().$WebWorkerPool4.apply(this.getPool(),j);};i.prototype.$WebWorkerPool1=function(){"use strict";var j=Array.prototype.slice.call(arguments,0);j.unshift(this);return this.getPool().$WebWorkerPool5.apply(this.getPool(),j);};i.prototype.getWorker=function(){"use strict";var j=this.$WebWorkerPool0[this.$WebWorkerPool3];this.$WebWorkerPool3=(this.$WebWorkerPool3+1)%this.$WebWorkerPool0.length;return j;};e.exports=i;},null);
__d("JpegResizer",["Emscripten","JpegResizerConfig","JpegResizeWorkerResource","WebWorker","WebWorkerPool"],function(a,b,c,d,e,f,g,h,i,j,k){var l=null;m.isSupported=function(){"use strict";return k.isSupported()&&g.isSupported()&&!h.isGKBlacklisted;};m.getSingleton=function(){"use strict";if(!l)l=new m(m.DEFAULT_POOL_SIZE).setAllowCrossPageTransition(true);return l;};m.prepareResource=function(n){"use strict";j.prepareResource(i,n);};function m(n){"use strict";n=n||m.DEFAULT_POOL_SIZE;j.prepareResource(i);this.$JpegResizer0=(new k(i,n)).setErrorHandler(this.$JpegResizer1.bind(this)).setMessageHandler(this.$JpegResizer2.bind(this));this.$JpegResizer3={};}m.prototype.setAllowCrossPageTransition=function(n){"use strict";this.$JpegResizer0.setAllowCrossPageTransition(n);return this;};m.prototype.resizeBlob=function(n,o,p){"use strict";var q=this.$JpegResizer0.getWorker();if(q.isCurrentState('terminated')){o(new Error('Worker terminated'));return this;}var r=q.postMessage({blob:n,height:2048,width:2048}).getIndex();this.$JpegResizer4(r).unshift({done:o,progress:p});return this;};m.prototype.$JpegResizer4=function(n){"use strict";if(!this.$JpegResizer3.hasOwnProperty(n))this.$JpegResizer3[n]=[];return this.$JpegResizer3[n];};m.prototype.$JpegResizer1=function(n,o){"use strict";n.terminate();var p=this.$JpegResizer4(n.getIndex());p.forEach(function(q){return q.done(o);});p.length=0;};m.prototype.$JpegResizer2=function(n,o){"use strict";if(o.done){this.$JpegResizer4(n.getIndex()).pop().done(o.error,o.blob,o.skipped);}else{var p=this.$JpegResizer4(n.getIndex()),q=p[p.length-1].progress;if(q)q({written:o.written,total:o.total});}};m.DEFAULT_POOL_SIZE=3;e.exports=m;},null);
__d("DataViewPolyfill",["copyProperties"],function(a,b,c,d,e,f,g){"use strict";function h(i,j,k){if(j===undefined){this._ba=new Uint8Array(i);}else if(k===undefined){this._ba=new Uint8Array(i,j);}else this._ba=new Uint8Array(i,j,k);this.byteLength=this._ba.byteLength;}g(h,{isSupported:function(){return !!a.Uint8Array;}});g(h.prototype,{getUint8:function(i){if(i>=this._ba.length)throw new Error('Trying to read beyond bounds of DataViewPolyfill');return this._ba[i];},getUint16:function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1);return j?(l*256)+k:(k*256)+l;},getUint32:function(i,j){var k=this.getUint8(i),l=this.getUint8(i+1),m=this.getUint8(i+2),n=this.getUint8(i+3);return j?(((n*256+m)*256+l)*256)+k:(((k*256+l)*256+m)*256)+n;}});e.exports=h;},null);
__d("getImageSize",["DataViewPolyfill"],function(a,b,c,d,e,f,g){var h=a.DataView||g;function i(m){return {width:m.getUint16(6,true),height:m.getUint16(8,true)};}function j(m){return {width:m.getUint32(16,false),height:m.getUint32(20,false)};}function k(m){var n=m.byteLength,o=2;while(o<n){var p=m.getUint16(o,false);o+=2;if(p==65472||p==65474){return {width:m.getUint16(o+5,false),height:m.getUint16(o+3,false)};}else o+=m.getUint16(o,false);}return null;}function l(m){var n=new h(m);if(n.getUint8(0)==255&&n.getUint8(1)==216)return k(n);if(n.getUint8(0)==71&&n.getUint8(1)==73&&n.getUint8(2)==70)return i(n);if(n.getUint8(0)==137&&n.getUint8(1)==80&&n.getUint8(2)==78&&n.getUint8(3)==71)return j(n);return null;}e.exports=l;l.gif=i;l.png=j;l.jpeg=k;},null);
__d("ChatAutoSendPhotoUploader",["ArbiterMixin","AsyncUploadRequest","DOM","Event","FileForm","FileFormResetOnSubmit","FileInput","FormSubmitOnChange","JpegResizer","MercuryAttachmentType","PhotosMimeType","PhotosUploadID","SubscriptionsHandler","arrayContains","csx","getImageSize","getObjectValues","invariant","isEmpty","mixin"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){"use strict";function aa(){return 'upload_'+r.getNewID();}var ba=z(g);for(var ca in ba)if(ba.hasOwnProperty(ca))ea[ca]=ba[ca];var da=ba===null?null:ba.prototype;ea.prototype=Object.create(da);ea.prototype.constructor=ea;ea.__superConstructor__=ba;function ea(fa,ga,ha){this.$ChatAutoSendPhotoUploader0=ha;this.$ChatAutoSendPhotoUploader1=ga;this.$ChatAutoSendPhotoUploader2=new s();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};this.$ChatAutoSendPhotoUploader5=fa.getAttribute('action');this.$ChatAutoSendPhotoUploader6=new k(fa,[n,l]);this.$ChatAutoSendPhotoUploader6.setAllowCrossOrigin(true);this.$ChatAutoSendPhotoUploader6.setUploadInParallel(true);var ia=i.find(fa,"._4q60"),ja=i.find(ia,"._4q61");new m(ia,ja,ga);this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.$ChatAutoSendPhotoUploader6.subscribe('submit',this.$ChatAutoSendPhotoUploader7.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('success',this.$ChatAutoSendPhotoUploader8.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('failure',this.$ChatAutoSendPhotoUploader9.bind(this)),this.$ChatAutoSendPhotoUploader6.subscribe('progress',this.$ChatAutoSendPhotoUploadera.bind(this)),j.listen(ja,'click',function(){if(this.$ChatAutoSendPhotoUploaderb)if(o.prepareResource)o.prepareResource();this.inform('open');}.bind(this)));this.$ChatAutoSendPhotoUploaderb=o.isSupported();if(this.$ChatAutoSendPhotoUploaderb)this.$ChatAutoSendPhotoUploader6.setPreprocessHandler(this.$ChatAutoSendPhotoUploaderc.bind(this));}ea.prototype.isUploading=function(){return !y(this.$ChatAutoSendPhotoUploader3);};ea.prototype.destroy=function(){this.$ChatAutoSendPhotoUploader2.release();this.$ChatAutoSendPhotoUploader6.destroy();this.$ChatAutoSendPhotoUploader3={};this.$ChatAutoSendPhotoUploader4={};};ea.prototype.$ChatAutoSendPhotoUploaderd=function(fa,ga){var ha=this.$ChatAutoSendPhotoUploadere(fa);if(ga){ha.preview_width=ga.width;ha.preview_height=ga.height;}return ha;};ea.prototype.$ChatAutoSendPhotoUploadere=function(fa){var ga={upload_id:fa,on_progress:function(ha){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('progress',ha));}.bind(this),on_resizing_progress:function(ha){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('resize_progress',ha));}.bind(this),on_success:function(ha){this.$ChatAutoSendPhotoUploader2.addSubscriptions(this.subscribe('success',ha));}.bind(this),upload_canceled:this.$ChatAutoSendPhotoUploaderf.bind(this),attach_type:p.PHOTO,preview_uploading:true};return ga;};ea.prototype.$ChatAutoSendPhotoUploaderc=function(fa,ga){var ha=fa.getFile();if(!q(ha.type).isJpeg())return ga(fa);o.getSingleton().resizeBlob(ha,function(ia,ja,ka){if(ja)fa.setFile(ja);ga(fa);},this.$ChatAutoSendPhotoUploaderg.bind(this,fa));};ea.prototype.$ChatAutoSendPhotoUploader7=function(){var fa=aa();this.$ChatAutoSendPhotoUploaderh(fa,this.$ChatAutoSendPhotoUploader1.files);};ea.prototype.$ChatAutoSendPhotoUploaderh=function(fa,ga){var ha={};if(typeof FileReader!=='undefined'&&FileReader.prototype.readAsArrayBuffer&&ga&&ga.length===1){this.$ChatAutoSendPhotoUploader3[fa]=fa;ha[fa]=ga[0];var ia=new FileReader();ia.onload=function(){this.inform('submit',{upload_id:fa,preview_attachments:[this.$ChatAutoSendPhotoUploaderd(fa,v(ia.result))]});}.bind(this);ia.onerror=function(){this.inform('submit',{upload_id:fa,preview_attachments:[this.$ChatAutoSendPhotoUploadere(fa)]});}.bind(this);ia.readAsArrayBuffer(ga[0]);}else{var ja=[];if(!ga){this.$ChatAutoSendPhotoUploader3[fa]=fa;this.$ChatAutoSendPhotoUploader0.value=fa;ja.push(this.$ChatAutoSendPhotoUploadere(fa));}else for(var ka=0;ka<ga.length;++ka){var la=aa();ha[la]=ga[ka];this.$ChatAutoSendPhotoUploader3[la]=fa;ja.push(this.$ChatAutoSendPhotoUploadere(la));}this.inform('submit',{upload_id:fa,preview_attachments:ja});}if(Object.keys(ha).length>0)this.$ChatAutoSendPhotoUploader6.setFiles(ha);};ea.prototype.$ChatAutoSendPhotoUploader8=function(event,fa){var ga=this.$ChatAutoSendPhotoUploaderi(fa);if(this.$ChatAutoSendPhotoUploader3[ga]){var ha=this.$ChatAutoSendPhotoUploader3[ga];delete this.$ChatAutoSendPhotoUploader3[ga];var ia=fa.response.getPayload();if(!this.$ChatAutoSendPhotoUploader4[ha])this.$ChatAutoSendPhotoUploader4[ha]=[];this.$ChatAutoSendPhotoUploader4[ha].push({id:ga,fbid:ia.metadata[0].image_id});this.inform('success',{upload_id:ga});if(!this.$ChatAutoSendPhotoUploaderj(ha))this.$ChatAutoSendPhotoUploaderk(ha);}};ea.prototype.$ChatAutoSendPhotoUploaderk=function(fa){x(!this.$ChatAutoSendPhotoUploaderj(fa));this.$ChatAutoSendPhotoUploader4[fa].sort(function(ha,ia){return ha.id<ia.id?-1:1;});var ga=this.$ChatAutoSendPhotoUploader4[fa].map(function(ha){return ha.fbid;});this.inform('all-uploads-completed',{upload_id:fa,image_ids:ga});delete this.$ChatAutoSendPhotoUploader4[fa];};ea.prototype.$ChatAutoSendPhotoUploadera=function(event,fa){this.inform('progress',{upload_id:fa.upload.getName(),event:fa.event});};ea.prototype.$ChatAutoSendPhotoUploaderg=function(fa,event){this.inform('resize_progress',{upload_id:fa.getName(),event:event});};ea.prototype.$ChatAutoSendPhotoUploaderj=function(fa){return t(w(this.$ChatAutoSendPhotoUploader3),fa);};ea.prototype.$ChatAutoSendPhotoUploader9=function(event,fa){var ga=this.$ChatAutoSendPhotoUploaderi(fa);this.$ChatAutoSendPhotoUploaderl(ga,'last-upload-failed');return false;};ea.prototype.$ChatAutoSendPhotoUploaderf=function(fa){this.$ChatAutoSendPhotoUploaderl(fa,'last-upload-canceled');};ea.prototype.$ChatAutoSendPhotoUploaderl=function(fa,ga){if(!this.$ChatAutoSendPhotoUploader3[fa])return;var ha=this.$ChatAutoSendPhotoUploader3[fa];delete this.$ChatAutoSendPhotoUploader3[fa];if(!this.$ChatAutoSendPhotoUploaderj(ha))if(this.$ChatAutoSendPhotoUploader4[ha]){this.$ChatAutoSendPhotoUploaderk(ha);}else this.inform(ga,{upload_id:ha});};ea.prototype.$ChatAutoSendPhotoUploaderi=function(fa){if(fa.upload){return fa.upload.getName();}else return fa.response.getPayload().uploadID;};ea.prototype.uploadFile=function(fa){var ga=aa(),ha={};ha[ga]=fa;var ia=new h(this.$ChatAutoSendPhotoUploader5).setAllowCrossOrigin(true).setRelativeTo(this.$ChatAutoSendPhotoUploader6.getRoot()).setFiles(ha);this.$ChatAutoSendPhotoUploader2.addSubscriptions(ia.subscribe('success',function(event,ja){this.$ChatAutoSendPhotoUploader8(event,{upload:ja,response:ja.getResponse()});}.bind(this)),ia.subscribe('failure',this.$ChatAutoSendPhotoUploader9.bind(this)));ia.send();this.$ChatAutoSendPhotoUploaderh(ga,[fa]);};e.exports=ea;},null);
__d("ChatPhotoUploader.react",["ChatAutoSendPhotoUploader","Image.react","InlineBlock.react","Link.react","MercuryConfig","React","SubscriptionsHandler","cx","emptyFunction","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';var r=l.createClass({displayName:'ChatPhotoUploader',propTypes:{actionURI:l.PropTypes.string,onSubmit:l.PropTypes.func,onAllUploadsComplete:l.PropTypes.func,onLastUploadFail:l.PropTypes.func,onLastUploadCancel:l.PropTypes.func},getDefaultProps:function(){return {actionURI:k.upload_url,onSubmit:o,onAllUploadsComplete:o,onLastUploadFail:o,onLastUploadCancel:o};},componentDidMount:function(){this._uploader=new g(this.refs.form.getDOMNode(),this.refs.input.getDOMNode(),this.refs.attachID.getDOMNode());this._subscriptions=new m();this._subscriptions.addSubscriptions(this._uploader.subscribe('submit',this._handleSubmit),this._uploader.subscribe('all-uploads-completed',this._handleAllUploadsCompleted),this._uploader.subscribe('last-upload-failed',this._handleLastUploadFailed),this._uploader.subscribe('last-upload-canceled',this._handleLastUploadCanceled));},shouldComponentUpdate:function(s,t){return s.actionURI!=this.props.actionURI;},componentWillUnmount:function(){this._subscriptions&&this._subscriptions.release();this._uploader&&this._uploader.destroy();},render:function(){return (l.createDescriptor(l.DOM.form,{action:this.props.actionURI,method:"post",ref:"form"},l.createDescriptor(l.DOM.input,{type:"hidden",name:"attach_id",ref:"attachID"}),l.createDescriptor(l.DOM.input,{type:"hidden",name:"images_only",value:true}),l.createDescriptor(i,{className:"_m _4q60 _3rzn"},l.createDescriptor(j,{className:"_4q61 _509v"},l.createDescriptor(h,{className:"_509w",src:q('/images/chat/chat_camera_icon.png'),alt:"Camera"})),l.createDescriptor(l.DOM.input,{type:"file",className:"_n",name:"attachment[]",multiple:"true",accept:"image/*",ref:"input"}))));},_handleSubmit:function(s,t){this.props.onSubmit(s,t);},_handleAllUploadsCompleted:function(s,t){this.props.onAllUploadsComplete(s,t);},_handleLastUploadFailed:function(s,t){this.props.onLastUploadFail(s,t);},_handleLastUploadCanceled:function(s,t){this.props.onLastUploadCancel(s,t);},isUploading:function(){return this._uploader&&this._uploader.isUploading();},uploadFile:function(s){this._uploader.uploadFile(s);}});e.exports=r;},null);
__d("ChatPrivacyActionController",["ChatVisibility","JSLogger","PresencePrivacy","copyProperties"],function(a,b,c,d,e,f,g,h,i,j){var k=function(l,m){this._userID=l;this._logger=h.create('blackbird');this._getState=function(){if(g.isOnline())return i.allows(this._userID)?k.NORMAL:k.BLOCKED;return k.OFFLINE;};this._togglePrivacy=function(){var n=this._getState();switch(this._getState()){case k.OFFLINE:if(g.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});g.goOnline(function(){if(!i.allows(this._userID)){if(this._getState()!==k.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case k.BLOCKED:i.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case k.NORMAL:i.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};setTimeout(function(){var n=function(){m&&m(this._getState());}.bind(this);n();this._subscribeToken=i.subscribe('privacy-changed',n);}.bind(this),0);};k.OFFLINE='offline';k.BLOCKED='blocked';k.NORMAL='normal';j(k.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();},destroy:function(){i.unsubscribe(this._subscribeToken);}});e.exports=k;},null);
__d("URLMatcher",[],function(a,b,c,d,e,f){var g='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',h='\u2000-\u206F\u00ab\u00bb\uff08\uff09',i='(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])',j='(?:(?:ht|f)tps?)://',k='(?:(?:'+i+'[.]){3}'+i+')',l='\\[(?:(?:[A-Fa-f0-9]{1,4}::?){1,7}[A-Fa-f0-9]{1,4})\\]',m='(?:\\b)www\\d{0,3}[.]',n='[^\\s'+g+h+']',o='(?:(?:(?:[.:\\-_%@]|'+n+')*'+n+')|'+l+')',p='(?:[.][a-z]{2,4})',q='(?::\\d+){0,1}',r='(?=[/?#])',s='(?:'+'(?:'+j+o+q+')|'+'(?:'+k+q+')|'+'(?:'+l+q+')|'+'(?:'+m+o+p+q+')|'+'(?:'+o+p+q+r+')'+')',t='[/#?]',u='\\([^\\s()<>]+\\)',v='[^\\s()<>?#]+',w=new RegExp(s,'im'),x='^\\[[0-9]{1,4}:[0-9]{1,4}:[A-Fa-f0-9]{1,4}\\]',y=new RegExp(x,'im'),z='(?:'+'(?:'+t+')'+'(?:'+'(?:'+u+'|'+v+')*'+')*'+')*',aa=new RegExp('('+'(?:'+s+')'+'(?:'+z+')'+')','im'),ba=new RegExp('('+'(?:'+j+o+q+')|'+'(?:'+m+o+p+q+')'+')'),ca=/[\s'";]/,da=new RegExp(t,'im'),ea=new RegExp('[\\s!"#%&\'()*,./:;<>?@[\\]^`{|}\u00ab\u00bb\u2000-\u206F\uff08\uff09]','im'),fa=new RegExp('[\\s()<>?#]','im'),ga=new RegExp('\\s()<>'),ha=function(oa){if(oa&&oa.indexOf('@')!=-1){return (ba.exec(oa))?oa:null;}else return oa;},ia=function(oa){return ja(oa,aa);},ja=function(oa,pa){var qa=(pa.exec(oa)||[])[1]||null;return ha(qa);},ka=function(oa){return w.exec(oa);},la=function(oa){return !ca.test(oa.charAt(oa.length-1));},ma=function(oa){do{var pa=w.exec(oa);if(!pa)return null;var qa=false;if(pa[0][0]==='['&&pa.index>0&&oa[pa.index-1]==='@'){var ra=y.exec(pa[0]);if(ra){qa=true;oa=oa.substr(pa.index+ra[0].length);}}}while(qa);var sa=oa.substr(pa.index+pa[0].length);if(sa.length===0||!(da.test(sa[0])))return ha(pa[0]);var ta=0,ua=0,va=1,wa=0,xa=ua;for(var ya=1;ya<sa.length;ya++){var za=sa[ya];if(xa===ua){if(za==='('){wa=wa+1;xa=va;}else if(da.test(za)||!(ea.test(za))){ta=ya;}else if(fa.test(za))break;}else if(za==='('){wa=wa+1;}else if(za===')'){wa=wa-1;if(wa===0){xa=ua;ta=ya;}}else if(ga.test(za))break;}return ha(pa[0]+sa.substring(0,ta+1));},na={};na.permissiveMatch=ia;na.matchToPattern=ja;na.matchHost=ka;na.trigger=la;na.match=ma;e.exports=na;},null);
__d("MercuryShareLinkUploader",["ArbiterMixin","AsyncRequest","CSS","DOM","Form","URLScraper","WebMessengerEvents","mixin","Event"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=n(g);for(var q in p)if(p.hasOwnProperty(q))s[q]=p[q];var r=p===null?null:p.prototype;s.prototype=Object.create(r);s.prototype.constructor=s;s.__superConstructor__=p;function s(t,u,v,w,x){"use strict";this.$MercuryShareLinkUploader0=t;this.$MercuryShareLinkUploader1=u;this.$MercuryShareLinkUploader2=v;this.$MercuryShareLinkUploader3=x;this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;o.listen(w,'click',this.close.bind(this));o.listen(x,'keyup',function(){!x.value.length&&this.$MercuryShareLinkUploader7.enable();}.bind(this));this.$MercuryShareLinkUploader7=new l(x);this.$MercuryShareLinkUploader7.subscribe('match',function(y,z){this.loadShare(z&&z.url);}.bind(this));}s.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$MercuryShareLinkUploader4,this.$MercuryShareLinkUploader0,this.$MercuryShareLinkUploader3);};s.prototype.loadAttachData=function(t,u,v){"use strict";if(t){var w=k.serialize(u),x=w.attachment&&w.attachment.params,y=w.link_metrics?w.link_metrics.no_image:true;if(!x||!x.url)return null;if(v.value.indexOf(x.url)===-1)return w;if(!x.summary&&!x.favicon&&y)if(!x.title||x.url.substr(0,x.title.length)===x.title)return null;return w;}return null;};s.prototype.check=function(){"use strict";this.$MercuryShareLinkUploader7.check();};s.prototype.close=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.disable();this.inform('closed');};s.prototype.clear=function(){"use strict";this.$MercuryShareLinkUploader8();this.$MercuryShareLinkUploader7.enable();};s.prototype.enable=function(){"use strict";this.$MercuryShareLinkUploader7.enable();};s.prototype.disable=function(){"use strict";this.$MercuryShareLinkUploader7.disable();};s.prototype.loadShare=function(t){"use strict";this.$MercuryShareLinkUploader5=t;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=new h().setMethod('POST').setURI('/ajax/share_scrape.php').setData({u:t}).setHandler(this.$MercuryShareLinkUploader9.bind(this).bind(null,t)).setStatusElement(this.$MercuryShareLinkUploader2);this.$MercuryShareLinkUploader6.send();this.inform('link-detected');};s.prototype.$MercuryShareLinkUploader9=function(t,u){"use strict";if(this.$MercuryShareLinkUploader5!==t)return;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6=null;i.show(this.$MercuryShareLinkUploader0);j.empty(this.$MercuryShareLinkUploader1);j.setContent(this.$MercuryShareLinkUploader1,u.payload);this.$MercuryShareLinkUploader4=true;if(!this.getAttachData()){this.close();return;}m.detailDOMChanged();};s.prototype.$MercuryShareLinkUploader8=function(){"use strict";i.hide(this.$MercuryShareLinkUploader0);this.$MercuryShareLinkUploader4=false;this.$MercuryShareLinkUploader5=null;this.$MercuryShareLinkUploader6&&this.$MercuryShareLinkUploader6.abort();this.$MercuryShareLinkUploader6=null;this.$MercuryShareLinkUploader7.reset();m.detailDOMChanged();};e.exports=s;},null);
__d("ChatShareLinkUploader",["AsyncRequest","CSS","DOM","URLScraper","MercuryShareLinkUploader","MercuryAttachmentTemplates","Event"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){for(var n in k)if(k.hasOwnProperty(n))p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(q,r,s){"use strict";this.$ChatShareLinkUploader0=q;this.$ChatShareLinkUploader1=r;this.$ChatShareLinkUploader2=s;this.$ChatShareLinkUploader3=false;this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5=null;m.listen(r,'keyup',function(){!r.value.length&&this.$ChatShareLinkUploader6.enable();}.bind(this));this.$ChatShareLinkUploader6=new j(r);this.$ChatShareLinkUploader6.subscribe('match',function(t,u){this.loadShare(u&&u.url);}.bind(this));this.$ChatShareLinkUploader7=null;}p.prototype.getAttachData=function(){"use strict";return this.loadAttachData(this.$ChatShareLinkUploader3,this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader1);};p.prototype.close=function(){"use strict";this.$ChatShareLinkUploader8();this.$ChatShareLinkUploader6.disable();this.inform('closed');};p.prototype.clear=function(){"use strict";this.$ChatShareLinkUploader8();this.$ChatShareLinkUploader6.enable();};p.prototype.$ChatShareLinkUploader8=function(){"use strict";var q=this.$ChatShareLinkUploader7;delete this.$ChatShareLinkUploader7;if(q){i.remove(q);this.inform('dom-updated');}this.$ChatShareLinkUploader3=false;this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5&&this.$ChatShareLinkUploader5.abort();this.$ChatShareLinkUploader5=null;this.$ChatShareLinkUploader6&&this.$ChatShareLinkUploader6.reset();};p.prototype.loadShare=function(q,r){"use strict";this.$ChatShareLinkUploader4=q;this.$ChatShareLinkUploader5&&this.$ChatShareLinkUploader5.abort();var s=l[':fb:mercury:share-link-row'].build();if(this.$ChatShareLinkUploader7)i.remove(this.$ChatShareLinkUploader7);this.$ChatShareLinkUploader7=s.getRoot();m.listen(s.getNode('closeFileUpload'),'click',function(event){this.close();event.kill();}.bind(this));i.appendContent(this.$ChatShareLinkUploader0,this.$ChatShareLinkUploader7);h.show(this.$ChatShareLinkUploader0);this.inform('dom-updated');var t={u:q,chat:true,extra_params:JSON.stringify(r)};this.$ChatShareLinkUploader5=new g().setMethod('POST').setURI('/ajax/share_scrape.php').setData(t).setHandler(this.$ChatShareLinkUploader9.bind(this).bind(null,q));this.$ChatShareLinkUploader5.send();this.inform('link-detected');};p.prototype.$ChatShareLinkUploader9=function(q,r){"use strict";if(this.$ChatShareLinkUploader4!==q)return;this.$ChatShareLinkUploader4=null;this.$ChatShareLinkUploader5=null;i.appendContent(this.$ChatShareLinkUploader7,r.payload);this.$ChatShareLinkUploader2();this.$ChatShareLinkUploader3=true;if(!this.getAttachData()){this.close();return;}h.addClass(this.$ChatShareLinkUploader7,'done');};e.exports=p;},null);
__d("MessagesEmoticons.react",["Grid.react","React","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k){var l=g.GridItem,m=8,n={smile:"smile",frown:"frown",tongue:"tongue",grin:"grin",gasp:"gasp",wink:"wink",pacman:"pacman",grumpy:"grumpy",unsure:"unsure",cry:"cry",kiki:"kiki",glasses:"glasses",sunglasses:"sunglasses",heart:"heart",devil:"devil",angel:"angel",squint:"squint",confused:"confused",upset:"upset",colonthree:"colonthree",like:"like"},o=h.createClass({displayName:'MessagesEmoticons',propTypes:{onEmoticonSelect:h.PropTypes.func},getDefaultProps:function(){return {onEmoticonSelect:j};},getEmoticons:function(){return Object.keys(n).map(function(p){return (h.createDescriptor(l,{key:p},h.createDescriptor(h.DOM.div,{className:"panelCell"},h.createDescriptor(h.DOM.a,{'aria-label':n[p],className:'emoticon emoticon_'+p,onClick:function(){return this.props.onEmoticonSelect(p);}.bind(this)}))));}.bind(this));},render:function(){return (h.createDescriptor(h.DOM.div,{className:"emoticonsTable"},h.createDescriptor(g,{cols:m,alignv:"middle",alignh:"center",spacing:"pam"},this.getEmoticons())));}});e.exports=o;},null);
__d("StickersDispatcher",["Dispatcher","StickerConstants","copyProperties","merge"],function(a,b,c,d,e,f,g,h,i,j){'use strict';var k=i(new g(),{_handleUpdate:function(l,m){var n=j({payloadSource:l},m);this.dispatch(n);},handleUpdateFromViewActions:function(l){this._handleUpdate(h.PayloadSource.VIEW_ACTION,l);}});e.exports=k;},null);
__d("StickerActions",["StickerConstants","StickersDispatcher"],function(a,b,c,d,e,f,g,h){'use strict';var i={addPack:function(j){h.handleUpdateFromViewActions({actions:[{actionType:g.ActionTypes.ADD_PACK,packID:j}]});},removePack:function(j){h.handleUpdateFromViewActions({actions:[{actionType:g.ActionTypes.REMOVE_PACK,packID:j}]});},selectPack:function(j){h.handleUpdateFromViewActions({actions:[{actionType:g.ActionTypes.SELECT_PACK,packID:j}]});},resetNumNewPacks:function(){h.handleUpdateFromViewActions({actions:[{actionType:g.ActionTypes.RESET_NUM_NEW_PACKS}]});}};e.exports=i;},null);
__d("XStickerPackImagesControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b('XControllerURIBuilder').create("\/stickers\/{pack_id}\/images\/",{pack_id:{type:"Int",required:true},sticker_size:{type:"Int"}});},null);
__d("XStickersAddPackControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b('XControllerURIBuilder').create("\/stickers\/addpack\/",{pack_id:{type:"Int"},size:{type:"String"},redirect_uri:{type:"String"},is_promoted:{type:"Bool"}});},null);
__d("XStickersRemovePackControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b('XControllerURIBuilder').create("\/stickers\/removepack\/",{pack_id:{type:"Int"},size:{type:"String"},redirect_uri:{type:"String"}});},null);
__d("XStickerStateInitialDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b('XControllerURIBuilder').create("\/stickers\/state\/",{});},null);
__d("XStickerStatePackDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b('XControllerURIBuilder').create("\/stickers\/state\/pack\/",{pack_id:{type:"Int",required:true}});},null);
__d("XStickerStateStoreDataControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b('XControllerURIBuilder').create("\/stickers\/state\/store\/",{});},null);
__d("XStickerSearchNUXSeenControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b('XControllerURIBuilder').create("\/stickers\/searchNUX\/seen\/",{tooltip_only:{type:"Bool"}});},null);
__d("XStickerTagImagesControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b('XControllerURIBuilder').create("\/stickers\/tag\/images\/",{tag_ids:{type:"IntVector",required:true}});},null);
__d("StickerServerRequests",["AsyncRequest","Promise","XStickerPackImagesControllerURIBuilder","XStickersAddPackControllerURIBuilder","XStickersRemovePackControllerURIBuilder","XStickerStateInitialDataControllerURIBuilder","XStickerStatePackDataControllerURIBuilder","XStickerStateStoreDataControllerURIBuilder","XStickerSearchNUXSeenControllerURIBuilder","XStickerTagImagesControllerURIBuilder"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';var q={addPack:function(s,t,u){var v=new j().setInt('pack_id',s).setBool('is_promoted',t).getURI();new g(v).setHandler(function(w){return u(w.payload);}).send();},removePack:function(s,t){var u=new k().setInt('pack_id',s).getURI();new g(u).setHandler(function(v){return t(v.payload);}).send();},getStickersForPack:function(s,t){var u=new i().setInt('pack_id',s).setInt('sticker_size',t).getURI();return new h(function(v,w){return new g().setURI(u).setMethod("POST").setHandler(function(x){return v(x.payload);}).send();});},getStickersForTags:function(s,t){new g().setURI(new p().setIntVector('tag_ids',s).getURI()).setMethod("POST").setHandler(function(u){return t(u);}).send();},fetchTrayData:function(s){return r(new l().getURI(),s);},fetchStoreData:function(s){return r(new n().getURI(),s);},fetchPackData:function(s,t){return r(new m().setInt('pack_id',s).getURI(),t);},markSeenSearchNUX:function(){new g(new o().setBool('tooltip_only',false).getURI().toString()).send();},markSeenSearchTooltipNUX:function(){new g(new o().setBool('tooltip_only',true).getURI().toString()).send();}};function r(s,t){return new h(function(u,v){return new g(s).setHandler(function(w){return u(w.getPayload());}).send();}).then(t);}e.exports=q;},null);
__d("StickerImages",["StickerServerRequests"],function(a,b,c,d,e,f,g){'use strict';var h={},i={},j={},k={requestStickersForTags:function(l,m){var n=l.filter(function(o){return !j[o.id];}).map(function(o){return o.id;});if(n.length>0){g.getStickersForTags(n,function(o){for(var p in o.payload)j[p]=o.payload[p];m();});}else m();},getStickerTagsData:function(){return j;},requestStickersForPack:function(l,m,n){if(!l)return;if(!i[l]){i[l]=g.getStickersForPack(l,m);i[l].then(function(o){o.forEach(function(p){return this.cacheSticker(p);}.bind(this));}.bind(this));}i[l].then(function(o){return n(o);});},cacheSticker:function(l){h[l.id]=l;},getSticker:function(l){return h[l];}};e.exports=k;},null);
__d("StickerState",["ImmutableObject","MercuryConfig","PresenceState","StickerConstants","StickerImages","StickersDispatcher","StickerServerRequests","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o={},p,q,r,s=null,t=0,u={},v=[],w=[],x=[],y=null,z=i.get();if(z)y=z.tray_pack_id;var aa=h.ShowStickerReplyNUX,ba=h.ShowStickerSearchNUXIndicator,ca=h.ShowStickerSearchNUXTooltip,da={onTrayDataReady:function(ga){if(!q)q=m.fetchTrayData(function(ha){v=ha.packs.map(function(ia){return ea(ia);});r=ha.mru;t=ha.num_new_packs;x=ha.tags;});q.then(ga);},onStoreDataReady:function(ga){if(!p)p=m.fetchStoreData(function(ha){w=ha.packs.map(function(ia){return ea(ia);});});p.then(ga);},onPackDataReady:function(ga,ha){if(!o[ga])o[ga]=m.fetchPackData(ga,function(ia){ea(ia);});o[ga].then(ha);},getPacksInTray:function(){return v;},getPacksInCommentsTray:function(){return v.filter(function(ga){return !ga.isMessengerOnly;});},getPackIDsInTray:function(){return v.map(function(ga){return ga.id;});},getPacksInStore:function(){return w;},getPack:function(ga){return u[ga];},getNumNewPacks:function(){return t;},getTags:function(){return x;},resetNumNewPacks:function(){if(t){t=0;this.emit(this.NUM_NEW_PACKS_CHANGED,0);}},addMRUPack:function(){if(r){this._addPackToTray(r,false);r=null;}},addPack:function(ga){var ha=false;if(u[ga])ha=u[ga].isPromoted;m.addPack(ga,ha,function(ia){this._addPackToTray(ia,ha);}.bind(this));},removePack:function(ga){m.removePack(ga,function(ha){v=v.filter(function(ia){return ia.id!==ha;});u[ha]=g.set(u[ha],{isInTray:false});w=w.map(function(ia){return u[ia.id];});this.emit(this.PACKS_CHANGED,ha);}.bind(this));},setTrayPackID:function(ga){y=ga;i.doSync();this.emit(da.PACK_SELECTED,ga);},getTrayPackID:function(){return y;},shouldShowStickerReplyNUX:function(){return aa;},clearShowStickerReplyNUX:function(){aa=false;},shouldShowStickerSearchNUXIndicator:function(){return ba;},shouldShowStickerSearchNUXTooltip:function(){return ca;},clearShowStickerSearchNUXIndicator:function(){m.markSeenSearchNUX();ba=false;},_addPackToTray:function(ga,ha){ea(ga);u[ga.id]=g.set(u[ga.id],{isPurchased:true,isInTray:true,isPromoted:false});if(!ha){var ia=v.filter(function(ja){return ja.isMRU||ja.isSearch;}).length;v.splice(ia,0,u[ga.id]);}w=w.map(function(ja){return u[ja.id];});this.emit(this.PACKS_CHANGED,ga.id);},_addRecentlyUsedSticker:function(ga){for(var ha=0;ha<s.length;++ha)if(s[ha].id===ga.id){s.splice(ha,1);break;}s.unshift(ga);},getMRUStickerPack:function(ga){if(!s)s=ga;return s;},updateRecentlyUsed:function(ga){if(!s){this.addMRUPack();return;}this._addRecentlyUsedSticker(k.getSticker(ga));}};l.register(function(ga){if(ga.actions&&ga.actions.length){var ha=j.ActionTypes;ga.actions.forEach(function(ia){switch(ia.actionType){case ha.ADD_PACK:da.addPack(ia.packID);break;case ha.REMOVE_PACK:da.removePack(ia.packID);break;case ha.SELECT_PACK:da.setTrayPackID(ia.packID);break;case ha.RESET_NUM_NEW_PACKS:da.resetNumNewPacks();break;}});}});da.PACKS_CHANGED='StickerState/packsChanged';da.PACK_SELECTED='StickerState/packSelected';da.NUM_NEW_PACKS_CHANGED='StickerState/numNewPacksChanged';i.registerStateStorer(function(ga){ga.tray_pack_id=y;});function ea(ga){var ha=ga.id;if(!u[ha]){return (u[ha]=new g(ga));}else return (u[ha]=g.set(u[ha],ga));}var fa={};fa[da.PACK_SELECTED]=true;fa[da.PACKS_CHANGED]=true;fa[da.NUM_NEW_PACKS_CHANGED]=true;n(da,fa);e.exports=da;},null);
__d("DialogFitHeight",["CSS","DOM","Event","Style","SubscriptionsHandler","Vector","csx","cx","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=450,q=100,r=67,s=67;function t(u){"use strict";this.$DialogFitHeight0=u;}t.prototype.enable=function(){"use strict";this.$DialogFitHeight1=new k();this.$DialogFitHeight1.addSubscriptions(this.$DialogFitHeight0.subscribe('beforeshow',this.$DialogFitHeight2.bind(this)),i.listen(window,'resize',o(this.$DialogFitHeight2.bind(this))));this.$DialogFitHeight3=h.find(this.$DialogFitHeight0.getRoot(),"._4-i2");g.addClass(this.$DialogFitHeight3,"_5pfh");this.$DialogFitHeight4=q;if(h.scry(this.$DialogFitHeight0.getRoot(),"._4-i0").length)this.$DialogFitHeight4+=r;if(h.scry(this.$DialogFitHeight0.getRoot(),"._5a8u").length)this.$DialogFitHeight4+=s;};t.prototype.disable=function(){"use strict";this.$DialogFitHeight1.release();this.$DialogFitHeight1=null;g.removeClass(this.$DialogFitHeight3,"_5pfh");};t.prototype.$DialogFitHeight2=function(){"use strict";var u=l.getViewportDimensions().y,v=u-this.$DialogFitHeight4;j.set(this.$DialogFitHeight3,'height',Math.max(p,v)+'px');this.$DialogFitHeight0.updatePosition();};e.exports=t;},null);
__d("StickerStoreController",["Bootloader","DialogFitHeight","DOM","Event","Keys","LayerFadeOnHide","React","XUIDialog.react","XUIDialogBody.react","XUISpinner.react","cx","requestAnimationFrame"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){'use strict';var s=688,t=null,u=null,v=m.createClass({displayName:'StoreLayer',getInitialState:function(){return {renderStore:function(){return (m.createDescriptor(m.DOM.div,{className:"_5r5e"},m.createDescriptor(p,{background:"light",size:"large"})));}};},componentDidMount:function(){g.loadModules(["StickerStore.react"],function(aa){this.setState({renderStore:function(){return (m.createDescriptor(aa,{currentPackID:this.props.packID,onPackSelect:this._packSelected,shown:this.props.shown}));}.bind(this)});}.bind(this));},_packSelected:function(aa){this.setProps({packID:aa});},_onToggle:function(aa){r(this.setProps.bind(this,{shown:aa},null));},render:function(){return (m.createDescriptor(n,{behaviors:{DialogFitHeight:h,LayerFadeOnHide:l},onToggle:this._onToggle,shown:this.props.shown,width:s},m.createDescriptor(o,{className:"_5rq-"},this.state.renderStore())));}});function w(aa){var ba=i.create('div');i.appendContent(document.body,ba);u=m.renderComponent(m.createDescriptor(v,{packID:aa,shown:true}),ba);}function x(){if(t)return;t=j.listen(document.body,'keydown',function(event){if(event.keyCode==k.ESC)z.hideStore();});}function y(){if(t){t.remove();t=null;}}var z={showStore:function(aa){if(!u){w(aa);}else u.setProps({shown:true,packID:aa});x();},hideStore:function(){u&&u.setProps({shown:false});y();}};e.exports=z;},null);
__d("StickersFlyoutPackSelector.react",["Animation","ImmutableObject","Locale","MercuryConfig","React","Image.react","StickerActions","StickerConstants","StickerState","StickerStoreController","XUIBadge.react","cx","emptyFunction","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';var v=4,w="Sticker Store",x=k.createClass({displayName:'StickersFlyoutPackSelector',propTypes:{numNewPacks:k.PropTypes.number,packs:k.PropTypes.arrayOf(k.PropTypes.instanceOf(h)).isRequired,onPackClick:k.PropTypes.func,selectedPackID:k.PropTypes.string,resetTagSelectorFunc:k.PropTypes.func},getInitialState:function(){return {animating:false,page:0};},getDefaultProps:function(){return {numNewPacks:0};},shouldComponentUpdate:function(z,aa){return !aa.animating;},_setPage:function(z){if(this.state.animating)return;this.setState({animating:true,page:z});var aa=this.refs.positioner.getDOMNode(),ba=this._calculatePosition(z);new g(aa).to(ba.reference,ba.offset+'px').ondone(function(){return this.setState({animating:false});}.bind(this)).duration(200).go();},_calculatePosition:function(z){var aa=this.refs.positioner.getDOMNode(),ba=aa.childNodes[z].offsetLeft;if(i.isRTL()){var ca=aa.offsetWidth,da=aa.childNodes[z].offsetWidth;return {reference:'right',offset:ba+da-ca};}return {reference:'left',offset:-ba};},_numPages:function(){return Math.max(1,Math.ceil((this.props.packs.length-1)/v));},_canGoPrev:function(){return this.state.page>0;},_canGoNext:function(){return this.state.page+1<this._numPages();},_goPrev:function(){this._canGoPrev()&&this._setPage(this.state.page-1);},_goNext:function(){this._canGoNext()&&this._setPage(this.state.page+1);},_openStore:function(){m.resetNumNewPacks();p.showStore();},render:function(){return (k.createDescriptor(k.DOM.div,{className:"_5r85"},this._renderStoreButton(),this._renderPrevArrow(),this._renderNextArrow(),k.createDescriptor(k.DOM.div,{className:"_5r88"},k.createDescriptor(k.DOM.div,{className:"_5r89",ref:"positioner"},this._renderPages()))));},_selectPack:function(z){var aa=o.getPack(z);if(aa&&aa.isPromoted)m.addPack(z);if(z===n.SEARCH_PACK_ID)this.props.resetTagSelectorFunc();if(this.props.onPackClick){this.props.onPackClick(z);}else m.selectPack(z);},_renderPages:function(){var z=this.props.packs.map(function(da){return k.createDescriptor(y,{key:da.id,onClick:function(){return this._selectPack(da.id);}.bind(this),pack:da,selected:this.props.selectedPackID===da.id});}.bind(this)),aa=[];for(var ba=0;ba<z.length;ba+=v){var ca=ba;ba===0&&ba++;aa.push(k.createDescriptor(k.DOM.div,{className:"_5r81",key:ba},z.slice(ca,ba+v)));}return aa;},_renderStoreButton:function(){return (k.createDescriptor(k.DOM.a,{'aria-label':w,className:"_5r86 rfloat",'data-hover':"tooltip",onClick:this._openStore},k.createDescriptor(l,{className:"_5r87",src:u('/images/messaging/stickers/selector/store.png')}),this._renderJewel()));},_renderJewel:function(){var z=this.props.numNewPacks;if(!z)return null;return (k.createDescriptor(q,{className:"rfloat _3fhs",count:z,maxcount:9,type:"special"}));},_renderPrevArrow:function(){if(!this._canGoPrev())return null;return (k.createDescriptor(k.DOM.a,{className:(("_37wu")+(' '+"lfloat")),onClick:this._goPrev},k.createDescriptor(l,{className:"_5r84",src:u('/images/messaging/stickers/selector/leftarrow.png')})));},_renderNextArrow:function(){if(!this._canGoNext())return null;return (k.createDescriptor(k.DOM.a,{className:(("_37wv")+(' '+"rfloat")),onClick:this._goNext},k.createDescriptor(l,{className:"_5r84",src:u('/images/messaging/stickers/selector/rightarrow.png')})));}}),y=k.createClass({displayName:'PackIcon',propTypes:{pack:k.PropTypes.instanceOf(h).isRequired,selected:k.PropTypes.bool,onClick:k.PropTypes.func},getDefaultProps:function(){return {onClick:s};},render:function(){var z=this.props.pack,aa=(("_5r8a")+(this.props.selected?' '+"_5r8b":''));return (k.createDescriptor(k.DOM.a,{'aria-label':z.name,className:aa,'data-id':z.id,'data-hover':"tooltip",ref:"search_icon",onClick:function(){return this.props.onClick(z.id);}.bind(this),tabIndex:"0"},k.createDescriptor(l,{className:(("_5r8c")+(z.isPromoted?' '+"_182h":'')+(j.WebStickerSearch?' '+"_1viy":'')),src:z.icon}),k.createDescriptor(l,{className:(("_5r8d")+(j.WebStickerSearch?' '+"_1viy":'')),src:z.selectedIcon})));}});e.exports=x;},null);
__d("StickerSearch",["StickerConfig","StickerImages","StickerState","createObjectFrom"],function(a,b,c,d,e,f,g,h,i,j){'use strict';var k=100,l=1000,m=g.sticker_trigger_threshold,n,o,p=null,q={},r={requestStickersForTags:function(s,t,u){o=t;h.requestStickersForTags(s,function(){if(o===t)u(this._getSortedStickersForTags(s,t));}.bind(this));},_getSortedStickersForTags:function(s,t){var u={},v=h.getStickerTagsData(),w={};n=j(i.getPackIDsInTray());s.forEach(function(z){v[z.id].forEach(function(aa){var ba=aa.score;if(n[aa.packID])ba+=k;if(z.name===t)ba+=l;if(!u[aa.id]||ba>w[aa.id]){u[aa.id]=aa;w[aa.id]=ba;}});});var x=[];for(var y in u){if(!u.hasOwnProperty(y))return;h.cacheSticker(u[y]);x.push(u[y]);}x.sort(function(z,aa){return w[aa.id]-w[z.id];});return x;},prepareTags:function(){if(!p){p=i.getTags();p&&p.map(function(s){return q[s.name]=s;});}},findTagForInput:function(s,t){this.prepareTags();var u=s.match(/\w+/g),v=m,w=null;for(var x=0;u!==null&&x<u.length;x++)if(q[u[x]]&&q[u[x]].sticker_count>v){v=q[u[x]].sticker_count;w=u[x];}if(w){h.requestStickersForTags([q[w]],function(){var y=h.getStickerTagsData()[q[w].id];t(y,w);});}else t([],null);},getTagByName:function(s){this.prepareTags();return q[s];},getTags:function(){this.prepareTags();return p;}};e.exports=r;},null);
__d("StickersFlyoutStickerSelector.react",["Grid.react","Image.react","LegacyScrollableArea.react","React","Sticker.react","StickerConstants","StickerImages","StickerSearch","StickerState","XUISpinner.react","areEqual","cx","emptyFunction","fbt","ix","throttle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){'use strict';var w=g.GridItem,x=320,y=278,z=l.MRU_STICKER_PACK,aa=64,ba=44,ca=112,da=j.createClass({displayName:'StickersFlyoutStickerSelector',propTypes:{height:j.PropTypes.number,onScroll:j.PropTypes.func,packID:j.PropTypes.string,userInput:j.PropTypes.string,tags:j.PropTypes.array},getDefaultProps:function(){return {onScroll:s};},getInitialState:function(){return {loading:false,stickers:[]};},componentDidMount:function(){if(this.props.tags){this.requestStickersForTags(this.props.tags,this.props.userInput);}else this.requestStickersForPack(this.props.packID);},componentWillReceiveProps:function(ea){if(ea.packID!==this.props.packID)this.requestStickersForPack(ea.packID);if(!q(ea.tags,this.props.tags))this.requestStickersForTags(ea.tags,ea.userInput);},getScaledDimensions:function(ea,fa){var ga,ha,ia;if(fa>ea){ia=aa/fa;ga=ea*ia;ha=fa*ia;}else{ia=aa/ea;ga=ea*ia;ha=fa*ia;}return {height:Math.round(ga),width:Math.round(ha)};},requestStickersForTags:function(ea,fa){this.setState({loading:true});n.requestStickersForTags(ea,fa,function(ga){this.isMounted()&&this.setState({loading:false,stickers:ga.slice(0,40)});}.bind(this));},requestStickersForPack:function(ea){this.setState({loading:true});m.requestStickersForPack(ea,aa,function(fa){if(ea==z)fa=o.getMRUStickerPack(fa);this.setState({loading:false,stickers:fa});}.bind(this));},renderStickers:function(){var ea=this.state.stickers.map(function(fa){var ga=this.getScaledDimensions(fa.height,fa.width);return (j.createDescriptor(w,{key:fa.id},j.createDescriptor(j.DOM.div,{className:"_5r8h",'data-id':fa.id},j.createDescriptor(k,{animationTrigger:"hover",className:"_5r8i",frameCount:fa.frameCount,frameRate:fa.frameRate||83,framesPerCol:fa.framesPerCol,framesPerRow:fa.framesPerRow,sourceHeight:ga.height,sourceURI:fa.sourceURI,sourceWidth:ga.width,spriteURI:fa.spriteURI,paddedSpriteURI:fa.paddedSpriteURI,stickerID:fa.id,style:{cursor:'pointer'}}))));},this);return ea;},_onScroll:function(){var ea=this.refs.stickerScrollable;if(ea){var fa=ea.getArea().getScrollTop();this.props.onScroll(fa);}},render:function(){if(this.state.loading){return (j.createDescriptor(j.DOM.div,{className:"_e0r"},j.createDescriptor(p,{size:"large"})));}else if(this.state.stickers.length===0){var ea=(x-ba*2-ca)/2+"px";return (j.createDescriptor(j.DOM.div,{className:"_5jdt",style:{marginTop:ea}},j.createDescriptor(h,{src:u("/images/messaging/stickers/icons/sad_face.png")}),j.createDescriptor(j.DOM.p,null,"No Stickers to Show")));}return (j.createDescriptor(i,{ref:"stickerScrollable",height:this.props.height||x,onScroll:v(this._onScroll,200),width:y,fade:true},j.createDescriptor(j.DOM.div,{className:"_5r8k"},j.createDescriptor(g,{cols:4,fixed:true},this.renderStickers()))));}});e.exports=da;},null);
__d("StickersFlyoutTagSelector.react",["BanzaiLogger","Grid.react","LegacyScrollableArea.react","Parent","React","Image.react","StickersFlyoutStickerSelector.react","StickerSearch","Toggler","XUIButton.react","XUICloseButton.react","XUITextInput.react","cx","debounce","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){'use strict';var v=h.GridItem,w=320,x=278,y=44,z=t(function(ba){if(!ba)return;g.log('StickersLoggerConfig',{event:'search_sticker',searchtoken:ba});},1000),aa=k.createClass({displayName:'StickersFlyoutTagSelector',propTypes:{tags:k.PropTypes.array},getInitialState:function(){return {input:'',isScrolling:false,tagChosen:false,applicableTags:[]};},getDefaultProps:function(){return {tags:[],trigger:null};},componentDidMount:function(){var ba=j.byClass(this.getDOMNode(),'uiToggle');if(ba)this._togglerSub=o.listen('show',ba,function(){this.isMounted()&&this._focusInput();}.bind(this));this._focusInput();this.selectTrigger(this.props.trigger);},componentWillUnmount:function(){this._togglerSub&&this._togglerSub.unsubscribe();},componentWillReceiveProps:function(ba){this.selectTrigger(ba.trigger);},_focusInput:function(){this.refs.inputField.focusInput&&this.refs.inputField.focusInput();},_inputChanged:function(ba){var ca=this._normalizeInput(ba.target.value),da=this.props.tags.filter(function(ea){return ea.name.indexOf(ca)===0;});z(ba.target.value);this.setState({input:ba.target.value,tagChosen:false,applicableTags:da,isScrolling:false});},_normalizeInput:function(ba){return ba.trim().replace(/\s+/,' ').toLowerCase();},reset:function(){this.setState(this.getInitialState());},renderContentArea:function(){if(this.state.tagChosen||this._normalizeInput(this.state.input).length>1){return this.renderStickers();}else return this.renderTags();},render:function(){return (k.createDescriptor(k.DOM.div,{className:(("_217a")+(this.state.isScrolling?' '+"_1hg1":''))},k.createDescriptor(k.DOM.div,{className:"_5jdr"},k.createDescriptor(k.DOM.span,{className:"_5jds"}),k.createDescriptor(r,{onChange:this._inputChanged,ref:"inputField",placeholder:"Search Stickers",value:this.state.input}),k.createDescriptor(q,{size:"small",onClick:this.reset,className:((this.state.input.length===0?"hidden_elem":''))})),this.renderContentArea()));},_capitalizeWords:function(ba){var ca=ba.split(" ");for(var da=0;da<ca.length;da++){var ea=ca[da].charAt(0).toUpperCase();ca[da]=ea+ca[da].substr(1);}return ca.join(" ");},selectTag:function(ba){g.log('StickersLoggerConfig',{event:'select_tag',tagid:ba.id});this.setState({tagChosen:true,applicableTags:[ba],input:this._capitalizeWords(ba.name)});this._focusInput();},selectTrigger:function(ba){if(ba!==null){var ca=n.getTagByName(ba);this.setState({tagChosen:true,applicableTags:[ca],input:this._capitalizeWords(ca.name)});this.props.resetTrigger();}},_onScroll:function(ba){this.setState({isScrolling:ba});},renderStickers:function(){var ba=this._normalizeInput(this.state.input);return (k.createDescriptor(m,{ref:"selector",height:w-y,userInput:ba,tags:this.state.applicableTags,onScroll:this._onScroll}));},renderTags:function(){var ba=this.props.tags.filter(function(ca){return ca.is_featured&&ca.sourceURI!==null;}).sort(function(ca,da){return ca.order-da.order;}).map(function(ca,da){return k.createDescriptor(v,{key:da},k.createDescriptor(k.DOM.div,{className:(("_t5c")+(da<2?' '+"_1b27":'')+(da%2===0?' '+"_t5d":'')+(da%2!==0?' '+"_t5e":''))},k.createDescriptor(p,{image:k.createDescriptor(l,{src:ca.sourceURI}),label:ca.name,onClick:this.selectTag.bind(this,ca),className:"_5jdu",style:{background:'#'+ca.color_code},disabled:this._normalizeInput(this.state.input).length===1})));}.bind(this));return (k.createDescriptor(i,{height:w-y,width:x-16,shadow:true,fade:true,className:"_5jei"},k.createDescriptor(h,{spacing:"pas",cols:2,fixed:true,ref:"grid"},ba)));}});e.exports=aa;},null);
__d("StickersFlyout.react",["BanzaiLogger","MercuryConfig","Event","Keys","MessagesEmoticons.react","Parent","React","StickersFlyoutPackSelector.react","StickersFlyoutStickerSelector.react","StickerActions","StickerConstants","StickersFlyoutTagSelector.react","StickerSearch","StickerState","SubscriptionsHandler","Toggler","XUISpinner.react","arrayContains","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){'use strict';var z=m.createClass({displayName:'StickersFlyout',propTypes:{isComments:m.PropTypes.bool,onStickerSelect:m.PropTypes.func.isRequired,onEmoticonSelect:m.PropTypes.func,onShown:m.PropTypes.func,onHidden:m.PropTypes.func,onEscKeyDown:m.PropTypes.func,onPackSelect:m.PropTypes.func,packID:m.PropTypes.string,shown:m.PropTypes.bool,trigger:m.PropTypes.string},getDefaultProps:function(){return {isComments:false,packID:t.getTrayPackID(),shown:false,trigger:null};},getInitialState:function(){return {dataReady:false,numNewPacks:0};},componentDidMount:function(){if(h.LoadStickerEarly&&!this.state.dataReady)this.loadTrayData();var aa=l.byClass(this.getDOMNode(),'uiToggle');this._subscriptions=new u();if(aa){this._subscriptions.addSubscriptions(v.listen('show',aa,function(){g.log('StickersLoggerConfig',{event:'open_tray'});if(!h.LoadStickersEarly&&!this.state.dataReady)this.loadTrayData();this.props.onShown&&this.props.onShown();}.bind(this)),v.listen('hide',aa,function(){this.resetTagSelector();this.props.onHidden&&this.props.onHidden();}.bind(this)));}else if(!h.LoadStickersEarly&&this.props.shown&&!this.state.dataReady)this.loadTrayData();this._subscriptions.addSubscriptions(i.listen(this.getDOMNode(),'keydown',this._onKeyDown),t.addListener(t.PACKS_CHANGED,this.packsUpdated),t.addListener(t.NUM_NEW_PACKS_CHANGED,function(ba){this.setState({numNewPacks:ba});}.bind(this)));},componentWillUnmount:function(){this._subscriptions.release();},componentWillReceiveProps:function(aa){if(!this.state.dataReady&&aa.shown)this.loadTrayData();if(this.props.shown&&!aa.shown)this.resetTagSelector();},componentDidUpdate:function(aa){if(!aa.shown&&this.props.shown){g.log('StickersLoggerConfig',{event:'open_tray'});var ba=this.props.packID!==q.SEARCH_PACK_ID;this.props.onShown&&this.props.onShown(ba);}else if(aa.shown&&!this.props.shown)this.props.onHidden&&this.props.onHidden();if(this.props.packID&&this.props.packID!=aa.packID)g.log('StickersLoggerConfig',{event:'select_pack',packid:this.props.packID});},_onKeyDown:function(event){if(event.keyCode===j.ESC&&this.props.onEscKeyDown){this.props.onEscKeyDown();event.kill();}},resetTagSelector:function(){this.refs.tagSelector&&this.refs.tagSelector.reset();},loadTrayData:function(){t.onTrayDataReady(function(){var aa=t.getNumNewPacks();this.setState({dataReady:true,numNewPacks:aa,tags:s.getTags()});var ba=t.getPacksInTray()[0].id,ca=this.props.packID;if(!ca||!x(t.getPackIDsInTray(),ca))p.selectPack(ba);}.bind(this));},loadPack:function(){if(!this.state.dataReady)return (m.createDescriptor(m.DOM.div,{className:"_e0r"},m.createDescriptor(w,{size:"large"})));if(this.props.packID==='emoticons')return (m.createDescriptor(m.DOM.div,{className:"_5r8l",'data-id':this.props.packID},m.createDescriptor(k,{onEmoticonSelect:this.props.onEmoticonSelect})));if(this.props.packID===q.SEARCH_PACK_ID&&h.WebStickerSearch)return (m.createDescriptor(m.DOM.div,{className:"_5r8l"},m.createDescriptor(r,{ref:"tagSelector",tags:this.state.tags,className:"fbStickersFlyoutTagSelector",trigger:this.props.trigger,resetTrigger:function(){return this.setProps({trigger:null});}.bind(this)})));return (m.createDescriptor(m.DOM.div,{className:"_5r8l",'data-id':this.props.packID},m.createDescriptor(o,{ref:"selector",packID:this.props.packID})));},packsUpdated:function(){var aa=t.getPackIDsInTray();if(!x(aa,this.props.packID)){p.selectPack(aa[0]);return;}this.forceUpdate(null);},selectedSticker:function(event){var aa=l.byClass(event.target,"_5r8h");if(aa){var ba=aa.getAttribute('data-id');t.updateRecentlyUsed(ba);this.props.onStickerSelect(ba,event);t.clearShowStickerReplyNUX();}},render:function(){var aa=this.props.isComments?t.getPacksInCommentsTray():t.getPacksInTray();return (m.createDescriptor(m.DOM.div,{className:"_5r8f"},m.createDescriptor(m.DOM.div,{className:"_5r8e",tabIndex:"0"},m.createDescriptor(n,{numNewPacks:this.state.numNewPacks,onPackClick:this.props.onPackSelect,selectedPackID:this.props.packID,packs:aa,resetTagSelectorFunc:this.resetTagSelector})),m.createDescriptor(m.DOM.div,{className:"_5r8m",onClick:this.selectedSticker},this.loadPack())));}});e.exports=z;},null);
__d("ChatStickerButton.react",["React","ReactLayeredComponentMixin","StickerContextualDialog.react","StickersFlyout.react","StickerState","cx","emptyFunction","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';var o=278,p=g.createClass({displayName:'ChatStickerButton',propTypes:{onStickerSelect:g.PropTypes.func,onEmoticonSelect:g.PropTypes.func,onFlyoutShown:g.PropTypes.func,onFlyoutHidden:g.PropTypes.func,packID:g.PropTypes.string,shown:g.PropTypes.bool},mixins:[h],getDefaultProps:function(){return {onStickerSelect:m,onEmoticonSelect:m,shown:false};},componentDidMount:function(){this._subscription=k.addListener(k.PACK_SELECTED,function(q){return this.setProps({packID:q});}.bind(this));},shouldComponentUpdate:function(q,r){return (q.packID!=this.props.packID||q.shown!=this.props.shown);},componentWillUnmount:function(){this._subscription&&this._subscription.remove();},render:function(){return (g.createDescriptor(g.DOM.a,{className:"_4vuh",onClick:this._showFlyout,onMouseDown:this._prepareForClick,title:"Choose a sticker or emoticon",ref:"link"},g.createDescriptor(g.DOM.div,{className:(("_4vui")+(this.props.shown?' '+"open":''))})));},renderLayers:function(){return {contextualDialog:g.createDescriptor(i,{alignment:"left",className:"_5e-r",contextRef:"link",onBlur:this._hideFlyout,position:"above",shown:this.props.shown,width:o},g.createDescriptor(g.DOM.div,null,g.createDescriptor(j,{onShown:function(q){return this.props.onFlyoutShown&&this.props.onFlyoutShown(q);}.bind(this),onHidden:function(){return this.props.onFlyoutHidden&&this.props.onFlyoutHidden();}.bind(this),onEscKeyDown:this._hideFlyout,onStickerSelect:this._handleStickerSelected,onEmoticonSelect:this._handleEmoticonSelected,packID:this.props.packID,shown:this.props.shown})))};},_prepareForClick:function(){this._clickGuard=this.props.shown;},_showFlyout:function(){!this._clickGuard&&this.setProps({shown:true});},_hideFlyout:function(){this.setProps({shown:false});},_handleStickerSelected:function(q){this.props.onStickerSelect(q);},_handleEmoticonSelected:function(q){this._hideFlyout();this.props.onEmoticonSelect(q);}});e.exports=p;},null);
__d("loadImage",[],function(a,b,c,d,e,f){"use strict";function g(h,i){var j=new Image();j.onload=function(){i(j.width,j.height,j);};j.src=h;}e.exports=g;},null);
__d("PhotoResizeMath",[],function(a,b,c,d,e,f){var g={getScaledPhotoDimensions:function(h,i,j,k,l){var m=h/i,n=j/k;if(j&&k&&l==='stretch')return {width:j,height:k};if((!j&&k)||((l==='contain')!==(m>=n)))return {width:k*m,height:k};if(j)return {width:j,height:j/m};return {width:h,height:i};}};e.exports=g;},null);
__d("PixelzFocus",[],function(a,b,c,d,e,f){"use strict";var g={search:function(h,i){var j=0,k=h.length-1;while(j<=k){var l=j+Math.floor((k-j)/2),m=h[l];if(m>i){k=l-1;}else if(m<i){j=l+1;}else return l;}return Math.min(j,k);},forceSpecificPoint:function(h,i,j){var k=1e-09,l=g.search(h,i-j-k)+1,m=g.search(h,i+j);return h.slice(l,m+1);},findBiggestSets:function(h,i){var j=[],k=-1;for(var l=0;l<h.length;++l){var m=h[l],n=l,o=g.search(h,m+i),p=o-n;if(p>k)j=[];if(p>=k){k=p;j.push({low:n,high:o});}}return j;},getBestSet:function(h,i,j){var k=-1,l=null;for(var m=0;m<i.length;++m){var n=i[m],o=h[n.low],p=h[n.high],q=o+(p-o)/2,r=Math.min(o-(q-j),(q+j)-p);if(r>k){k=r;l=n;}}return l;},getFocusFromSet:function(h,i){var j=h[i.low],k=h[i.high];return j+(k-j)/2;},clampFocus:function(h,i){var j=i/2,k=1-(i/2);if(h<j)return j;if(h>k)return k;return h;},convertFromCenterToCSS:function(h,i){if(Math.abs(1-i)<1e-05)return 0;return (h-i/2)/(1-i);},convertFromCSSToCenter:function(h,i){return h*(1-i)+i/2;},getVisible:function(h,i){if(h<i)return h/i;return i/h;},getHidden:function(h,i){return 1-g.getVisible(h,i);},focusHorizontally:function(h,i){return h<i;},convertVectorFromCenterToCSS:function(h,i,j){var k=g.focusHorizontally(i,j),l;if(k){l=h.x/100;}else l=h.x/100;var m=g.convertFromCenterToCSS(l,g.getVisible(i,j));if(k){return {x:m,y:0};}else return {x:0,y:m};},getCropRect:function(h,i,j){var k=g.focusHorizontally(i,j),l=g.getVisible(i,j);if(k){var m=(1-l)*h.x;return {left:m,top:0,width:l,height:1};}else{var n=(1-l)*h.y;return {left:0,top:n,width:1,height:l};}}};e.exports=g;},null);
__d("SplitImage.react",["React","Image.react","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j){var k=g.createClass({displayName:'SplitImage',render:function(){var l=this.props.size;return (g.createDescriptor(g.DOM.div,Object.assign({},this.props,{className:j(this.props.className,"_55lt"),style:Object.assign({},(this.props.style||{}),{width:l,height:l})}),this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;var l=this.props.srcs,m=Array.isArray(l);if(!m||l.length==1)return this.renderOne(m?l[0]:l);return l.length==2?this.renderTwo(l):this.renderThree(l);},renderOne:function(l){return (g.createDescriptor(h,{src:l,width:this.props.size,height:this.props.size,alt:""}));},renderTwo:function(l){var m=this.props.size,n=Math.floor(m/2),o=-Math.floor(n/2),p=(("_55lu")+(this.props.border?' '+"_57xo":''));return (g.createDescriptor(g.DOM.div,null,g.createDescriptor(g.DOM.div,{className:"_55lu",style:{width:n}},g.createDescriptor(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createDescriptor(g.DOM.div,{className:p,style:{width:n}},g.createDescriptor(h,{src:l[1],width:m,height:m,style:{marginLeft:o}}))));},renderThree:function(l){var m=this.props.size,n=Math.floor(m/3*2),o=-Math.floor((m-n)/2),p=Math.floor(m/2),q=m-n,r=-Math.floor((p-q)/2),s=(("_55lu")+(this.props.border?' '+"_57pl":'')),t=(("_55lu")+(this.props.border?' '+"_57pm":''));return (g.createDescriptor(g.DOM.div,null,g.createDescriptor(g.DOM.div,{className:s,style:{width:n}},g.createDescriptor(h,{src:l[0],width:m,height:m,style:{marginLeft:o}})),g.createDescriptor(g.DOM.div,{className:t,style:{width:q,height:p}},g.createDescriptor(h,{src:l[1],width:p,height:p,style:{marginLeft:r}})),g.createDescriptor(g.DOM.div,{className:"_55lu",style:{width:q,height:p}},g.createDescriptor(h,{src:l[2],width:p,height:p,style:{marginLeft:r}}))));}});e.exports=k;},null);
__d("MercuryThreadImage.react",["MercuryParticipants","MercuryParticipantsConstants","Pixelz.react","React","SplitImage.react"],function(a,b,c,d,e,f,g,h,i,j,k){'use strict';var l=j.createClass({displayName:'MercuryThreadImage',propTypes:{thread:j.PropTypes.object.isRequired,viewer:j.PropTypes.string.isRequired},getInitialState:function(){return {participantImages:[]};},componentDidMount:function(){this._getParticipantImages(this.props);},componentWillReceiveProps:function(m,n){this._getParticipantImages(m);},render:function(){if(this.props.thread.image_src)return (j.createDescriptor(i,{height:h.BIG_IMAGE_SIZE,resizeMode:'cover',src:this.props.thread.image_src,width:h.BIG_IMAGE_SIZE}));if(this.state.participantImages.length>0)return (j.createDescriptor(k,{srcs:this.state.participantImages,border:true,size:h.BIG_IMAGE_SIZE}));return null;},_getParticipantImages:function(m){var n=m.thread,o=m.viewer;if(n.image_src)return;var p=g.getIDForUser(o),q=n.participants.filter(function(s){return s!=p;}),r=[];if(!q.length){r=[p];}else if(q.length==1){r=q;}else r=q.slice(0,3);g.getOrderedBigImageMulti(r,function(s){this.isMounted()&&this.setState({participantImages:s});}.bind(this));}});e.exports=l;},null);
__d("WebMessengerPermalinkConstants",["URI"],function(a,b,c,d,e,f,g){var h={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:'(archived|other|spam|new|search|conversation-.*)',getURIPathForThreadID:function(i,j){return (j||h.BASE_PATH)+h.TID_POSTFIX_PARTIAL_PATH+g.encodeComponent(g.encodeComponent(i));},getThreadIDFromURI:function(i){var j=i.getPath().match(h.BASE_PATH+'(/[^/]*)*'+h.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(j){var k=g.decodeComponent(g.decodeComponent(j[2]));return k;}},getURIPathForIDOrVanity:function(i,j){if(i.match('^'+h.overriddenVanities+'$'))i='.'+i;return (j||h.BASE_PATH)+'/'+i;},getUserIDOrVanity:function(i){var j=i.match(h.BASE_PATH+'.*/([^/]+)/?$'),k=j&&j[1],l=h.overriddenVanities;if(!k||k.match('^'+l+'$')){return false;}else if(k.match('^\\.'+l+'$')){return k.substr(1);}else return k;}};e.exports=h;},null);
__d("MercuryThreadMetadataRawRenderer",["Event","CSS","DOM","MercuryActionStatus","MercuryErrorInfo","MessagingTag","MercuryStatusTemplates","Tooltip","URI","WebMessengerPermalinkConstants","WWWBase","cx","tx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u={renderParticipantListWithNoThreadName:function(w,x,y,z,aa,ba){var ca={callback:true,check_length:true,show_unread_count:true};ba=ba||{};var da={};for(var ea in ba)if(ca[ea]){da[ea]=ba[ea];delete ba[ea];}var fa=y.map(function(ka){return z[ka];}),ga=this.renderRawParticipantList(w,fa,y.length,ba);ga=this.renderRawTitleWithUnreadCount(ga,da.show_unread_count?x.unread_count:0);var ha=ba.abbr_mode,ia={};for(var ja in ba)ia[ja]=ba[ja];ia.abbr_mode=true;aa.forEach(function(ka){var la=aa.length>1?this._cloneIfDOMElement(ga):ga;i.setContent(ka,la);if(da.check_length&&!ha&&ka.scrollWidth>ka.clientWidth){var ma=this.renderRawParticipantList(w,fa,y.length,ia),na=this.renderRawTitleWithUnreadCount(ma,da.show_unread_count?x.unread_count:0);i.setContent(ka,na);}}.bind(this));da.callback&&da.callback(ga);},renderRawParticipantList:function(w,x,y,z){var aa={abbr_mode:true,last_separator_uses_and:true,names_renderer:true};z=z||{};var ba=null;if(z.names_renderer){ba=z.names_renderer(x);}else ba=x.map(function(ea){return ea.name;});var ca=null;if(ba.length===0){if(!w){ca="New Message";}else ca="No Participants";}else if(ba.length==1){ca=ba[0];}else if(ba.length==2){var da={participant1:ba[0],participant2:ba[1]};if(z.last_separator_uses_and){ca=s._("{participant1} and {participant2}",da);}else ca=s._("{participant1}, {participant2}",da);}else if(z.last_separator_uses_and){if(z.abbr_mode){ca=s._("{participant1} and {others_link}",{participant1:ba[0],others_link:this.renderRawParticipantCount(w,{render_subset:true,count:y-1})});}else if(ba.length==3){ca=s._("{participant1}, {participant2} and {participant3}",{participant1:ba[0],participant2:ba[1],participant3:ba[2]});}else ca=s._("{participant1}, {participant2} and {others_link}",{participant1:ba[0],participant2:ba[1],others_link:this.renderRawParticipantCount(w,{render_subset:true,count:y-2})});}else if(ba.length==3){ca=s._("{participant1}, {participant2}, {participant3}",{participant1:ba[0],participant2:ba[1],participant3:ba[2]});}else ca=s._("{participant1}, {participant2}, {participant3}, {others_link}",{participant1:ba[0],participant2:ba[1],participant3:ba[2],others_link:this.renderRawParticipantCount(w,{render_subset:true,count:y-3})});if(Array.isArray(ca))ca=i.create('span',{},ca);return ca;},renderRawTitleWithUnreadCount:function(w,x){var y=w;if(x&&x>1)y=i.create('span',{},s._("{conversation_title} ({unread_count})",{conversation_title:w,unread_count:x}));return y;},renderRawParticipantCount:function(w,x){var y=x.render_subset,z;if(!y){z=x.count>1?s._("{num} people",{num:x.count}):"1 person";}else z=x.count>1?s._("{others_count} others",{others_count:x.count}):"1 other";return z;},renderShortNames:function(w){if(w.length==1)return [w[0].name];return w.map(function(x){return x.short_name;});},getUserCanonicalWebMessengerURL:function(w,x,y){var z=new o(q.uri),aa=w.substr(w.indexOf(':')+1);z.setPath(v(y)+'/'+aa);x&&x(z.toString());return z.toString();},getWebMessengerURLWithServerID:function(w,x,y){var z=new o(q.uri);z.setPath(p.getURIPathForThreadID(w,v(y)));x&&x(z.toString());return z.toString();},renderUserCanonicalWebMessengerLink:function(w,x,y,z){var aa=this.getUserCanonicalWebMessengerURL(w,null,z);x.setAttribute('href',aa);y&&y();},renderWebMessengerLinkWithServerID:function(w,x,y,z){var aa=this.getWebMessengerURLWithServerID(w,null,z);x.setAttribute('href',aa);y&&y();},renderStatusIndicator:function(w,x,y){var z;if(w==j.RESENDING){z=this.renderResendIndicator();}else if(w!==undefined&&w!=j.UNSENT&&w!=j.UNCONFIRMED&&w!=j.SUCCESS)z=this.renderErrorIndicator(x,y);return z;},renderResendIndicator:function(){return m[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function(w,x){if(!w)return null;var y=m[':fb:mercury:error-indicator'].render(),z=w.is_transient,aa=k.getMessage(w);if(z)if(k.isConnectionError(w)){aa=t._("{message} Check your internet connection and click to try again.",[t.param("message",aa)]);}else aa=t._("{message} Click to send again.",[t.param("message",aa)]);n.set(y,aa,'above','center');if(x&&z){g.listen(y,'click',x);y.setAttribute('tabindex','0');h.addClass(y,"_55q-");}return y;},_cloneIfDOMElement:function(w){if(w&&w.cloneNode){return w.cloneNode();}else return w;}};function v(w){var x=p.BASE_PATH;if(w&&w!=l.INBOX)x+='/'+w;return x;}e.exports=u;},null);
__d("MercuryRoger",["Arbiter","ArbiterMixin","JSLogger","MercuryActionStatus","copyProperties","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get(),n={},o=[],p={getSeenBy:function(q,r){if(!q)return [];var s=[],t=n[q.thread_id],u=j.SUCCESS;for(var v in t)if(t[v]>q.timestamp&&(q.status===undefined||q.status===u)&&(!r||v!=q.author))s.push(v);return s;},getSeenTimestamp:function(q,r){var s=n[q];return s?s[r]:null;}};k(p,h);l.subscribe('update-roger',function(q,r){for(var s in r){if(!n[s])n[s]={};for(var t in r[s]){var u=m.getThreadMetaNow(s);if(u&&u.participants)if(u.participants.indexOf(t)==-1){o.push(n);continue;}var v=n[s][t],w=r[s][t];if(!v||w>v)n[s][t]=w;}}if(r)p.inform('state-changed',r);});g.subscribe(i.DUMP_EVENT,function(q,r){r.bad_read_receipts={receipts:o};});e.exports=p;},null);
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryRoger","copyProperties","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b('MercuryMessages').get(),o=b('MercuryThreadInformer').get(),p=b('MercuryThreads').get(),q={},r={},s=j['roger.seen_delay'],t=l({getSeenBy:function(x,y){if(r[x])return [];if(!q[x]){var z=p.getThreadMetaNow(x);if(z)q[x]={thread_id:x,author:z.participants[0],timestamp:z.timestamp};}return k.getSeenBy(q[x],y);}},g);function u(x){var y=false;n.getThreadMessagesRange(x,0,1,function(z){var aa=z[0];if(!aa)return;var ba=aa.timestamp;if(aa.action_id||aa.status==i.SUCCESS)ba-=h.getServerTimeOffset();var ca=t.getSeenBy(x);if(r[x]){clearTimeout(r[x]);delete r[x];}var da=ba+s,ea=da-Date.now();if(ea>0)r[x]=m(function(){delete r[x];v(x);},ea);q[x]=aa;var fa=t.getSeenBy(x);if(ca.length||fa.length)y=true;});return y;}function v(x){var y={};y[x]=true;t.inform('state-changed',y);}function w(event,x){var y={};for(var z in x)if(u(z))y[z]=true;for(var aa in y){t.inform('state-changed',y);break;}}k.subscribe('state-changed',function(x,y){for(var z in y)!r[z]&&v(z);});o.subscribe('messages-received',w);o.subscribe('messages-reordered',w);o.subscribe('messages-updated',w);e.exports=t;},null);
__d("MercurySeenByAll",["CSS","DataStore","DOM","MercuryParticipants","MercuryDelayedRoger","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryThreads').get(),m={},n={updateOnSeenChange:function(p,q,r){m[p.tagName]=true;h.set(p,'thread-id',q.thread_id);g.addClass(p,'seenByListener');o(p,q,r);}};function o(p,q,r){var s=null;if(r){s=j.getIDFromVanityOrFBID(r);}else s=j.user;var t=q.participants.filter(function(v){return v!==s;}),u=q.participants.length>0&&q.participants[0]===s;g.conditionClass(p,'repliedLast',u);g.conditionClass(p,'seenByAll',u&&k.getSeenBy(q.thread_id).length===t.length);}k.subscribe('state-changed',function(p,q){for(var r in m){var s=i.scry(document.body,r+'.seenByListener');for(var t=0;t<s.length;t++){var u=s[t],v=h.get(u,'thread-id');if(q[v])l.getThreadMeta(v,function(w){o(u,w);});}}});e.exports=n;},null);
__d("MercuryThreadMetadataRenderer",["CSS","DOM","Emoji","EmoticonsList","HTML","JSLogger","MercuryAttachment","MercuryAttachmentType","MercuryConstants","MercuryMessageSourceTags","MercurySingletonMixin","MercuryThreadImage.react","MercuryThreadMetadataRawRenderer","MercuryParticipants","React","MercurySeenByAll","MercuryServerRequests","StickerConstants","Style","MercuryThreadlistIconTemplates","MercuryThreads","Tooltip","URI","arrayContains","createArrayFrom","copyProperties","cx","emojiAndEmote","fbt","formatDate","tx","OrionMercuryAttachmentStrings"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka){var la=b('OrionMercuryAttachmentStrings').module,ma=l.create('wm_timestamp');function na(ua){this._fbid=ua;this._serverRequests=w.getForFBID(ua);this._threads=aa.getForFBID(ua);}fa(na,q);fa(na.prototype,{renderTimestamp:function(ua,va,wa,xa){if(xa){if(!va){ma.warn('no_title');va=(new Date(xa)).toLocaleDateString();}ua.setAttribute('title',va);ua.setAttribute('data-utime',xa/1000);if(!wa){ma.warn('no_display');wa=ja(new Date(xa),'g:ia');}h.setContent(ua,wa);g.show(ua);}},renderMessageSourceTags:function(ua,va,wa,xa){var ya='',za='',ab='';if(da(wa,p.MESSENGER)){ya="Sent from Messenger";za=new ca('/mobile/messenger');ab="_9g";}else if(da(wa,p.MOBILE)){ya="Sent from Mobile";za=new ca('/mobile/');ab="_9j";}else if(da(wa,p.CHAT)){ya="Sent from chat";ab="_9h";}else if(da(wa,p.EMAIL)){if(xa){ya=ka._("Sent from {email}",{email:xa});}else ya="Sent from email";ab="_9i";}if(ab){ba.set(ua,ya);g.addClass(va,ab);if(za){ua.setAttribute('href',za);}else ua.removeAttribute('href');}else g.hide(ua);},renderMessageLocation:function(ua,va,wa){var xa=ca('/ajax/messaging/hovercard/map.php').setQueryData(wa);ua.setAttribute('data-hovercard',xa);g.removeClass(ua,"_b9");g.show(va);},renderSpoofWarning:function(ua,va,wa){if(va){g.addClass(ua,"_sa");ba.set(ua,ka._("Unable to confirm {name_or_email} as the sender.",{name_or_email:wa.name}));}},renderChatSpoofWarning:function(ua,va,wa){if(va)h.appendContent(ua,ka._("Unable to confirm {name_or_email} as the sender.",{name_or_email:wa.name}));},renderCoreThreadlist:function(ua,va,wa,xa,ya){xa=xa||{};this.renderThreadImage(ua,va.getNode('image'));var za=va.getNode('accessibleName'),ab=[va.getNode('name')];if(za)ab.push(za);ta(this,ua,ab,xa);if(ua.folder&&ya)sa(va.getNode('folderBadge'),ua.folder);var bb=va.getNode('timestamp');this.renderTimestamp(bb,ua.timestamp_absolute,ua.timestamp_relative,ua.timestamp);this.renderSnippet(ua,va.getNode('snippet'));pa(va,ua);wa(va,ua);},renderAndSeparatedParticipantList:function(ua,va,wa){wa=wa||{};wa.last_separator_uses_and=true;this._threads.getThreadMeta(ua,function(xa){ta(this,xa,va,wa);}.bind(this));},renderSnippet:function(ua,va){var wa=false,xa=h.create('span');g.addClass(xa,'MercuryRepliedIndicator');h.appendContent(va,xa);v.updateOnSeenChange(xa,ua,this._fbid);var ya=ua.snippet;if(ya){if(ua.snippet_has_attachment)h.appendContent(va,h.create('span',{className:'MercuryAttachmentIndicator'}));if(ua.is_forwarded_snippet)h.appendContent(va,h.create('strong',{className:"_55q_"},"Forwarded Message:"));if(ya.substr(0,4)=='?OTR'){ya="[encrypted message]";}else ya=ya.replace(/\r\n|[\r\n]/g," ");ya=k(i.htmlEmojiAndEmote(ya));}else{if(ua.is_forwarded_snippet)h.appendContent(va,h.create('strong',{className:"_55q_"},"Forwarded Message"));if(ua.snippet_has_attachment&&ua.snippet_attachments&&ua.snippet_attachments.length){wa=true;ya=h.create('span');ra(this,ua,ya);}}var za=ua.participants.length;if(ua.is_subscribed)za--;if(!wa&&ua.snippet_sender&&t.getIDForUser(this._fbid)!=ua.snippet_sender&&za>1){t.get(ua.snippet_sender,function(ab){if(ab.short_name){h.appendContent(va,ka._("{name}: {conversation_snippet}",{name:ab.short_name,conversation_snippet:ya}));}else h.appendContent(va,ya);});}else h.appendContent(va,ya);},getWebMessengerURL:function(ua,va,wa){if(ua.substr(0,ua.indexOf(':'))=='user'){s.getUserCanonicalWebMessengerURL(ua,va,wa);}else this._serverRequests.getServerThreadID(ua,function(xa){s.getWebMessengerURLWithServerID(xa,va,wa);});},renderWebMessengerLink:function(ua,va,wa,xa){if(ua.substr(0,ua.indexOf(':'))=='user'){s.renderUserCanonicalWebMessengerLink(ua,va,wa,xa);}else this._serverRequests.getServerThreadID(ua,function(ya){s.renderWebMessengerLinkWithServerID(ya,va,wa,xa);});},renderThreadImage:function(ua,va){u.renderComponent(u.createDescriptor(r,{thread:ua,viewer:this._fbid}),va);},renderParticipantList:function(ua,va,wa,xa){return s.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(ua),va,wa,xa);},renderThreadNameAndParticipantList:function(ua,va,wa,xa){var ya=s.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(ua),va,wa,xa),za=this._threads.getThreadMetaNow(ua);if(!za.name)return ya;return ka._("{conversation_name} [with {participant_list}]",{conversation_name:za.name,participant_list:ya});},renderParticipantCount:function(ua,va){return s.renderRawParticipantCount(this._serverRequests.getServerThreadIDNow(ua),va);}});function oa(ua){if(!ua.snippet_attachments)return [];return ua.snippet_attachments.filter(function(va){return va.attach_type===n.PHOTO;});}function pa(ua,va){var wa=oa(va);if(wa.length===0)return;var xa=wa[0].thumbnail_url;if(!xa)return;var ya=(wa.length==1)?'snippet-thumbnail-single':'snippet-thumbnail-multiple',za=ua.getNode(ya);if(!za)return;var ab=h.find(za,'i');y.set(ab,'background-image','url('+xa+')');g.show(za);}function qa(ua){return ua==x.LIKE_STICKER_ID||ua==x.HOT_LIKE_SMALL_STICKER_ID||ua==x.HOT_LIKE_MEDIUM_STICKER_ID||ua==x.HOT_LIKE_LARGE_STICKER_ID;}function ra(ua,va,wa){var xa=va.snippet_sender&&t.getIDForUser(ua._fbid)==va.snippet_sender,ya=function(hb){if(!va.snippet_sender||xa){hb(null);return;}t.get(va.snippet_sender,function(ib){hb(ib.short_name);});},za=o.MercurySupportedShareType.FB_ORION,ab=oa(va),bb=ab.length==va.snippet_attachments.length,cb=va.snippet_attachments.length===1&&va.snippet_attachments[0].attach_type===n.VIDEO,db=va.snippet_attachments.length===1&&va.snippet_attachments[0].metadata&&va.snippet_attachments[0].metadata.type=='fb_voice_message',eb=va.snippet_attachments.length===1&&va.snippet_attachments[0].attach_type===n.STICKER,fb=va.snippet_attachments.length===1&&va.snippet_attachments[0].attach_type===n.SHARE,gb=va.snippet_attachments.length===1&&va.snippet_attachments[0].share_data_type===za;ya(function(hb){var ib=null;if(bb){var jb=z[':fb:mercury:attachment-icon-text'].build().getRoot();if(ab.length===1){ib=xa?"You sent a photo.":ka._("{name} sent a photo.",{name:hb});}else ib=xa?ka._("You sent {num_photos} photos.",{num_photos:ab.length}):ka._("{name} sent {num_photos} photos.",{name:hb,num_photos:ab.length});g.addClass(jb,m.getAttachIconClass(ab[0].icon_type));h.appendContent(jb,ib);h.appendContent(wa,jb);}else if(cb){var kb=z[':fb:mercury:attachment-icon-text'].build().getRoot();if(xa){ib="You sent a video.";}else ib=ia._("{sender name} sent a video.",[ia.param("sender name",hb)]);g.addClass(kb,m.getAttachIconClass(va.snippet_attachments[0].icon_type));h.appendContent(kb,ib);h.appendContent(wa,kb);}else if(db){var lb=z[':fb:mercury:attachment-icon-text'].build().getRoot();ib=xa?"You sent a voice message.":ka._("{name} sent a voice message.",{name:hb});g.addClass(lb,m.getAttachIconClass(va.snippet_attachments[0].icon_type));h.appendContent(lb,ib);h.appendContent(wa,lb);}else if(eb){if(qa(va.snippet_attachments[0].metadata.stickerID)){ib=ha(j.symbols.like);}else ib=xa?"You sent a sticker.":ka._("{name} sent a sticker.",{name:hb});h.appendContent(wa,ib);}else if(gb){var mb=z[':fb:mercury:attachment-icon-text'].build().getRoot();ib=la.getOrionMercuryThreadAttachmentMetadataText(xa,hb);g.addClass(mb,m.getAttachIconClass(va.snippet_attachments[0].icon_type));h.appendContent(mb,ib);h.appendContent(wa,mb);}else if(fb){var nb=z[':fb:mercury:attachment-icon-text'].build().getRoot();if(xa){ib="You shared a link.";}else ib=ia._("{sender name} shared a link.",[ia.param("sender name",hb)]);g.addClass(nb,m.getAttachIconClass(va.snippet_attachments[0].icon_type));h.appendContent(nb,ib);h.appendContent(wa,nb);}else va.snippet_attachments.filter(function(ob){return ob.attach_type===n.FILE||ob.attach_type===n.PHOTO||ob.attach_type===n.VIDEO;}).forEach(function(ob){var pb=z[':fb:mercury:attachment-icon-text'].build().getRoot();h.appendContent(pb,ob.name);g.addClass(pb,m.getAttachIconClass(ob.icon_type));h.appendContent(wa,pb);});});}function sa(ua,va){ea(ua).forEach(function(wa){h.setContent(wa,va);});}function ta(ua,va,wa,xa){wa=ea(wa);if(va.name){var ya=s.renderRawTitleWithUnreadCount(va.name,xa.show_unread_count?va.unread_count:0);wa.forEach(function(ab){h.setContent(ab,ya);});xa.callback&&xa.callback(ya);return;}var za=va.participants;if(va.participants.length>1)za=va.participants.filter(function(ab){return ab!=t.getIDForUser(ua._fbid);});t.getMulti(za,function(ab){s.renderParticipantListWithNoThreadName(ua._serverRequests.getServerThreadIDNow(va.thread_id),va,za,ab,wa,xa);});}e.exports=na;},null);
__d("MercuryThreadMuter",["AsyncDialog","AsyncRequest","CurrentUser","DOM","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j){var k=b('MercuryThreads').get(),l={getUserIDEmail:function(){return i.getID()+'@facebook.com';},getThreadMuteSettingForUser:function(m){return m.mute_settings&&m.mute_settings[l.getUserIDEmail()];},isThreadMuted:function(m){return l.getThreadMuteSettingForUser(m)!==undefined;},showMuteChangeDialog:function(m){g.send(new h('/ajax/mercury/mute_thread_dialog.php'),function(n){n.subscribe('confirm',function(){this.hide();var o;j.scry(this.getRoot(),'input[type="radio"]').forEach(function(r){if(r.checked)o=r.value;});switch(o){case 'always':o=-1;break;case '1hour':o=3600;break;case '8am':var p=new Date(),q=new Date();q.setHours(8);q.setMinutes(0);q.setSeconds(0);if(q>p){o=q-p;}else o=q-p+(24*3600*1000);o/=1000;break;default:o=0;}k.updateThreadMuteSetting(m,o);}.bind(n));});}};e.exports=l;},null);
__d("ChatTabMenu.react",["ChatFileUploader.react","ChatPrivacyActionController","ChatConfig","MercuryConfig","MercuryThreadMuter","React","PopoverMenu.react","ReactMenu","MenuSeparator.react","Toggler","TrackingNodes","cx","fbt","goURI","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){'use strict';var u=b('MercuryThreadMetadataRenderer').get(),v=b('MercuryThreads').get(),w=n.Item,x=l.createClass({displayName:'ChatTabMenu',propTypes:{onFileUploaderMounted:l.PropTypes.func,updatePrivacyLinkFunc:l.PropTypes.func,nameConversationFunc:l.PropTypes.func,leaveConversationFunc:l.PropTypes.func,showParticipantsFunc:l.PropTypes.func,clearHistoryFunc:l.PropTypes.func,reportSpamFunc:l.PropTypes.func,createGroupFunc:l.PropTypes.func,isMultichat:l.PropTypes.bool,showAddFriend:l.PropTypes.func,threadID:l.PropTypes.string,attachmentsShelf:l.PropTypes.object,onUploadFinished:l.PropTypes.func,onUpdateAttachmentsShelf:l.PropTypes.func,onSubmit:l.PropTypes.func,enableDesktopNotif:l.PropTypes.func},getDefaultProps:function(){return {show:true};},componentWillMount:function(){if(!this.props.isMultiChat)this._privacyActionController=new h(v.getCanonicalUserInThread(this.props.threadID),this.props.updatePrivacyLinkFunc);},componentDidMount:function(){if(!this.props.fullURL){var y=this;u.getWebMessengerURL(this.props.threadID,function(z){y.setProps({fullURL:z});});}},componentWillUnmount:function(){this._privacyActionController&&this._privacyActionController.destroy();},_unmuteThread:function(){v.updateThreadMuteSetting(this.props.threadID,0);p.hide();},_renderFileUploader:function(){return (l.createDescriptor(w,{className:"_37_x"},l.createDescriptor(g,{onFileUploaderMounted:this.props.onFileUploaderMounted,attachmentsShelf:this.props.attachmentsShelf,onUploadFinished:this.props.onUploadFinished,onUpdateAttachmentsShelf:this.props.onUpdateAttachmentsShelf,onSubmit:this.props.onSubmit})));},_renderOpenFullConversation:function(){if(this.props.fullURL)return (l.createDescriptor(w,{onclick:function(){return t(this.props.fullURL);}.bind(this)},"See Full Conversation"));return null;},_renderAddFriend:function(){return (l.createDescriptor(w,{onclick:this.props.showAddFriend},"Add Friends to Chat..."));},_renderTogglePrivacy:function(){if(!this.props.isMultichat){var y=this._privacyActionController.togglePrivacy.bind(this._privacyActionController);return (l.createDescriptor(w,{onclick:y},this.props.privacyText));}return null;},_renderMuteConversation:function(){if(!this.props.isMuted){var y=k.showMuteChangeDialog.bind(null,this.props.threadID);return (l.createDescriptor(w,{onclick:y},"Mute Conversation..."));}else return (l.createDescriptor(w,{onclick:this._unmuteThread},"Unmute Conversation"));},_renderClearConversation:function(){if(!this.props.isMultichat)return (l.createDescriptor(w,{onclick:this.props.clearHistoryFunc},"Clear Window"));return null;},_renderReportSpam:function(){if(!this.props.isMultichat)return (l.createDescriptor(w,{onclick:this.props.reportSpamFunc},"Report as Spam or Abuse..."));return null;},_renderCreateGroup:function(){if(this.props.isMultichat&&i.get('group_create_multichat_dock'))return (l.createDescriptor(w,{onclick:this.props.createGroupFunc},"Create Group"));return null;},_renderConversationName:function(){if(this.props.isMultichat&&this.props.fullURL)return (l.createDescriptor(w,{onclick:this.props.nameConversationFunc},"Edit Conversation Name"));return null;},_renderLeaveConversation:function(){if(this.props.isMultichat)return (l.createDescriptor(w,{onclick:this.props.leaveConversationFunc},"Leave Conversation..."));return null;},_renderEnableDesktopNotifications:function(){if(j.DesktopNotificationsGK&&"Notification" in window&&Notification.permission!=="granted")return (l.createDescriptor(w,{onclick:this.props.enableDesktopNotif},"Enable Desktop Notifications"));return null;},_renderPeopleList:function(){if(this.props.isMultichat&&this.props.fullURL&&i.get('chat_remove_participants'))return (l.createDescriptor(w,{onclick:this.props.showParticipantsFunc},"Edit Participants..."));return null;},render:function(){var y=this._renderReportSpam(),z=this._renderCreateGroup(),aa=l.createDescriptor(n,{className:(("chatReact")+(!this.props.show?' '+"hidden_elem":''))},this._renderOpenFullConversation(),this._renderFileUploader(),this._renderAddFriend(),this._renderTogglePrivacy(),this._renderConversationName(),this._renderPeopleList(),l.createDescriptor(o,null),this._renderMuteConversation(),this._renderClearConversation(),this._renderLeaveConversation(),y?(l.createDescriptor(o,null)):null,y,z?(l.createDescriptor(o,null)):null,z,this._renderEnableDesktopNotifications()),ba="Options",ca=q.getTrackingInfo(q.types.DROPDOWN_BUTTON);return (l.createDescriptor(m,{menu:aa},l.createDescriptor(l.DOM.a,{'data-ft':ca,'data-hover':"tooltip",'aria-label':ba,'data-tooltip-alignh':"center",className:"button"})));}});e.exports=x;},null);
__d("MercuryAudioPlayer",["Event","Arbiter","DOM","Flash","UserAgent","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=200;function n(){if(k.webkit()&&!k.chrome())return false;var w=i.create('audio'),x=false;try{if(!!w.canPlayType)if(w.canPlayType('video/mp4;').replace(/^no$/,''))x=true;}finally{return x;}}function o(){return j.isAvailable();}var p=function(){this.interval=null;this.arbiterInstance=null;this.audio=i.create('audio');g.listen(this.audio,'playing',function(){this.informAttachment('playing',this.audio.currentTime);this.interval=setInterval(function(){this.informAttachment('playing',this.audio.currentTime);}.bind(this),m);}.bind(this));g.listen(this.audio,'ended',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};l(p.prototype,{setAudio:function(w,x){this.audio.setAttribute('src',w);this.arbiterInstance=x;},informAttachment:function(w,x){if(this.arbiterInstance)this.arbiterInstance.inform(w,x);},play:function(){this.audio.play();this.informAttachment('played');},resume:function(){this.audio.play();this.informAttachment('played');},pause:function(){this.audio.pause();clearInterval(this.interval);this.informAttachment('paused');},getType:function(){return 'html5';}});var q=function(){this.src=null;this.arbiterInstance=null;var w=i.create('div');document.body.appendChild(w);this.swf=j.embed('/swf/SoundStreamPlayer.swf',w,null,{});this.interval=null;h.subscribe('soundstream/finished',function(){clearInterval(this.interval);this.informAttachment('finished');}.bind(this));};l(q.prototype,{setAudio:function(w,x){this.src=w;this.arbiterInstance=x;},informAttachment:function(w,x){if(this.arbiterInstance)this.arbiterInstance.inform(w,x);},play:function(){this.swf.playSound(this.src);this.interval=setInterval(function(){var w=this.swf.getCurrentTime();this.informAttachment('playing',w);}.bind(this),m);this.informAttachment('played');},resume:function(){this.swf.resume();this.informAttachment('played');},pause:function(){clearInterval(this.interval);this.swf.pause();this.informAttachment('paused');},getType:function(){return 'flash';}});function r(){if(n()){return new p();}else if(o())return new q();return false;}var s=null,t=null,u=0;function v(w,x){this.src=w;this.arbiterInstance=x;this.audio_id=++u;s!==null||(s=r());if(!s)return false;}l(v.prototype,{getType:function(){if(!s){return false;}else return s.getType();},play:function(w){if(w&&t==this.audio_id){s.resume();}else{this.pause();t=this.audio_id;s.setAudio(this.src,this.arbiterInstance);s.play();}},pause:function(){s.pause();}});e.exports=v;},null);
__d("MercuryAttachmentAudioClip.react",["Arbiter","ArbiterMixin","MercuryAudioPlayer","CurrentUser","JSLogger","LeftRight.react","React","cx","shield","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q='MercuryAttachmentAudioClip/play',r=k.create('mercury_audio_clip'),s=m.createClass({displayName:'AudioClip',mixins:[h],getInitialState:function(){this.subscribe('playing',this.updateTime);this.subscribe('played',o(this.setState,this,{playing:true,started:true}));this.subscribe('paused',o(this.setState,this,{playing:false}));this.subscribe('finished',o(this.setState,this,{playing:false,started:false,time:this.props.duration}));this.logged=false;var t=this.props.downloadOnly?false:new i(this.props.src,this);g.subscribe(q,function(u,v){if(this.props.src!=v)this.setState({time:0});}.bind(this));return {time:0,playing:false,started:false,duration:this.props.duration,audioPlayer:t};},updateTime:function(t,u){this.setState({time:u});},play:function(){if(this.state.playing){this.state.audioPlayer.pause();}else{this.state.audioPlayer.play(this.state.started);g.inform(q,this.props.src);if(!this.logged){this.logged=true;r.log('play',{uid:j.getID(),duration:this.props.duration});}}},_formatSeconds:function(t){if(t){t=Math.ceil(t);var u=t%60;if(u<10)u='0'+u;var v=Math.floor(t/60);return v+':'+u;}else return null;},_renderPlayer:function(t,u){return (m.createDescriptor(m.DOM.a,{className:"_1miz",style:{width:t},onClick:this.play},m.createDescriptor(m.DOM.span,{className:"_1mi-"},m.createDescriptor(m.DOM.i,{className:"_1mi_"})),m.createDescriptor(m.DOM.span,{className:"_1mj0"},u),m.createDescriptor(m.DOM.div,{className:"_1mj1"})));},render:function(){var t=this.state.time,u=this.state.playing,v=this._formatSeconds(this.state.duration),w=this.props.width||170,x=null,y=Math.ceil((t*(w+2))/this.state.duration);if(this.state.audioPlayer&&this.state.audioPlayer.getType()){var z=this._renderPlayer(w,v),aa=this._renderPlayer(w,v),ba=(("_1mj2")+(u&&(t!==0)?' '+"_1mj3":'')+(u&&(t===0)?' '+"_4g4x":''));x=(m.createDescriptor(m.DOM.div,{className:ba},z,m.createDescriptor(m.DOM.div,{className:"_1mj4",style:{width:y}},aa)));}else x=(m.createDescriptor(m.DOM.div,{className:"_1mj2"},m.createDescriptor(m.DOM.div,{className:"_1miz"},m.createDescriptor(l,null,m.createDescriptor(m.DOM.a,{className:"_1mj5",href:this.props.src},m.createDescriptor(m.DOM.span,{className:"_3qi6"},m.createDescriptor(m.DOM.i,{className:"_1mj6"})),m.createDescriptor(m.DOM.span,{className:"_1mj7"},"Voice Message"),m.createDescriptor(m.DOM.span,{className:"_1mj8"},v)),m.createDescriptor(m.DOM.a,{href:this.props.src,className:"_1mj9"},m.createDescriptor(m.DOM.i,{className:"_1mja"}))))));return (m.createDescriptor(m.DOM.div,{className:"_1mjb"},x));}});e.exports=s;},null);
__d("ChatAnimatedGifs",["URI"],function(a,b,c,d,e,f,g){var h={shouldHideBody:function(i){if(!i.has_attachment)return false;for(var j=0;j<i.attachments.length;j++){var k=i.attachments[j];if(k.preview_url){var l=h.getRawUrlFromSafeUrl(k.preview_url);if(i.body==l)return true;}}return false;},getRawUrlFromSafeUrl:function(i){return g(i).getQueryData().url;}};e.exports=h;},null);
__d("XMessagingVideoAttachmentControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b('XControllerURIBuilder').create("\/mercury\/attachments\/video\/",{video_id:{type:"Int",required:true},window_width:{type:"Int",required:true}});},null);
__d("MercuryAttachmentVideo.react",["CroppedImage.react","Image.react","React","ReactPropTypes","XMessagingVideoAttachmentControllerURIBuilder","cx","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=i.createClass({displayName:'MercuryAttachmentVideo',propTypes:{duration:j.number.isRequired,name:j.string.isRequired,size:j.shape({height:j.number,width:j.number}),thumbnailSize:j.shape({height:j.number,width:j.number}),thumbnail:j.string,videoID:j.string},_formatDuration:function(){var o=this.props.duration,p=Math.floor(o/60),q=o%60;if(q<10)return p+':0'+q;return p+':'+q;},render:function(){var o=!!this.props.thumbnail,p=(("_zow")+(' '+"_59go")+(!o?' '+"_59gq":'')),q=((!o?"_3l6h":'')+(!o?' '+"uiIconText":'')),r=new k().setInt('video_id',this.props.videoID).setInt('window_width',document.body.clientWidth).getURI();if(this.props.thumbnail)return (i.createDescriptor(i.DOM.div,{className:p,style:this.props.size},i.createDescriptor(i.DOM.a,{className:q,href:r,role:"button",rel:"async"},i.createDescriptor(g,{crop:this.props.size,size:this.props.thumbnailSize,src:this.props.thumbnail}),i.createDescriptor(i.DOM.div,{className:"_zox"}),i.createDescriptor(i.DOM.div,{className:"_zoy"},i.createDescriptor(h,{src:m('/images/chat/chat_play_icon.png')})),i.createDescriptor(i.DOM.span,{className:"_zoz"},this._formatDuration()))));return (i.createDescriptor(i.DOM.div,{className:p},i.createDescriptor(i.DOM.a,{className:q,href:r,role:"button",rel:"async"},i.createDescriptor(h,{src:m('/images/icons/video.gif')}),i.createDescriptor(i.DOM.span,{className:"_59gp"},this.props.name))));}});e.exports=n;},null);
__d("MercuryAttachmentRenderer",["MercuryAttachmentTemplates","MercuryAttachmentAudioClip.react","Bootloader","ChatAnimatedGifs","SyncRequest.react","CSS","MercuryConstants","DOM","Event","JSXDOM","MercuryAttachment","MercuryAttachmentType","MercuryAttachmentVideo.react","MercuryParticipants","ProgressBar","React","Sticker.react","StickerAssetType","Style","URI","UserAgent","cx","endsWith","invariant","tx","updatePhotoProgressBar","XStickerAssetControllerURIBuilder","OrionMercuryAttachment","MercuryMessages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){"use strict";var ha=b('OrionMercuryAttachment').module,ia=b('MercuryMessages').get(),ja=aa.ie()<=8;function ka(na,oa){var pa=g[oa].build().setNodeContent('filename',na.name),qa=pa.getNode('link');qa.setAttribute('href',na.url);na.rel&&qa.setAttribute('rel',na.rel);l.addClass(pa.getRoot(),q.getAttachIconClass(na.icon_type));return pa;}function la(na,oa){var pa=g[oa].build().setNodeContent('filename',na.name);l.addClass(pa.getRoot(),q.getAttachIconClass(na.icon_type));return pa;}var ma={renderAttachment:function(na,oa,pa,qa,ra,sa){var ta=100,ua=na?160:400,va=null,wa=null,xa=m.MercurySupportedShareType;if(this.isErrorAttachment(oa))va=ma.renderError(oa);if(this.isShareAttachment(oa)&&oa.share_xhp)if(oa.share_data_type===xa.FB_BROWSE_QUERY||!na)wa=ma.renderShareXHP(oa,pa.id);if(this.isStickerAttachment(oa))wa=ma.renderSticker(oa,pa,na,sa);if(!wa&&this.isShareAttachment(oa)){var ya=oa.share_data_type;switch(ya){case xa.FB_PHOTO:wa=ma.renderPreview(oa,pa,qa,ra);break;case xa.FB_VIDEO:wa=ma.renderVideoThumb(oa);break;case xa.FB_MUSIC_ALBUM:case xa.FB_SONG:case xa.FB_PLAYLIST:case xa.FB_MUSICIAN:case xa.FB_RADIO_STATION:wa=ma.renderMusic(oa);break;case xa.EXTERNAL:case xa.FB_TEMPLATE:case xa.FB_SOCIAL_REPORT_PHOTO:wa=ma.renderExternalLink(oa);break;case xa.FB_COUPON:case xa.FB_EVENT:wa=ma.renderChatXHP(oa);break;case xa.FB_SOCIAL_RESOLUTION:case xa.FB_STATUS:wa=ma.renderSocialResolution(oa);break;case xa.FB_SYNC_REQUEST:wa=ma.renderSyncRequest(oa);break;case xa.FB_OPEN_GRAPH:wa=ma.renderOpenGraph(oa);break;case xa.FB_ORION:if(ha)wa=ma.renderOrionMercuryAttachment(oa);break;default:if(oa.name)wa=ma.renderShareLink(oa,pa&&pa.id,na);break;}}if(!wa&&oa.preview_loading)wa=ma.renderPreview(oa,pa,qa,ra);if(!wa&&this.isVideoAttachment(oa)){wa=n.create('div');v.renderComponent(ma.renderVideo(oa,na),wa);}if(!wa&&oa.preview_url)wa=ma.renderPreview(oa,pa,qa,ra);if(!wa&&this.isFileAttachment(oa))if(oa.metadata&&oa.metadata.type==m.MercuryAttachmentAudioClip){wa=n.create('div');var za=ma.renderAudioClip(oa,pa.message_id,ta,ua);v.renderComponent(za,wa);}else wa=na?ma.renderFileLink(oa):ma.renderExtendedFileLink(oa);return {error:va,content:wa,bubblePreferred:this.isBubblePreferred(oa)};},isBubblePreferred:function(na){return !this.isStickerAttachment(na)&&!this.isSyncRequestAttachment(na);},renderError:function(na){var oa=g[':fb:mercury:attachment:error'].build();n.appendContent(oa.getNode('error'),na.error_msg);return oa.getRoot();},renderSocialResolution:function(na){var oa=g[':fb:mercury:attachment:social-resolution'].build();oa.setNodeContent('post',na.share_xhp);return oa.getRoot();},renderChatXHP:function(na){var oa=g[':fb:mercury:attachment:social-resolution'].build();oa.setNodeContent('post',na.chat_xhp);return oa.getRoot();},renderOpenGraph:function(na){var oa=na.share_xhp.cloneNode(true);if(aa.firefox())y.set(oa,'minWidth','180px');return oa;},renderExternalLink:function(na){var oa=g[':fb:mercury:attachment:external-link'].build().setNodeContent('name',na.name);na.base_url&&oa.setNodeContent('shortLink',na.base_url);var pa=oa.getNode('preview'),qa=oa.getNode('image-link');qa.setAttribute('href',na.url);na.rel&&qa.setAttribute('rel',na.rel);if(na.preview_url){var ra=oa.getNode('preview-image'),sa=na.preview_url,ta=z(j.getRawUrlFromSafeUrl(sa));if(ca(ta.getPath(),'.gif')){sa=z('/animated.php').setSecure(true).setDomain('www.fbsbx.com').addQueryData('url',ta.toString());l.addClass(pa,"_dri");if(na.name&&na.name.__html==ta.toString())oa.setNodeContent('name','');}ra.setAttribute('src',sa);l.addClass(pa,na.preview_class);l.show(ra);}else{l.addClass(oa.getRoot(),'noMedia');l.hide(pa);}oa.getNode('name').setAttribute('href',na.url);d(['LinkshimHandler'],function(ua){ua.setUpLinkshimHandling(oa.getNode('name'));ua.setUpLinkshimHandling(oa.getNode('image-link'));});if(na.rel)oa.getNode('name').setAttribute('rel',na.rel);return oa.getRoot();},renderFileLink:function(na){var oa=null;if(na.url===''){oa=':fb:mercury:attachment:file-name';return la(na,oa).getRoot();}else{oa=':fb:mercury:attachment:file-link';return ka(na,oa).getRoot();}},renderAudioClip:function(na,oa,pa,qa){var ra=na.metadata.duration/1000,sa=200;if(pa&&qa)if(ra<5){sa=pa;}else sa=(1-Math.pow(10,(ra-5)/-30))*(qa-pa)+pa;return h({src:na.url,duration:na.metadata.duration/1000,showHelp:false,width:sa});},renderVideo:function(na,oa){var pa={height:na.preview_height,width:na.preview_width},qa=oa?{width:160,height:120}:{width:266,height:200};return s({duration:na.metadata.duration,name:na.name,size:qa,thumbnailSize:pa,thumbnail:na.thumbnail_url,videoID:na.metadata.fbid});},renderExtendedFileLink:function(na){var oa=null;if(na.url===''){oa=':fb:mercury:attachment:file-name';return la(na,oa).getRoot();}oa=':fb:mercury:attachment:extended-file-link';var pa=ka(na,oa);if(na.open_url){var qa=pa.getNode('openLinkContainer');l.show(qa);var ra=pa.getNode('openFile');ra.setAttribute('href',na.open_url);}var sa=pa.getNode('downloadFile');sa.setAttribute('href',na.url);na.rel&&sa.setAttribute('rel',na.rel);return pa.getRoot();},renderMusic:function(na){var oa=g[':fb:mercury:attachment:music'].build().setNodeContent('filename',na.name),pa=oa.getNode('link');pa.setAttribute('href',na.url);pa.setAttribute('target','_blank');na.rel&&pa.setAttribute('rel',na.rel);var qa=oa.getNode('image-link');qa.setAttribute('href',na.url);na.rel&&qa.setAttribute('rel',na.rel);var ra=oa.getNode('preview-image');ra.setAttribute('src',na.preview_url);l.show(ra);l.addClass(oa.getNode('icon_link'),'MercuryMusicIcon');return oa.getRoot();},renderSyncRequest:function(na){var oa=k(na.metadata),pa=n.create('div');v.renderComponent(oa,pa);return pa;},renderOrionMercuryAttachment:function(na){var oa=ha(na.metadata),pa=n.create('div');v.renderComponent(oa,pa);return pa;},resizeContain:function(na,oa){var pa=na.width/na.height,qa=oa.width/oa.height;if(qa<pa){return {width:Math.min(na.height*qa,oa.width),height:Math.min(na.height,oa.height)};}else return {width:Math.min(na.width,oa.width),height:Math.min(na.width/qa,oa.height)};},renderPreview:function(na,oa,pa,qa){var ra=g[':fb:mercury:attachment:preview'].build(),sa=ra.getNode('image-link');if(na){if(na.url){var ta=new z(na.url).getQueryData().uri;if(ta&&na.rel==='async'){sa.setAttribute('href',ta);sa.setAttribute('ajaxify',na.url);}else sa.setAttribute('href',na.url);}na.rel&&sa.setAttribute('rel',na.rel);var ua;if(na.preview_uploading){var va=ra.getNode('cancel-button-container');l.show(va);var wa=ra.getNode('cancel-button'),xa=o.listen(wa,'click',function(){na.upload_canceled(na.upload_id);l.hide(ra.getRoot());xa.remove();});na.on_success(function(event,eb){if(eb.upload_id==na.upload_id){l.hide(va);xa.remove();}});var ya=ra.getNode('progress-bar'),za=new u(ya),ab=ra.getNode('progress-bar-container');da(na.upload_id);na.on_progress(function(event,eb){if(eb.upload_id==na.upload_id){l.removeClass(ab,"_395w");l.show(ab);fa(za,eb.event);}});if(na.on_resizing_progress)na.on_resizing_progress(function(event,eb){if(eb.upload_id==na.upload_id){l.addClass(ab,"_395w");l.show(ab);za.setPosition(100*eb.event.written/eb.event.total);}});l.addClass(sa,"_57jm");if(pa>=176){ua='/images/photos/dots_large.png';}else if(pa>=86){ua='/images/photos/dots_medium.png';}else ua='/images/photos/dots_small.png';y.set(sa,'width',pa+'px');y.set(sa,'max-width',pa+'px');if(na.preview_width&&na.preview_height)y.set(sa,'padding-bottom',((na.preview_height/na.preview_width)*100)+'%');}else if(na.preview_loading){l.addClass(sa,"_5xdv");if(qa==='contain'&&na.preview_width&&na.preview_height){y.set(sa,'width',na.preview_width+'px');y.set(sa,'height',na.preview_height+'px');}if(qa==='cover'&&!ja)l.addClass(sa,"_55pj");}else if(na.metadata&&na.metadata.fbid){ua=z('/ajax/mercury/attachments/photo.php').addQueryData({fbid:na.metadata.fbid,request_user_id:na.metadata.pageid,mode:qa,width:pa,height:pa}).toString();var bb=sa.getAttribute('ajaxify');sa.removeAttribute('ajaxify');sa.removeAttribute('rel');o.listen(sa,'click',function(event){event.prevent();i.loadModules(["MessagesViewer"],function(eb){eb.bootstrapWithConfig({src:ua,endpoint:bb,fbid:na.metadata.fbid,dimensions:na.metadata.dimensions,disablePaging:oa&&oa.attachments.length==1},sa);});});}else ua=z(na.preview_url).addQueryData({mode:qa,width:pa,height:pa}).toString();var cb=ra.getNode('preview-image');if(ua){if(qa==='contain'&&na.preview_width&&na.preview_height){var db=ma.resizeContain({width:pa,height:pa},{width:na.preview_width,height:na.preview_height});cb.setAttribute('width',db.width);cb.setAttribute('height',db.height);}if(na.preview_uploading||(qa==='cover'&&!ja)){l.addClass(sa,"_55pj");y.set(sa,'backgroundImage','url('+ua+')');}else{cb.onload=function(){cb.removeAttribute('width');cb.removeAttribute('height');};cb.setAttribute('src',ua);}}if(oa)this.renderReportRespondLink(ra.getRoot(),na,oa.message_id);}return ra.getRoot();},renderShareLink:function(na,oa,pa){var qa=g[':fb:mercury:attachment:share-link'].build().setNodeContent('name',na.name),ra=qa.getNode('link');ra.setAttribute('href',na.url);na.rel&&ra.setAttribute('rel',na.rel);return qa.getRoot();},renderVideoThumb:function(na){var oa=g[':fb:mercury:attachment:video-thumb'].build(),pa=oa.getNode('thumb');pa.setAttribute('href',na.url);pa.setAttribute('rel',na.rel);var qa=n.find(oa.getRoot(),'img');qa.src=na.preview_url;return oa.getRoot();},renderShareXHP:function(na,oa){var pa=n.create('div');if(na){n.appendContent(pa,na.share_xhp);this.renderReportRespondLink(pa,na,oa);}return pa;},renderSticker:function(na,oa,pa,qa){var ra=pa?'chatScrolled/':'messengerScrolled/';ra+=oa.thread_id;var sa=n.create('div');l.addClass(sa,'stickerContainer');var ta=null;if(na.metadata.stickerID)ta=na.metadata.stickerID.toString();var ua=null;if(na.metadata.packID)ua=na.metadata.packID.toString();var va=new ga().setInt('sticker_id',ta),wa=null,xa=null;if(window.devicePixelRatio&&window.devicePixelRatio>1){xa=na.metadata.paddedSpriteURI2x;wa=na.metadata.spriteURI2x;}else{xa=na.metadata.paddedSpriteURI;wa=na.metadata.spriteURI;}var ya=w({animationTrigger:'hover',className:'mvs',frameCount:na.metadata.frameCount||1,frameRate:na.metadata.frameRate||83,framesPerCol:na.metadata.framesPerCol||1,framesPerRow:na.metadata.framesPerRow||1,onStickerClick:qa,packID:ua,paddedSpriteURI:xa,sourceHeight:na.metadata.height,sourceURI:va.setEnum('image_type',x.IMAGE).getURI().toString(),sourceWidth:na.metadata.width,spriteURI:wa,stickerID:ta,subscribedThreadID:ra});v.renderComponent(ya,sa);return sa;},renderReportRespondLink:function(na,oa,pa){if(!oa.is_social_report_attachment)return null;switch(oa.share_data_type){case m.MercurySupportedShareType.FB_PHOTO:break;case m.MercurySupportedShareType.FB_SOCIAL_REPORT_PHOTO:return null;default:return null;}var qa=null;if(pa)qa=ia.getMessagesFromIDs([pa])[0];if(!qa)return null;if(qa.author===t.user)return null;var ra=null;t.get(qa.author,function(sa){ra=n.create('a',{rel:'dialog-post',className:"_z6l",id:'respond-link',ajaxify:z('/ajax/report/social_resolution/post/').setQueryData({attachment_fbid:oa.attach_id,post_fbid:oa.shared_object_id,sender_id:t.getUserID(sa.id)}).toString()});n.setContent(ra,ea._("Respond to {name}'s request",{name:sa.name}));n.appendContent(na,ra);});},renderPhotoAttachments:function(na,oa,pa,qa){var ra=na.length;if(!ra)return null;var sa=p.div({className:"_55pk"});if(ra===1){var ta=ma.renderPreview(na[0],oa,pa,'contain');n.appendContent(sa,ta);return sa;}var ua=(ra==2||ra==4)?2:3,va=(pa-(ua-1)*qa)/ua,wa=Math.ceil(ra/ua),xa=wa*va+(wa-1)*qa,ya=(p.div({className:"_55pm",style:'padding-bottom: '+(xa/pa*100)+'%;'}));n.appendContent(sa,ya);for(var za=0;za<ra;++za){var ab=ma.renderPreview(na[za],oa,va,'cover'),bb=za%ua,cb=Math.floor(za/ua);l.addClass(ab,"_55pn");y.apply(ab,{width:(va/pa*100)+'%',left:((bb*(va+qa))/pa*100)+'%',top:((cb*(va+qa))/xa*100)+'%'});n.appendContent(ya,ab);}return sa;},isPhotoAttachment:function(na){return na.attach_type==r.PHOTO||(na.attach_type==r.FILE&&na.preview_url);},isVideoAttachment:function(na){return na.attach_type==r.VIDEO;},isShareAttachment:function(na){return na.attach_type==r.SHARE;},isFileAttachment:function(na){return na.attach_type==r.FILE;},isErrorAttachment:function(na){return na.attach_type==r.ERROR;},isStickerAttachment:function(na){return na.attach_type==r.STICKER;},isSyncRequestAttachment:function(na){var oa=m.MercurySupportedShareType;return this.isShareAttachment(na)&&na.share_data_type==oa.FB_SYNC_REQUEST;},booleanLexicographicComparator:function(na){return function(oa,pa){for(var qa=0;qa<na.length;++qa){var ra=na[qa](oa),sa=na[qa](pa);if(ra&&!sa){return -1;}else if(!ra&&sa)return 1;}return 0;};}};e.exports=ma;},null);
__d("ChatDateBreak.react",["React","ReactPropTypes","Timestamp.react","cx","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=g.createClass({displayName:'ChatDateBreak',propTypes:{date:h.instanceOf(Date).isRequired},shouldComponentUpdate:function(n){return this.props.date.getTime()!==n.date.getTime();},render:function(){var n=this.props.date,o=k(n,{today:'g:ia',withinWeek:'l g:ia',thisYear:'F jS, g:ia',older:'F j, Y g:i a'}),p=Math.round(n.getTime()/1000);return (g.createDescriptor(g.DOM.div,Object.assign({},this.props,{className:l(this.props.className,"_5w-5")}),g.createDescriptor(g.DOM.div,{className:"_5w-6"},g.createDescriptor(i,{time:p,verbose:o,text:o}))));}});e.exports=m;},null);
__d("ChatAuthorPhotoBlock.react",["MercuryParticipants","ReactPropTypes","React","cx","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=86400000,n=i.createClass({displayName:'ChatAuthorPhotoBlock',propTypes:{authorID:h.string.isRequired,hideName:h.bool,hidePhoto:h.bool,timestamp:h.number},getInitialState:function(){return {author:{id:null,name:'',href:'#',image_src:''}};},componentDidMount:function(){this.updateAuthor(this.props.authorID);},componentWillReceiveProps:function(o){if(o.authorID!=this.state.author.id)this.updateAuthor(o.authorID);},render:function(){return (i.createDescriptor(i.DOM.div,Object.assign({},this.props,{className:l(this.props.className,"_5yt9")}),this.renderAuthorName(),this.renderAuthorPhoto(),this.props.children));},renderAuthorName:function(){if(!this.props.hideName)return (i.createDescriptor(i.DOM.div,{className:"_5ys-",ref:"name"},this.state.author.name));},renderAuthorPhoto:function(){if(!this.props.hidePhoto){var o=null;if(this.props.timestamp){var p=(Date.now()-this.props.timestamp>m)?'M jS, g:ia':'g:ia';o=k(new Date(this.props.timestamp),p);}return (i.createDescriptor(i.DOM.a,{'aria-label':o,className:"_5ys_",'data-hover':"tooltip",'data-tooltip-position':"left",href:this.state.author.href,ref:"link"},i.createDescriptor(i.DOM.img,{src:this.state.author.image_src,ref:"image"})));}},updateAuthor:function(o){g.get(o,function(p){this.isMounted()&&this.setState({author:p});}.bind(this));}});e.exports=n;},null);
__d("DOMHyperlink",["Env","JSXDOM","TransformTextToDOMMixin","UntrustedLink","URI","URLScraper","isFacebookURI","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p={MAX_ITEMS:40,match:function(q,r){var s=l.match(q);if(!s)return false;var t=q.indexOf(s),u=t+s.length;return {startIndex:t,endIndex:u,element:this._element(s,r)};},_element:function(q,r){var s=q,t=s.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(q)))t='http://'+t;if(!k.isValidURI(t))return s;var u=h.a({className:"_553k",href:t,target:"_blank",rel:"nofollow"},s);if(r&&!m(k(t)))u.onmousedown=function(v){j.bootstrap(this,g.lhsh,v);};return u;}};e.exports=n(p,i);},null);
__d("MercuryMessageRenderer",["DOM","DOMEmoji","DOMEmote","DOMHyperlink","JSXDOM","transformTextToDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m={formatMessageBody:function(p,q,r){var s=(p||'').replace(/\s+$/,'');if(!q)return o(s,false,r);var t=Object.keys(q).map(function(w){return window.parseInt(w);}).sort(function(w,x){return w-x;}),u=[],v=0;t.forEach(function(w){var x=s.slice(v,w);if(x)u.push(o(x,false,r));v=w+q[w].length;var y=s.slice(w,v);if(y)u.push(o(y,true,r));});if(v<s.length)u.push(o(s.slice(v),false,r));return u.length===0?null:u.length===1?u[0]:g.create('span',{},u);}};function n(p,q){var r=p.replace(/\r\n?/g,'\n').split(/\n{2,}/);return r.filter(function(s){return s.length;}).map(function(s){return k.p(null,q(s));});}function o(p,q,r){if(p.length===0&&!q)return null;var s=function(t){return l(t,[j.params(true),h,i]);};return (k.span({className:q?'highlight':null},r?n(p,s):s(p)));}e.exports=m;},null);
__d("ChatBubble.react",["DOM","DOMDimensions","MercuryMessageRenderer","ReactPropTypes","React","cx","fbt","startsWith","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=null,q=k.createClass({displayName:'ChatBubble',propTypes:{attachments:j.renderable,body:j.string,maxWidth:j.number.isRequired},getInitialState:function(){return {bubbleWidth:this.props.maxWidth};},componentDidMount:function(){this.renderDOMBody();this.shrinkBubble();},componentWillReceiveProps:function(r){if(r.body!=this.props.body)this.setState({bubbleWidth:this.props.maxWidth});},componentDidUpdate:function(r,s){this.renderDOMBody();if(r.body!=this.props.body)this.shrinkBubble();},render:function(){return (k.createDescriptor(k.DOM.div,Object.assign({},this.props,{className:o(this.props.className,"_5w1r"),ref:"bubble",style:Object.assign({},(this.props.style||{}),{maxWidth:this.state.bubbleWidth})}),k.createDescriptor(k.DOM.div,null,k.createDescriptor(k.DOM.span,{className:"_5yl5",ref:"content"},this.renderBody())),this.props.attachments));},renderBody:function(){var r=this.props.body||'';if(n(r,'?OTR'))return (k.createDescriptor(k.DOM.span,{className:"_89h"},"[encrypted message]"));return r;},renderDOMBody:function(){var r=this.props.body||'';if(!n(r,'?OTR'))g.setContent(this.refs.content.getDOMNode(),i.formatMessageBody(r));},shrinkBubble:function(){var r=this.refs.bubble.getDOMNode(),s=this.refs.content.getDOMNode(),t=h.getElementDimensions(r).width,u=h.getElementDimensions(s).width;if(this.contentWraps()&&u>0&&u<this.props.maxWidth&&t-u-this.getBoxWidth()>0&&u!=this.state.bubbleWidth)this.setState({bubbleWidth:u});},contentWraps:function(){var r=this.refs.content.getDOMNode(),s=r.getClientRects(),t=h.getElementDimensions(r).height;return (s&&s.length>1&&s[0].height<t);},getBoxWidth:function(){if(!p)p=h.measureElementBox(this.refs.bubble.getDOMNode(),'width',true,true,false);return p;}});e.exports=q;},null);
__d("MercuryAttachments.react",["MercuryAttachmentRenderer","DOM","Event","ImmutableObject","React","SubscriptionsHandler","arraySort","cx","emptyFunction","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';var q=176,r=4,s=k.createClass({displayName:'MercuryAttachments',propTypes:{message:k.PropTypes.instanceOf(j).isRequired,attachments:k.PropTypes.array.isRequired,isChat:k.PropTypes.bool,onImageLoad:k.PropTypes.func,onStickerClick:k.PropTypes.func},getDefaultProps:function(){return {isChat:false,onImageLoad:o,onStickerClick:o};},componentDidMount:function(){this._subscriptionsHandler=new l();this.renderAttachments();},componentDidUpdate:function(){this.renderAttachments();},componentWillUnmount:function(){this._subscriptionsHandler.release();},render:function(){var t=this.props.attachments.filter(g.isPhotoAttachment).length>0;return (k.createDescriptor(k.DOM.div,Object.assign({},this.props,{className:p(this.props.className,(("_5h9y")+(t?' '+"_zl6":'')))})));},renderAttachments:function(){var t=this.getDOMNode();h.empty(t);var u=this.props.message,v=m(this.props.attachments,g.booleanLexicographicComparator([g.isPhotoAttachment,g.isShareAttachment,g.isFileAttachment,g.isErrorAttachment])),w=g.renderPhotoAttachments(v.filter(g.isPhotoAttachment),u,q,r);w&&h.appendContent(t,w);for(var x=0;x<v.length;x++){var y=v[x];if(g.isPhotoAttachment(y))continue;var z=g.renderAttachment(this.props.isChat,y,u,null,null,this.props.onStickerClick);z.error&&h.appendContent(t,z.error);z.content&&h.appendContent(t,z.content);}h.scry(t,'img').forEach(function(aa){this._subscriptionsHandler.addSubscriptions(i.listen(aa,'load',function(){this.props.onImageLoad(aa);}.bind(this)));}.bind(this));}});e.exports=s;},null);
__d("MercuryMessageError.react",["CurrentUser","ImmutableObject","MercuryErrorInfo","MercuryMessages","React","cx","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){'use strict';var n=k.PropTypes,o=k.createClass({displayName:'MercuryMessageError',propTypes:{authorFBID:n.string,message:n.instanceOf(h).isRequired},getDefaultProps:function(){return {authorFBID:g.getID()};},render:function(){var p=this.props.message,q=p.error_data;return (k.createDescriptor(k.DOM.div,Object.assign({},this.props,{className:m(this.props.className,this._getClassNameFromStatus(p)),tabIndex:i.isTransient(q)?0:null,onClick:i.isTransient(q)?this.messageResend:null}),k.createDescriptor(k.DOM.div,{className:"_2fs1"}),k.createDescriptor(k.DOM.span,null,this._getTextFromStatus(p))));},messageResend:function(){j.getForFBID(this.props.authorFBID).resendMessage(this.props.message);},_getClassNameFromStatus:function(p){if(i.hasErrorStatus(p)){return (("_2fs2")+(' '+"_2fs3")+(i.isTransient(p.error_data)?' '+"_2fs4":'')+(i.isPermanent(p.error_data)?' '+"_2fs5":''));}else return "_2fs6 _2fs2";},_getTextFromStatus:function(p){var q='',r=p.error_data;if(i.hasErrorStatus(p))q=i.getMessage(r);return q;}});e.exports=o;},null);
__d("MercurySpoofWarning.react",["MercuryParticipants","ReactPropTypes","React","fbt"],function(a,b,c,d,e,f,g,h,i,j){var k=i.createClass({displayName:'MercurySpoofWarning',propTypes:{authorID:h.string.isRequired},getInitialState:function(){return {author:{name:''}};},componentWillMount:function(){this.componentWillReceiveProps(this.props);},componentWillReceiveProps:function(l){g.get(l.authorID,function(m){return this.setState({author:m});}.bind(this));},render:function(){return (i.createDescriptor(i.DOM.div,Object.assign({},this.props),j._("Unable to confirm {name_or_email} as the sender.",[j.param("name_or_email",this.state.author.name)])));}});e.exports=k;},null);
__d("ChatMessage.react",["ChatAnimatedGifs","ChatAuthorPhotoBlock.react","ChatBubble.react","ChatConfig","CSS","ImmutableObject","MercuryAttachment","MercuryAttachments.react","MercuryAttachmentRenderer","MercuryErrorInfo","MercuryIDs","MercuryMessageError.react","MercurySpoofWarning.react","React","ReactPropTypes","cx","fbt","formatDate","isRTL","joinClasses","MercuryMessages"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){'use strict';var aa=b('MercuryMessages').get(),ba=t.createClass({displayName:'ChatMessage',propTypes:{message:u.instanceOf(l).isRequired,maxBubbleWidth:u.number.isRequired,onImageLoad:u.func,onStickerClick:u.func},componentDidMount:function(){k.conditionClass(this.getDOMNode(),"_2cnu",this.isOneLine());},isOneLine:function(){var ca=this.props.message;return aa.isInbound(ca)&&!this.refs.attachmentsInside&&this.refs.bubble&&!this.refs.bubble.contentWraps();},shouldComponentUpdate:function(ca,da){return ca.message!==this.props.message;},render:function(){var ca=this.props.message,da=aa.isInbound(ca),ea=q.isMultichat(ca.thread_id),fa=y(ca.body),ga=j.get('chat_fading_bubbles')&&!da&&aa.isSending(ca),ha=p.hasErrorStatus(ca),ia=(("_5wd4")+(da?' '+"_1nc7":'')+(!da?' '+"_1nc6":'')+(da&&ea?' '+"_5ysy":'')+(ga?' '+"_4oe5":'')+(ha?' '+"_1zcs":'')+(fa?' '+"direction_rtl":'')+(!fa?' '+"direction_ltr":'')),ja=new Date(ca.timestamp);return (t.createDescriptor(h,Object.assign({},this.props,{authorID:ca.author,className:z(this.props.className,ia),hideName:!da||!ea,hidePhoto:!da,timestamp:ca.timestamp,title:da?null:x(ja,'g:ia')}),this._renderInner(),this._renderUndertext()));},_renderInner:function(){if(this.props.message.is_filtered_content)return (t.createDescriptor(t.DOM.div,{className:"_5wd9",ref:"inner"},this._renderFilteredContent()));return (t.createDescriptor(t.DOM.div,{className:"_5wd9",ref:"inner"},this._renderBubble(),this._renderAttachments('outside')));},_renderUndertext:function(){if(this.props.message.is_filtered_content)return null;return (t.createDescriptor(t.DOM.div,{className:"_3ry4",ref:"undertext"},t.createDescriptor(r,{className:"_5wda clearfix",message:this.props.message,ref:"status"}),this._renderSpoofWarning()));},_renderSpoofWarning:function(){return (this.props.message.is_spoof_warning?t.createDescriptor(s,{authorID:this.props.message.author,className:"_5wdb"}):null);},_renderFilteredContent:function(){return t.createDescriptor(t.DOM.div,{className:"_5wdc uiBoxYellow clearfix"},"This message is no longer available because it was identified as abusive or marked as spam.");},_renderAttachments:function(ca){var da=this.props.message,ea=ca=='inside'?'attachmentsInside':'attachmentsOutside',fa=m.get(da).filter(function(ga){var ha=o.isBubblePreferred(ga);return (ha&&ca==='inside')||(!ha&&ca==='outside');});if(fa.length>0)return t.createDescriptor(n,{className:"_5wdd clearfix",isChat:true,message:da,attachments:fa,ref:ea,onImageLoad:this.props.onImageLoad,onStickerClick:this.props.onStickerClick});},_renderBubble:function(){var ca=this.props.message,da=ca.body,ea=this._renderAttachments('inside');if(g.shouldHideBody(ca))da='';if(da||ea)return (t.createDescriptor(t.DOM.div,{className:"_5wde"},t.createDescriptor(i,{attachments:ea,body:da,className:"_5wdf",maxWidth:this.props.maxBubbleWidth,ref:"bubble"})));}});e.exports=ba;},null);
__d("ChatVideoCallLink.react",["Arbiter","ChatVisibility","MercuryParticipants","PresencePrivacy","React","ReactPropTypes","SubscriptionsHandler","VideoCallCore","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=k.createClass({displayName:'ChatVideoCallLink',propTypes:{message:l.object.isRequired,onClick:l.func.isRequired},componentDidMount:function(){this._subscriptions=new m();this._subscriptions.addSubscriptions(g.subscribe(['buddylist/availability-changed'],this.availabilityChanged),j.subscribe(['privacy-changed','privacy-availability-changed'],this.availabilityChanged));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){return (k.createDescriptor(k.DOM.a,{className:(("callBackLink")+(this.shouldHideLink()?' '+"hidden_elem":'')),'data-gt':JSON.stringify({videochat:'clicked_callback_link'}),href:"#",onClick:this.linkClicked},this.renderLinkText()));},renderLinkText:function(){if(this.props.message.log_message_data.event_name=='install_canceled'){return ("Retry setup and call back.");}else if(!this.props.message.log_message_data.event_name&&this.props.message.log_message_data.callee==i.user&&!this.props.message.log_message_data.answered)return ("Call back.");},shouldHideLink:function(){return !h.isOnline()||!n.availableForCall(this.props.message.log_message_data.to);},linkClicked:function(){var r;if(this.props.message.log_message_data.event_name=='install_canceled'){r='callback_cancelinstall_link';}else if(!this.props.message.log_message_data.event_name&&this.props.message.log_message_data.callee==i.user&&!this.props.message.log_message_data.answered)r='callback_link';this.props.onClick(this.props.message.log_message_data.to,this.props.message.thread_id,r);},availabilityChanged:function(){this.forceUpdate();}});e.exports=q;},null);
__d("MercuryLogMessageRenderer",["MercuryAttachmentRenderer","CSS","DOM","HovercardLink","MercuryLogMessageType","MercuryParticipants","React","Image.react","TooltipLink.react","cx","fbt","ix"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s={renderText:function(la,ma){switch(la.log_message_type){case k.SUBSCRIBE:u(la,ma);break;case k.UNSUBSCRIBE:z(la,ma);break;case k.VIDEO_CALL:aa(la,ma);break;case k.PHONE_CALL:ca(la,ma);break;case k.THREAD_NAME:da(la,ma);break;case k.THREAD_IMAGE:ea(la,ma);break;case k.WALLPAPER:fa(la,ma);break;case k.SERVER_ERROR:ga(la,ma);break;}},renderIcon:function(la){return (m.createDescriptor(n,{className:t(la),src:r('images/spacer.gif')}));},renderLegacy:function(la,ma,na,oa){t(oa).split(' ').forEach(function(pa){return pa&&h.addClass(la,pa);});this.renderText(oa,function(pa){m.renderComponent(m.createDescriptor(m.DOM.span,null,pa),ma);});this.renderAttachmentLegacy(na,oa);},renderAttachmentLegacy:function(la,ma){if(ma.log_message_type==k.THREAD_IMAGE){var na=ma.log_message_data.image;if(na){var oa=g.renderPreview(na.preview_url?na:null);i.setContent(la,oa);h.addClass(oa,"_z6a");h.show(la);}}}};e.exports=s;function t(la){var ma=la.log_message_type,na=la.log_message_data;return (("_5wzu")+(ma==k.SUBSCRIBE?' '+"_5wzj":'')+(ma==k.UNSUBSCRIBE?' '+"_5wzk":'')+(ma==k.THREAD_NAME?' '+"_5wzl":'')+(ma==k.THREAD_IMAGE?' '+"_5wzm":'')+(ma==k.VIDEO_CALL&&(na.answered||ka(la))?' '+"_5wzn":'')+(ma==k.VIDEO_CALL&&!(na.answered||ka(la))?' '+"_5wzo":'')+(ma==k.PHONE_CALL&&na.answered?' '+"_5wzp":'')+(ma==k.PHONE_CALL&&!na.answered?' '+"_5wzq":'')+(ma==k.SERVER_ERROR?' '+"_5wzr":''));}function u(la,ma){var na=ja(la.log_message_data.added_participants);switch(na.length){case 1:v(la,ma,na);break;case 2:w(la,ma,na);break;case 3:x(la,ma,na);break;default:y(la,ma,na);break;}}function v(la,ma,na){var oa=[la.author,na[0]];l.getMulti(oa,function(pa){if(la.author==l.user){ma(q._("You added {subscriber1}.",[q.param("subscriber1",ia(pa[na[0]]))]));}else if(na[0]==l.user){ma(q._("{actor} added you.",[q.param("actor",ia(pa[la.author]))]));}else ma(q._("{actor} added {subscriber1}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber1",ia(pa[na[0]]))]));});}function w(la,ma,na){var oa=[la.author].concat(na);l.getMulti(oa,function(pa){if(la.author==l.user){ma(q._("You added {subscriber1} and {subscriber2}.",[q.param("subscriber1",ia(pa[na[0]])),q.param("subscriber2",ia(pa[na[1]]))]));}else if(na[0]==l.user){ma(q._("{actor} added you and {subscriber2}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber2",ia(pa[na[1]]))]));}else ma(q._("{actor} added {subscriber1} and {subscriber2}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber1",ia(pa[na[0]])),q.param("subscriber2",ia(pa[na[1]]))]));});}function x(la,ma,na){var oa=[la.author].concat(na);l.getMulti(oa,function(pa){if(la.author==l.user){ma(q._("You added {subscriber1}, {subscriber2} and {subscriber3}.",[q.param("subscriber1",ia(pa[na[0]])),q.param("subscriber2",ia(pa[na[1]])),q.param("subscriber3",ia(pa[na[2]]))]));}else if(na[0]==l.user){ma(q._("{actor} added you, {subscriber2} and {subscriber3}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber2",ia(pa[na[1]])),q.param("subscriber3",ia(pa[na[2]]))]));}else ma(q._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber1",ia(pa[na[0]])),q.param("subscriber2",ia(pa[na[1]])),q.param("subscriber3",ia(pa[na[2]]))]));});}function y(la,ma,na){var oa=[la.author].concat(na);l.getMulti(oa,function(pa){function qa(sa){var ta=m.createDescriptor(m.DOM.div,null,sa.map(function(ua){return m.createDescriptor(m.DOM.div,null,ua.name);}));return (m.createDescriptor(o,{alignH:"center",position:"above",tooltip:ta},q._("{num} more",[q.param("num",sa.length)])));}var ra=na.map(function(sa){return pa[sa];});if(la.author==l.user){ma(q._("You added {subscriber1}, {subscriber2} and {more_people}.",[q.param("subscriber1",ia(ra[0])),q.param("subscriber2",ia(ra[1])),q.param("more_people",qa(ra.slice(2)))]));}else if(na[0]==l.user){ma(q._("{actor} added you, {subscriber2} and {more_people}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber2",ia(ra[1])),q.param("more_people",qa(ra.slice(2)))]));}else ma(q._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",[q.param("actor",ia(pa[la.author])),q.param("subscriber1",ia(ra[0])),q.param("subscriber2",ia(ra[1])),q.param("more_people",qa(ra.slice(2)))]));});}function z(la,ma){var na=[la.author],oa=la.log_message_data.removed_participants,pa;if(oa.length===1){pa=oa[0];na.push(pa);}l.getMulti(na,function(qa){var ra=qa[la.author],sa=qa[pa];if(la.author==l.user){if(!pa||pa==la.author){ma("You left the conversation.");}else ma(q._("You removed {name} from the conversation.",[q.param("name",ia(sa))]));}else if(!pa||pa==la.author){ma(q._("{actor} left the conversation.",[q.param("actor",ia(ra))]));}else if(pa==l.user){ma(q._("{actor} removed you from the conversation.",[q.param("actor",ia(ra))]));}else ma(q._("{actor} removed {name} from the conversation.",[q.param("actor",ia(ra)),q.param("name",ia(sa))]));});}function aa(la,ma){if(ka(la)){ba(la,ma);return;}var na=la.log_message_data.caller,oa=la.log_message_data.callee,pa=[na,oa];l.getMulti(pa,function(qa){var ra=ha(qa[oa]);if(na==l.user){if(la.log_message_data.answered){ma(q._("You called {firstname}.",[q.param("firstname",ra)]));}else ma(q._("{firstname} missed a call from you.",[q.param("firstname",ra)]));}else{var sa=ha(qa[na]);if(la.log_message_data.answered){ma(q._("{firstname} called you.",[q.param("firstname",sa)]));}else ma(q._("You missed a call from {firstname}.",[q.param("firstname",sa)]));}});}function ba(la,ma){l.get(la.log_message_data.callee,function(na){var oa=ha(na);switch(la.log_message_data.event_name){case 'installing':ma(q._("{firstname} is setting up video calling...",[q.param("firstname",oa)]));break;case 'installed':ma(q._("{firstname} finished setting up video calling.",[q.param("firstname",oa)]));break;case 'install_canceled':ma("You canceled the video calling installation.");break;}});}function ca(la,ma){var na=la.log_message_data.caller,oa=la.log_message_data.callee,pa=[na,oa];l.getMulti(pa,function(qa){if(na==l.user){var ra=ha(qa[oa]);if(la.log_message_data.answered){ma(q._("You called {firstname}.",[q.param("firstname",ra)]));}else ma(q._("{firstname} missed a call from you.",[q.param("firstname",ra)]));}else{var sa=ha(qa[na]);if(la.log_message_data.answered){ma(q._("{firstname} called you.",[q.param("firstname",sa)]));}else ma(q._("You missed a call from {firstname}.",[q.param("firstname",sa)]));}});}function da(la,ma){var na=la.log_message_data.name;if(la.author==l.user){if(na){ma(q._("You named the conversation: {name}.",[q.param("name",m.createDescriptor(m.DOM.span,{className:"_5wzs"},na))]));}else ma("You removed the conversation name.");}else l.get(la.author,function(oa){var pa=ia(oa);if(na){ma(q._("{actor} named the conversation: {name}.",[q.param("actor",pa),q.param("name",m.createDescriptor(m.DOM.span,{className:"_5wzs"},na))]));}else ma(q._("{actor} removed the conversation name.",[q.param("actor",pa)]));});}function ea(la,ma){if(la.author==l.user){if(la.log_message_data.image){ma("You changed the conversation picture.");}else ma("You removed the conversation picture.");}else l.get(la.author,function(na){var oa=ia(na);if(la.log_message_data.image){ma(q._("{actor} changed the conversation picture.",[q.param("actor",oa)]));}else ma(q._("{actor} removed the conversation picture.",[q.param("actor",oa)]));});}function fa(la,ma){if(la.author==l.user){ma("You changed the wallpaper.");}else l.get(la.author,function(na){var oa=ia(na);ma(q._("{actor} changed the wallpaper.",[q.param("actor",oa)]));});}function ga(la,ma){ma("We were unable to fetch previous messages in this conversation.");}function ha(la){return ia(la,true);}function ia(la,ma){var na=la.fbid,oa=j.constructEndpoint({id:na});if(la.href)return (m.createDescriptor(m.DOM.a,{className:"_5wzt",href:la.href,'data-hovercard':oa},ma?la.short_name:la.name));return la.name;}function ja(la){var ma=la.indexOf(l.user);if(ma>0){var na=la.filter(function(oa){return oa!==l.user;});return [l.user].concat(na);}return la;}function ka(la){return la.log_message_data.event_name==='installing'||la.log_message_data.event_name==='installed'||la.log_message_data.event_name==='install_canceled';}},null);
__d("MercuryLogMessage.react",["DOM","Event","ChatVideoCallLink.react","ImmutableObject","MercuryLogMessageRenderer","MercuryLogMessageType","React","ReactPropTypes","VideoCallCore","cx","emptyFunction","formatDate","joinClasses"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){'use strict';var t=m.createClass({displayName:'MercuryLogMessage',propTypes:{message:n.instanceOf(j).isRequired,onImageLoad:n.func,onVideoCallLinkClick:n.func},getDefaultProps:function(){return {onImageLoad:q};},getInitialState:function(){return {messageText:null};},componentDidMount:function(){this.componentWillReceiveProps(this.props);},componentWillReceiveProps:function(u){k.renderText(u.message,function(v){this.setState({messageText:v});}.bind(this));},shouldComponentUpdate:function(u,v){return this.state.messageText!=v.messageText;},componentDidUpdate:function(){var u=this.refs.attachment.getDOMNode();k.renderAttachmentLegacy(u,this.props.message);g.scry(u,'img').forEach(function(v){var w=h.listen(v,'load',function(){this.props.onImageLoad(v);w.remove();}.bind(this));}.bind(this));},render:function(){return (m.createDescriptor(m.DOM.div,Object.assign({},this.props,{className:s(this.props.className,"_5ye6"),title:r(new Date(this.props.message.timestamp),'g:ia')}),k.renderIcon(this.props.message),m.createDescriptor(m.DOM.div,{className:"_5ye7"},this.state.messageText,this.renderVideoCallLink()),m.createDescriptor(m.DOM.div,{className:"_5ye8",ref:"attachment"})));},renderVideoCallLink:function(){if(this.props.message.log_message_type!==l.VIDEO_CALL||!this.props.onVideoCallLinkClick||!o.isSupported())return null;return (m.createDescriptor(i,{message:this.props.message,onClick:this.props.onVideoCallLinkClick}));}});e.exports=t;},null);
__d("ChatConversation.react",["ChatConfig","ChatDateBreak.react","ChatMessage.react","CurrentUser","MercuryConstants","ImmutableObject","MercuryActionTypeConstants","MercuryLogMessage.react","React","cx","invariant","OrionMercuryReceiverNUX"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';var r=b('OrionMercuryReceiverNUX').module,s=k.MercurySupportedShareType,t=1000*60*60,u=o.createClass({displayName:'ChatConversation',propTypes:{maxBubbleWidth:o.PropTypes.number.isRequired,messages:o.PropTypes.arrayOf(o.PropTypes.instanceOf(l)).isRequired,onCallLinkClick:o.PropTypes.func,onImageLoad:o.PropTypes.func,onStickerClick:o.PropTypes.func},componentWillReceiveProps:function(v){q(v.maxBubbleWidth===this.props.maxBubbleWidth);},render:function(){var v=this.props.messages,w=[];for(var x=0;x<v.length;x++){var y=v[x],z=(x>0)?v[x-1]:null;if(y.is_cleared)continue;if(!z||z.is_cleared||y.timestamp-z.timestamp>t)w.push(o.createDescriptor(h,{date:new Date(y.timestamp),key:'db:'+y.message_id}));if(y.action_type==m.LOG_MESSAGE){w.push(o.createDescriptor(n,{className:"_5w0o",key:y.message_id,message:y,onImageLoad:this.props.onImageLoad,onCallLinkClick:this.props.onCallLinkClick}));}else w.push(o.createDescriptor(i,{key:y.message_id,message:y,maxBubbleWidth:this.props.maxBubbleWidth,onImageLoad:this.props.onImageLoad,onStickerClick:this.props.onStickerClick}));if(r&&!g.get('orion_receiver_nux_completed')&&y.attachments&&y.attachments.length&&y.attachments[0].share_data_type===s.FB_ORION&&y.attachments[0].metadata&&y.attachments[0].metadata.receiver&&y.attachments[0].metadata.receiver.id===j.getID()){var aa=y.attachments[0],ba=aa.metadata;w.push(o.createDescriptor(r,{key:'omrn:'+y.message_id,amount:ba.amount,currency:ba.currency,creationTime:ba.creationTime,sender:ba.sender}));}}return o.createDescriptor(o.DOM.div,null,w);}});e.exports=u;},null);
__d("MercuryTypingReceiver",["Arbiter","ChannelConstants","MercuryActionTypeConstants","MercuryConfig","MercuryParticipants","MercuryPayloadSource","TypingStates","mixInEventEmitter","setTimeoutAcrossTransitions","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=b('MercuryServerRequests').get(),q=b('MercuryThreads').get(),r,s={},t=30000,u={};n(u,{'state-changed':true});function v(ba){var ca=s[ba]||{},da=Object.keys(ca);da.sort(function(ea,fa){return ca[ea]-ca[fa];});return da;}function w(){r=null;var ba=Date.now(),ca={},da=false;for(var ea in s){var fa=false;for(var ga in s[ea]||{})if(s[ea][ga]<ba-t){delete s[ea][ga];fa=true;}else da=true;if(fa)ca[ea]=v(ea);}for(var ha in ca){y(ca);break;}if(da)r=o(w,3000);}function x(ba,ca){if(ba in s)if(ca in s[ba]){delete s[ba][ca];z(ba);}}function y(ba){u.releaseHeldEventType('state-changed');u.emitAndHold('state-changed',ba);}function z(ba){var ca={};ca[ba]=v(ba);y(ca);}function aa(ba){var ca=j.MercuryFBIDGK?ba.thread_fbid:ba.thread;if(ca)return p.getClientThreadIDNow(ca);if(ba.type==='typ')return q.getThreadIdForUser(ba.from);return null;}g.subscribe([h.getArbiterType('typ'),h.getArbiterType('ttyp')],function(ba,ca){var da=ca.obj,ea=aa(da);if(ea){var fa=k.getIDForUser(da.from);if(da.st==m.TYPING){s[ea]=s[ea]||{};var ga=s[ea][fa];s[ea][fa]=Date.now();if(!r)r=o(w,3000);!ga&&z(ea);}else if(da.st==m.INACTIVE)x(ea,fa);}});p.subscribe('update-typing-state',function(ba,ca){var da=ca.payload_source;if(da!=l.CLIENT_CHANNEL_MESSAGE)return;var ea=ca.actions;if(!ea||!ea.length)return;var fa=i.USER_GENERATED_MESSAGE;ea.forEach(function(ga){if(ga.action_type==fa&&ga.author!=k.user)x(ga.thread_id,ga.author);});});e.exports=u;},null);
__d("ChatTypingIndicators.react",["ChatAuthorPhotoBlock.react","DOM","MercuryIDs","MercuryParticipants","ReactPropTypes","React","SubscriptionsHandler","Tooltip","MercuryTypingReceiver","arraySort","createObjectFrom","cx","emptyFunction","fbt","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=b('MercuryThreadInformer').get(),v=l.createClass({displayName:'ChatTypingIndicators',propTypes:{indicatorsWillShow:k.func,indicatorsDidShow:k.func,threadID:k.string.isRequired},getDefaultProps:function(){return {indicatorsWillShow:s,indicatorsDidShow:s};},getInitialState:function(){return {typingUserIDs:[]};},componentDidMount:function(){this._subscriptions=new m();this._subscriptions.addSubscriptions(o.addRetroactiveListener('state-changed',this.typingStateChanged),u.subscribe('messages-received',this.messagesReceived));},componentWillReceiveProps:function(w){if(w.threadID!=this.props.threadID)this.setState({typingUserIDs:[]});},componentWillUpdate:function(w,x){if(x.typingUserIDs.length>0)this.props.indicatorsWillShow();},componentDidUpdate:function(){if(this.state.typingUserIDs.length>0)this.props.indicatorsDidShow();j.getMulti(this.state.typingUserIDs,function(w){if(this.isMounted())this.state.typingUserIDs.forEach(function(x){var y=w[x];n.set(this.refs[x].getDOMNode(),this.renderTooltip(y.short_name),'above','left');}.bind(this));}.bind(this));},componentWillUnmount:function(){this._subscriptions.release();},render:function(){var w=i.isMultichat(this.props.threadID);return (l.createDescriptor(l.DOM.div,{className:"_2fsr"},this.state.typingUserIDs.map(function(x){return l.createDescriptor(g,{authorID:x,className:(("_gfq")+(w?' '+"_52fu":'')),hideName:!w,key:x},l.createDescriptor(l.DOM.div,{className:"_52ft"},l.createDescriptor(l.DOM.div,{className:"_gfp",ref:x})));})));},renderTooltip:function(w){var x=h.create('span');l.renderComponent(l.createDescriptor(l.DOM.span,null,t._("{name} is typing...",[t.param("name",w)])),x);return x;},typingStateChanged:function(w){if(this.props.threadID in w)this.setState({typingUserIDs:p(w[this.props.threadID])});},messagesReceived:function(w,x){if(this.props.threadID in x){var y=x[this.props.threadID],z=q(y.map(function(aa){return aa.author;}));this.setState({typingUserIDs:p(this.state.typingUserIDs.filter(function(aa){return !z[aa];}))});}}});e.exports=v;},null);
__d("MercuryIndicatorController",["ArbiterMixin","DOM","MercuryActionTypeConstants","MercuryDelayedRoger","MercuryMessageSourceTags","MercuryParticipants","MercuryRoger","MercuryTypingReceiver","arrayContains","copyProperties","formatDate","removeFromArray","tx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=b('MercuryThreads').get(),u=[];function v(w){this._threadID=w;this._canonicalUser=t.getCanonicalUserInThread(w);u.push(this);}p(v.prototype,g,{destroy:function(){r(u,this);},setLastMessage:function(w){this._lastMsg=w;this._handleStateChange();},_informStateChanged:function(w){if(w.activity=='none'&&this._currentActivity=='none')return;if(this._lastMsg&&l.isAuthor(this._lastMsg.author))w.self_authored=true;this._currentActivity=w.activity;this.inform('state-changed',w);},_notifySentFrom:function(){var w,x,y=this._lastMsg.location_text,z=this._lastMsg.source_tags||[];if(y){w=s._("Sent from {location}",{location:y});x='sentFromMobile';}else if(o(z,k.MESSENGER)){w=h.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},"Sent from Messenger");x='sentFromMobile';}else if(o(z,k.MOBILE)){w=h.create('a',{href:'/mobile','class':'fcg',target:'_blank'},"Sent from Mobile");x='sentFromMobile';}else if(o(z,k.EMAIL)){w="Sent from email";x='sentFromEmail';}else{this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:x,text:w});},_notifySeenTimestamp:function(w){var x=m.getSeenTimestamp(this._threadID,w[0])*.001,y=Date.now()*.001,z;if(x<y-518400){z='M j';}else if(x<y-86400){z='D g:ia';}else z='g:ia';this._informStateChanged({activity:'seen-timestamp',text:s._("Seen {timestamp}",{timestamp:q(x,z)})});},_checkNamesForCollision:function(w,x){var y=false;l.getMulti(w,function(z){function aa(da){if(typeof z[da]!=="undefined"){return z[da].short_name.toLowerCase();}else return da;}var ba=x.map(aa),ca=w.map(aa);y=ba.some(function(da){return ca.indexOf(da)!==ca.lastIndexOf(da);});});return y;},_notifySeenBy:function(w){var x=this._lastMsg,y=true;l.getMulti(w,function(z){y=false;if(this._lastMsg!=x)return;var aa=t.getThreadMetaNow(this._threadID),ba=aa?aa.participants.length:0,ca=w.length+(x.author!=l.user),da,ea=false,fa=false,ga=ba>2&&ca>=ba-1;if(!(ga)&&ba>0)fa=this._checkNamesForCollision(aa.participants,w);if(ga){da="Seen by everyone";}else if(w.length==1){da=s._("Seen by {user}",{user:z[w[0]].short_name});}else if(w.length==2){da=s._("Seen by {user1}, {user2}",{user1:z[w[0]].short_name,user2:z[w[1]].short_name});}else if(w.length==3){da=s._("Seen by {user1}, {user2}, {user3}",{user1:z[w[0]].short_name,user2:z[w[1]].short_name,user3:z[w[2]].short_name});}else if(w.length>3){var ha=Object.keys(z).length-2,ia=s._("{num} more",{num:ha}),ja=h.create('span',{className:'more'},ia);da=h.tx._("Seen by {user1}, {user2}, {=num more link}",{user1:z[w[0]].short_name,user2:z[w[1]].short_name,'=num more link':ja});ea=true;}ea=ea||fa;this._informStateChanged({activity:'seen-by',text:da,seenBy:w,hasNameCollision:fa,tooltip:ea});}.bind(this));y&&this._informStateChanged({activity:'none'});},_notifyTyping:function(w){var x=this._lastMsg,y=true;l.getMulti(w,function(z){y=false;if(this._lastMsg!=x)return;var aa=t.getThreadMetaNow(this._threadID),ba=aa?aa.participants.length:0,ca,da=false;if(ba>2&&w.length>=ba-1){ca="Everyone is typing...";}else if(w.length==1){ca=s._("{name} is typing...",{name:z[w[0]].short_name});}else if(w.length==2){ca=s._("{user1} and {user2} are typing...",{user1:z[w[0]].short_name,user2:z[w[1]].short_name});}else if(w.length==3){ca=s._("{user1}, {user2}, and {user3} are typing...",{user1:z[w[0]].short_name,user2:z[w[1]].short_name,user3:z[w[2]].short_name});}else if(w.length>3){var ea=Object.keys(z).length-2,fa=s._("{num} more",{num:ea}),ga=h.create('a',{href:'#'},fa);ca=h.tx._("{user1}, {user2}, and {=num more link} are typing...",{user1:z[w[0]].short_name,user2:z[w[1]].short_name,'=num more link':ga});da=true;}this._informStateChanged({activity:'typing',text:ca,typing:w,tooltip:da});}.bind(this));y&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var w=i.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==w){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=l.user){this._notifySentFrom();return;}var x=j.getSeenBy(this._threadID,true);if(x.length)if(this._canonicalUser){this._notifySeenTimestamp(x);return;}else{this._notifySeenBy(x);return;}this._informStateChanged({activity:'none'});}});n.addRetroactiveListener('state-changed',function(w){u.forEach(function(x){var y=w[x._threadID];if(y!==undefined){x._typing=y;x._handleStateChange();}});});j.subscribe('state-changed',function(w,x){u.forEach(function(y){x[y._threadID]&&y._handleStateChange();});});e.exports=v;},null);
__d("MercuryLastMessageIndicator.react",["DOM","MercuryIndicatorController","MercuryParticipants","ReactPropTypes","React","Tooltip","cx","emptyFunction","joinClasses","startsWith"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=k.createClass({displayName:'MercuryLastMessageIndicator',propTypes:{hideTyping:j.bool,indicatorWillShow:j.func,indicatorDidShow:j.func,lastMessage:j.object,threadID:j.string.isRequired},getDefaultProps:function(){return {indicatorWillShow:n,indicatorDidShow:n};},getInitialState:function(){return {data:{}};},componentDidMount:function(){this._setup(this.props);},componentWillReceiveProps:function(r){if(r.threadID!=this.props.threadID){this._destroy();this._setup(r);}else if(r.lastMessage!=this.props.lastMessage)this._controller.setLastMessage(r.lastMessage);},componentWillUpdate:function(r,s){if(this.isVisible(r,s))this.props.indicatorWillShow();},componentDidUpdate:function(){if(!this.isVisible())return;this.setText();this.setTooltip();this.props.indicatorDidShow();},componentWillUnmount:function(){this._destroy();},render:function(){return (k.createDescriptor(k.DOM.div,{className:this.getRootClass()},k.createDescriptor(k.DOM.div,{className:"_510h"}),k.createDescriptor(k.DOM.span,{className:"_510f",ref:"text"}," ")));},getRootClass:function(){var r=(("_510g")+(this.state.data.self_authored?' '+"_510e":'')),s=this.state.data.activity,t=null;if(p(s,'seen')){t='seen';}else if(s=='typing'){t=this.props.hideTyping?null:s;}else t=s;return o(r,t,this.props.className);},isVisible:function(r,s){r=r||this.props;s=s||this.state;return (s.data&&s.data.activity!='none'&&!(r.hideTyping&&s.data.activity=='typing'));},setText:function(){if(this.state.data.text)g.setContent(this.refs.text.getDOMNode(),this.state.data.text);},setTooltip:function(){if(this.state.data.activity=='seen-by'&&this.state.data.tooltip)i.getMulti(this.state.data.seenBy,function(r){var s=g.create('div',null,this.state.data.seenBy.map(function(t){return g.create('div',null,r[t].name);}));l.set(this.state.data.hasNameCollision?this.getDOMNode():g.find(this.getDOMNode(),'span.more'),s,'above','center');}.bind(this));},_setup:function(r){this._controller=new h(r.threadID);this._subscription=this._controller.subscribe('state-changed',function(s,t){return this.setState({data:t});}.bind(this));r.lastMessage&&this._controller.setLastMessage(r.lastMessage);},_destroy:function(){this._subscription.unsubscribe();this._controller.destroy();},setLastMessage:function(r){this.setProps({lastMessage:r});}});e.exports=q;},null);
__d("MercuryTypingIndicator",["Animation","CSS","DOM","MercuryTypingReceiver","MercuryParticipants","Style","ChatTabTemplates","Tooltip","copyProperties","cx","tx","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=b('MercuryThreadInformer').get(),s=[];r.subscribe('messages-received',function(v,w){s.forEach(function(x){var y=w[x._threadID];y&&x.receivedMessages(y);});});j.addRetroactiveListener('state-changed',function(v){s.forEach(function(w){var x=v[w._threadID];x&&w._handleStateChanged(x);});});function t(v){var w=m[':fb:chat:conversation:message-group'].build(),x=m[':fb:mercury:typing-indicator:typing'].build();h.addClass(w.getRoot(),"_50kd");var y=w.getNode('profileLink');n.set(y,v.name,'left');y.href=v.href;w.setNodeContent('profileName',v.name);w.setNodeProperty('profilePhoto','src',v.image_src);var z=q._("{name} is typing...",{name:v.short_name});n.set(x.getRoot(),z,'above');i.appendContent(w.getNode('messages'),x.getRoot());return w;}function u(v,w,x){this._animations={};this._activeUsers={};this._typingIndicator=w;this._messagesView=x;this._threadID=v;this._subscription=j.addRetroactiveListener('state-changed',function(y){var z=y[this._threadID];z&&this._handleStateChanged(z);}.bind(this));s.push(this);}o(u.prototype,{destroy:function(){Object.keys(this._activeUsers).forEach(this._removeUserBubble.bind(this));this._controller.destroy();s.remove(this);},receivedMessages:function(v){v.forEach(function(w){if(!k.isAuthor(w.author))this._removeUserBubble(w.author);}.bind(this));},_handleStateChanged:function(v){for(var w in this._activeUsers)if(v.indexOf(w)===-1){this._slideOutUserBubble(w);delete this._activeUsers[w];}if(v.length)k.getMulti(v,function(x){var y=this._messagesView.isScrolledToBottom(),z={};for(var aa in x){var ba=this._activeUsers[aa];z[aa]=ba||t(x[aa]).getRoot();if(!ba)i.appendContent(this._typingIndicator,z[aa]);}var ca=Object.keys(z).length>0;y&&this._messagesView.scrollToBottom(ca);this._activeUsers=z;}.bind(this));},_removeUserBubble:function(v,w){var x=this._getCurrentAnimation(v,w);if(x){x.animation.stop();i.remove(x.elem);delete this._animations[v];}if(v in this._activeUsers){i.remove(this._activeUsers[v]);delete this._activeUsers[v];}w&&i.remove(w);},_slideOutUserBubble:function(v){var w=this._activeUsers[v];if(this._getCurrentAnimation(v,w)){return;}else if(w){l.set(w,'overflow','hidden');var x=(new g(w)).from('opacity',1).from('height',w.offsetHeight).to('height',0).to('opacity',0).ease(g.ease.end).duration(250).ondone(this._removeUserBubble.bind(this,v,w)).go();this._animations[v]={animation:x,elem:w};}},_getCurrentAnimation:function(v,w){if(this._animations[v]&&(!w||this._animations[v].elem===w))return this._animations[v];}});e.exports=u;},null);
__d("MercuryMessageList",["ImmutableObject","LogHistory","OrderedMap","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j){'use strict';var k=h.getInstance('mercury_message_list');function l(q){this.$MercuryMessageList0=n(q?m(q):[]);}l.prototype.append=function(q){this.$MercuryMessageList0=this.$MercuryMessageList0.merge(n(m(q)));p('append',q);};l.prototype.prepend=function(q){this.$MercuryMessageList0=n(m(q)).merge(this.$MercuryMessageList0);p('prepend',q);};l.prototype.update=function(q){this.$MercuryMessageList0=this.$MercuryMessageList0.merge(n(m(q.filter(function(r){return this.contains(r);}.bind(this)))));p('update',q);};l.prototype.reorder=function(q){this.$MercuryMessageList0=n(q.map(function(r){var s=this.$MercuryMessageList0.get(r.message_id);if(!s||s.timestamp!=r.timestamp||s.is_cleared!=r.is_cleared)return new g(r);return s;}.bind(this)));p('reorder',q);};l.prototype.hasReachedClearedMessages=function(){return this.messageAt(0).is_cleared;};l.prototype.messageAt=function(q){return this.$MercuryMessageList0.get(this.$MercuryMessageList0.keyAtIndex(q));};l.prototype.contains=function(q){return this.$MercuryMessageList0.indexOfKey(o(q))!==undefined;};l.prototype.toArray=function(){return this.$MercuryMessageList0.toArray();};l.prototype.toOrderedMap=function(){return this.$MercuryMessageList0;};function m(q){return q.map(function(r){return new g(r);});}function n(q){return i.fromArray(q,o);}function o(q){return q.message_id;}function p(event,q){j(function(){k.debug(event,{messageIDs:q.map(function(r){return r.message_id;})});},0);}e.exports=l;},null);
__d("MercuryMessageStore",["MercuryAPIArgsSource","LogHistory","MercuryMessageList","MercuryParticipants","SubscriptionsHandler","MercuryThreadlistConstants","copyProperties","merge","mixInEventEmitter","setTimeoutAcrossTransitions","MercuryMessages","MercuryThreads","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){'use strict';var q=b('MercuryMessages').get(),r=b('MercuryThreads').get(),s=b('MercuryThreadInformer').get(),t=h.getInstance('mercury_message_store');function u(w){this.$MercuryMessageStore0=w;this.$MercuryMessageStore1=new i();this.$MercuryMessageStore2=1;this.$MercuryMessageStore3=null;this.$MercuryMessageStore4=0;this.$MercuryMessageStore5=new k();this.$MercuryMessageStore5.addSubscriptions(s.subscribe('messages-received',function(x,y){return this.$MercuryMessageStore7(y);}.bind(this)),s.subscribe('messages-updated',function(x,y){return y[this.$MercuryMessageStore0]&&this.$MercuryMessageStore8(y[this.$MercuryMessageStore0]);}.bind(this)),s.subscribe('messages-reordered',function(x,y){return y[this.$MercuryMessageStore0]&&this.$MercuryMessageStore9();}.bind(this)));this.$MercuryMessageStorea();}u.prototype.setNewThreadID=function(w){this.$MercuryMessageStoreb=w;};u.prototype.destroy=function(){this.$MercuryMessageStore5&&this.$MercuryMessageStore5.release();};u.prototype.subscribe=function(w){return this.addRetroactiveListener('updated',w);};u.prototype.fetchMoreMessages=function(){if(q.hasLoadedExactlyNMessages(this.$MercuryMessageStore0,this.$MercuryMessageStore4)&&q.hasLoadedAllMessages(this.$MercuryMessageStore0))return false;if(r.isNewEmptyLocalThread(this.$MercuryMessageStore0))return false;if(this.$MercuryMessageStore1.hasReachedClearedMessages())return false;return this.$MercuryMessageStorea();};u.prototype.$MercuryMessageStorea=function(){var w=this.$MercuryMessageStore4+l.RECENT_MESSAGES_LIMIT*this.$MercuryMessageStore2;q.getThreadMessagesRange(this.$MercuryMessageStore0,0,w,this.$MercuryMessageStorec.bind(this),null,g.MERCURY);if(this.$MercuryMessageStore2<10)this.$MercuryMessageStore2+=1;if(q.hasLoadedNMessages(this.$MercuryMessageStore0,w)){this.$MercuryMessageStore9();return false;}return true;};u.prototype.$MercuryMessageStorec=function(w){if(w&&w.length){this.$MercuryMessageStore3=w[0].timestamp;this.$MercuryMessageStore4=w.length;}};u.prototype.$MercuryMessageStore7=function(w){var x=[],y=w[this.$MercuryMessageStore0];if(y&&y.length)x=x.concat(y);if(this.$MercuryMessageStoreb){var z=w[this.$MercuryMessageStoreb];if(z&&z.length){x=x.concat(z);this.$MercuryMessageStoreb=null;}}if(x.length){this.$MercuryMessageStore1.append(x);this.$MercuryMessageStore4+=x.length;var aa=x.every(function(ba){return ba.author!=j.user;});this.$MercuryMessageStored(u.MESSAGES_RECEIVED,{allFromOthers:aa});}};u.prototype.$MercuryMessageStore8=function(w){this.$MercuryMessageStore1.update(q.getMessagesFromIDs(Object.keys(w)));this.$MercuryMessageStore3=this.$MercuryMessageStore1.messageAt(0).timestamp;this.$MercuryMessageStored(u.MESSAGES_CHANGED);};u.prototype.$MercuryMessageStore9=function(){if(!this.$MercuryMessageStore3)return;this.$MercuryMessageStore1.reorder(q.getThreadMessagesSinceTimestamp(this.$MercuryMessageStore0,this.$MercuryMessageStore3));this.$MercuryMessageStore3=this.$MercuryMessageStore1.messageAt(0).timestamp;this.$MercuryMessageStored(u.MESSAGES_REORDERED);};u.prototype.$MercuryMessageStored=function(w,x){var y=this.$MercuryMessageStore1.toArray();this.releaseHeldEventType('updated');this.emitAndHold('updated',n({messages:y,eventType:w},x));v(this.$MercuryMessageStore0,w,y);};function v(w,x,y){p(function(){t.debug('updated',{threadID:w,eventType:x,messageIDs:y.map(function(z){return z.message_id;})});},0);}m(u,{MESSAGES_FETCHED:'fetched',MESSAGES_CHANGED:'changed',MESSAGES_RECEIVED:'received',MESSAGES_REORDERED:'reordered'});o(u,{updated:true});e.exports=u;},null);
__d("ChatTabMessagesView",["Animation","Arbiter","ArbiterMixin","MercuryAttachment","MercuryAttachmentRenderer","BanzaiLogger","ChannelConstants","ChatAnimatedGifs","ChatConfig","ChatConversation.react","ChatDateBreak.react","ChatTypingIndicators.react","CSS","CurrentUser","DOM","Event","ImmutableObject","MercuryLastMessageIndicator.react","LiveTimer","MercuryActionTypeConstants","MercuryAPIArgsSource","MercuryErrorInfo","MercuryLogMessage.react","MercuryLogMessageType","MercurySourceType","MercuryMessageError.react","MercuryThreadlistConstants","MercuryTypingIndicator","MercuryMessageRenderer","MercuryMessageStore","Parent","MercuryParticipants","React","ServerTime","MercurySpoofWarning.react","MercuryStatusTemplates","StickerActions","StickerState","StickerStoreController","Style","SubscriptionsHandler","ChatTabTemplates","Tooltip","UserAgent","arrayContains","copyProperties","createArrayFrom","csx","cx","extendArray","formatDate","getElementPosition","isRTL","removeFromArray","shield","throttle","tx","MercuryMessages","MercuryServerRequests","MercuryThreadMetadataRenderer","MercuryThreads","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb){'use strict';var lb=b('MercuryMessages').get(),mb=b('MercuryServerRequests').get(),nb=b('MercuryThreadMetadataRenderer').get(),ob=b('MercuryThreads').get(),pb=b('MercuryThreadInformer').get(),qb,rb=34,sb=1000*60*60,tb=70,ub=null,vb=20;function wb(ec){return eb(new Date(ec),'g:ia');}function xb(ec){var fc=va[':fb:chat:conversation:message-group'].build(),gc=fc.getNode('profileLink'),hc=la.isAuthor(ec.author),ic=mb.tokenizeThreadID(ec.thread_id),jc=ic.type!=='user',kc=!hc;s.conditionClass(fc.getRoot(),"_50kd",!hc);s.conditionClass(fc.getRoot(),"_50x4",jc&&!hc);s.conditionShow(gc,kc);la.get(ec.author,function(lc){if(kc){gc.href=lc.href;var mc="You";if(!hc)mc=u.create('div',{className:"_522l"},[u.create('div',{className:"_522m"},wb(ec.timestamp)),lc.name]);wa.set(gc,mc,'left');if(!hc&&jc)fc.setNodeContent('profileName',lc.name);fc.setNodeProperty('profilePhoto','src',lc.image_src);}});return fc;}function yb(ec,fc){if(!s.hasClass(ec,"_kso")){var gc=u.scry(ec,"._kso");if(gc.length===1){ec=gc[0];}else return;}ta.set(ec,'max-width',zb(fc)+'px');var hc,ic,jc=ec.firstChild;if(ec.childNodes.length===1&&jc.getAttribute('data-measureme')){hc=jc.getClientRects();var kc=jc.offsetHeight;if(hc&&hc.length>1&&hc[0].height<kc){ic=true;if(!qb){u.remove(jc);qb=ec.offsetWidth;u.appendContent(ec,jc);}var lc=jc.offsetWidth,mc=ec.offsetWidth-lc-qb;if(mc>0)ta.set(ec,'max-width',lc+'px');}}var nc=ka.byClass(ec,"_50x4");if(nc)s.conditionClass(nc,"_51lo",hc?!ic:ec.offsetHeight<rb);}function zb(ec){if(ub===null){var fc=ec.childNodes[0];ta.set(ec,'overflow','scroll');ub=fc.clientWidth-tb;ta.set(ec,'overflow','');}return ub;}function ac(ec){var fc=va[':fb:mercury:chat:message:forward'].build(),gc=fc.getNode('forwardText');if(gc){s.hide(fc.getRoot());nb.renderWebMessengerLink(ec.thread_id,fc.getNode('forwardLink'),s.show.bind(s,fc.getRoot()));if(ec.forward_count>1){u.appendContent(gc,kb._("{count} forwarded messages",{count:ec.forward_count}));}else u.appendContent(gc,"1 forwarded message");}return fc.getRoot();}var bc=[];function cc(ec,fc,gc,hc,ic,jc,kc,lc){this.loadingIcon=ic;this.threadID=ec;this.sheetController=fc;this.scrollContainer=gc;this.conversationElem=hc;this.messageElements={};this.tabView=lc;this.messageGroup=null;this.prevMessage=null;y.restart(na.get()/1000);this._fetchMultiplier=1;this._oldestMessageDisplayedTimestamp=null;this._loadingMoreMessages=false;this._currentMessageCount=0;this._hasReachedClearedMessages=false;var mc=ga.MESSAGE_TIMESTAMP_THRESHOLD;this._oldestMessageDisplayedTimestamp=Date.now()-mc;bc.push(this);function nc(){cc.inform('interaction-with-tab',ec);}this._subscriptions=new ua();this._subscriptions.addSubscriptions(h.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this)),v.listen(this.scrollContainer,'mousedown',nc));if(xa.firefox()){var oc=('WheelEvent' in window)?'wheel':'DOMMouseScroll';this.scrollContainer.addEventListener(oc,nc,false);}else this._subscriptions.addSubscriptions(v.listen(this.scrollContainer,'mousewheel',nc));this._subscriptions.addSubscriptions(v.listen(this.scrollContainer,'scroll',jb(this.scrolling,50,this)));if(o.get('chat_react')){var pc;ma.renderComponent(ma.createDescriptor(r,{threadID:this.threadID,indicatorsWillShow:function(){return pc=this.isScrolledToBottom();}.bind(this),indicatorsDidShow:function(){return pc&&this.scrollToBottom(true);}.bind(this)}),kc);}else this.typingIndicator=new ha(this.threadID,kc,this);var qc;this.lastMessageIndicatorNode=jc;this.lastMessageIndicator=ma.renderComponent(ma.createDescriptor(x,{threadID:this.threadID,hideTyping:true,indicatorWillShow:function(){return qc=this.isScrolledToBottom();}.bind(this),indicatorDidShow:function(){return qc&&this.scrollToBottom(true);}.bind(this)}),this.lastMessageIndicatorNode);if(o.get('chat_react_user_messages')){this.initializeConversation();}else{lb.getThreadMessagesRange(this.threadID,0,ga.RECENT_MESSAGES_LIMIT,this._updateTimestamp.bind(this));this.rerender();}}za(cc,i);za(cc.prototype,{initializeConversation:function(){this._store=new ja(this.threadID);this._conversation=ma.renderComponent(ma.createDescriptor(p,{maxBubbleWidth:zb(this.scrollContainer),messages:[],onImageLoad:function(ec){var fc=this.scrollContainer,gc=fc.scrollTop+fc.clientHeight;if(gc+ec.offsetHeight>=fc.scrollHeight)this.scrollToBottom();}.bind(this),onStickerClick:this._onStickerClick.bind(this),onCallLinkClick:function(ec,fc,gc){cc.inform('video-call-clicked',{userID:ec,threadID:fc,clickSource:gc});}}),this.conversationElem);this._subscriptions.addSubscriptions(this._store.subscribe(function(ec){if(ec.eventType==ja.MESSAGES_RECEIVED&&ec.allFromOthers&&!this.isScrolledToBottom()){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}if(ec.eventType==ja.MESSAGES_REORDERED){this._loadingMoreMessages=false;s.hide(this.loadingIcon);}var fc=this.isScrolledToBottom(),gc=this._getLoadingHeight(),hc=this.scrollContainer.scrollHeight,ic=this.scrollContainer.scrollTop,jc=ec.messages;this._conversation.setProps({messages:jc},function(){if(fc){this.scrollToBottom();}else if(ec.eventType==ja.MESSAGES_REORDERED)this.scrollToPosition(this.scrollContainer.scrollHeight-hc-gc+ic);}.bind(this));this.lastMessageIndicator.setProps({lastMessage:jc.length>0?jc[jc.length-1]:null});if(ec.eventType==ja.MESSAGES_RECEIVED&&this._shouldShowStickerReplyNUX(jc)&&this.tabView&&this.tabView.isFocused())this.tabView.showStickerReplyNUX();}.bind(this)));},scrolling:function(){this._checkToAnimateSticker();if(o.get('chat_react_user_messages')){if(this.isScrolledNearTop()&&!this._loadingMoreMessages&&!this.isScrolledToBottom()&&!this.tabView._isDragDropActive)if(this._store.fetchMoreMessages()){s.show(this.loadingIcon);this._loadingMoreMessages=true;}}else if(!this._loadingMoreMessages&&this.isScrolledNearTop()&&!this.isScrolledToBottom()&&!this._hasReachedClearedMessages&&!this.tabView._isDragDropActive)this.loadMoreMessages();if(!this._newMessagesSheetOpened)return;if(this.isScrolledToBottom()){this.sheetController.closeNewMessagesSheet();this._newMessagesSheetOpened=false;}},getScrollTop:function(){return this.scrollContainer&&this.scrollContainer.scrollTop;},destroy:function(){u.scry(this.conversationElem,'.stickerContainer').forEach(function(ec){return ma.unmountComponentAtNode(ec);});ma.unmountComponentAtNode(this.conversationElem);u.empty(this.conversationElem);this._subscriptions&&this._subscriptions.release();hb(bc,this);ma.unmountComponentAtNode(this.lastMessageIndicatorNode);delete this.lastMessageIndicator;if(o.get('chat_react_user_messages'))this._store&&this._store.destroy();this.destroyed=true;},_appendMessage:function(ec){if(ec==this.prevMessage)return;if(ec.is_cleared){this._hasReachedClearedMessages=true;return;}this._appendDateBreak(ec);if(ec.action_type===z.LOG_MESSAGE){this._appendLogMessage(ec);}else this._appendUserMessageXHP(ec);this.prevMessage=ec;},_appendUserMessageXHP:function(ec){var fc=ga.GROUPING_THRESHOLD,gc=this._renderMessageWithStatus(ec);if(!this.messageGroup||ec.author!==la.user||this.prevMessage.author!=ec.author||this.prevMessage.timestamp<ec.timestamp-fc){this.messageGroup=xb(ec);u.appendContent(this.conversationElem,this.messageGroup.getRoot());}u.appendContent(this.messageGroup.getNode('messages'),gc);yb(gc,this.scrollContainer);},_appendDateBreak:function(ec){if(ec.action_type===z.LOG_MESSAGE&&ec.log_message_type===da.SERVER_ERROR)return;var fc=this.prevMessage!==null?ec.timestamp-this.prevMessage.timestamp:Infinity;if(fc>=sb){var gc=new Date(ec.timestamp),hc=u.create('div',{className:"_5xjf"});ma.renderComponent(ma.createDescriptor(q,{date:gc}),hc);u.appendContent(this.conversationElem,hc);this.messageGroup=null;}},_appendLogMessage:function(ec){var fc=u.create('div',{className:"_5ye9"}),gc=ma.createDescriptor(fa,{message:new w(ec)}),hc=ma.createDescriptor(ca,{className:"_5w0o",message:new w(ec),onCallLinkClick:function(ic,jc,kc){cc.inform('video-call-clicked',{userID:ic,threadID:jc,clickSource:kc});}});if(ba.hasErrorStatus(ec))hc=ma.createDescriptor(ma.DOM.div,{className:"clearfix _542q"},ma.createDescriptor(ma.DOM.div,{className:"_5pi7"},hc),ma.createDescriptor(ma.DOM.div,{className:"_5pi6"},gc));ma.renderComponent(hc,fc);u.appendContent(this.conversationElem,fc);this.messageGroup=null;},rerender:function(){if(!this._oldestMessageDisplayedTimestamp)return;var ec=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollHeight,fc=this._finishedFetchingMoreMessages&&this.scrollContainer.scrollTop,gc=this.isScrolledToBottom();u.empty(this.conversationElem);this.messageElements={};this.messageGroup=null;this.prevMessage=null;var hc=lb.getThreadMessagesSinceTimestamp(this.threadID,this._oldestMessageDisplayedTimestamp);this._renderOlderMessages(hc,ec,fc,gc);this._finishedFetchingMoreMessages=false;},update:function(ec){for(var fc in ec){var gc=this.messageElements[fc];if(gc){var hc=this.isScrolledToBottom(),ic=lb.getMessagesFromIDs([fc])[0],jc=this._renderMessageWithStatus(ic);u.replace(gc,jc);yb(jc,this.scrollContainer);if(hc)this.scrollToBottom();}}if(this.scrollContainer.scrollTop===0)this._checkToAnimateSticker();},_getLoadingHeight:function(){return this.loadingHeight||this.loadingIcon.clientHeight;},_appendMessages:function(ec){var fc=this.scrollContainer.style.overflowY;ta.set(this.scrollContainer,'overflow-y','scroll');ec.forEach(this._appendMessage.bind(this));this.lastMessageIndicator&&this.lastMessageIndicator.setLastMessage(this.prevMessage);ta.set(this.scrollContainer,'overflow-y',fc);},_appendNewMessages:function(ec){var fc=this.isScrolledToBottom(),gc=this._messagesOnlySentFromSelf(ec);this._appendMessages(ec);if(fc){this.scrollToBottom();}else if(!gc){this.sheetController.openNewMessagesSheet();this._newMessagesSheetOpened=true;}if(this._shouldShowStickerReplyNUX(ec)&&this.tabView&&this.tabView.isFocused())this.tabView.showStickerReplyNUX();},_messagesOnlySentFromSelf:function(ec){for(var fc=0;fc<ec.length;fc++)if(ec[fc].author!==la.user)return false;return true;},_shouldShowStickerReplyNUX:function(ec){if(!ra.shouldShowStickerReplyNUX()||!ec.length)return false;var fc=ec[ec.length-1];if(fc.author===la.user)return false;if(fc.has_attachment)return fc.attachments.some(function(gc){return gc.attach_type==='sticker';});return false;},_renderOlderMessages:function(ec,fc,gc,hc){if(!ec)return;this._appendMessages(ec);if(hc){this.scrollToBottom();}else if(this._finishedFetchingMoreMessages)this.scrollToPosition(this.scrollContainer.scrollHeight-fc-this.loadingHeight+gc);},_updateTimestamp:function(ec){if(ec&&ec.length){this._oldestMessageDisplayedTimestamp=ec[0].timestamp;this._currentMessageCount=ec.length;}this._loadingMoreMessages=false;this._finishedFetchingMoreMessages=true;s.hide(this.loadingIcon);},isScrolledToBottom:function(ec){var fc=this.scrollContainer;ec=ec||vb;return fc.scrollTop+fc.clientHeight>=fc.scrollHeight-ec;},isScrolledNearTop:function(){return this.scrollContainer.scrollTop<this.scrollContainer.clientHeight;},scrollToBottom:function(ec){this.scrollToPosition(this.scrollContainer.scrollHeight,ec);},scrollToPosition:function(ec,fc){this._scrollTopAnimation&&this._scrollTopAnimation.stop();if(fc===true){this._scrollTopAnimation=(new g(this.scrollContainer)).to('scrollTop',ec).ease(g.ease.end).duration(400).go();}else this.scrollContainer.scrollTop=ec;},loadMoreMessages:function(){if(lb.hasLoadedExactlyNMessages(this.threadID,this._currentMessageCount)&&lb.hasLoadedAllMessages(this.threadID))return;if(ob.isNewEmptyLocalThread(this.threadID))return;s.show(this.loadingIcon);this.loadingHeight=this._getLoadingHeight();this._loadingMoreMessages=true;if(this._fetchMultiplier<10)this._fetchMultiplier+=1;var ec=ga.RECENT_MESSAGES_LIMIT*this._fetchMultiplier,fc=this._currentMessageCount+ec,gc=lb.hasLoadedNMessages(this.threadID,fc);lb.getThreadMessagesRange(this.threadID,0,fc,this._updateTimestamp.bind(this),null,aa.CHAT);if(gc)this.rerender();},_renderMessageWithStatus:function(ec){var fc=this._makeSingleMessage(ec),gc=ma.createDescriptor(fa,{message:new w(ec)});if(ba.hasErrorStatus(ec)){var hc=va[':fb:chat:conversation:message:status'].build();s.addClass(hc.getRoot(),"_542q");u.appendContent(hc.getNode('message'),fc);ma.renderComponent(gc,hc.getNode('status'));fc=hc.getRoot();}this.messageElements[ec.message_id]=fc;return fc;},_makeSingleMessage:function(ec){var fc=this._renderSingleMessage(ec);s.addClass(fc,"_55r0");return fc;},_renderSingleMessage:function(ec){var fc=va[':fb:chat:conversation:message'].render();fc.setAttribute('title',wb(ec.timestamp));if(ec.subject){var gc=va[':fb:chat:conversation:message:subject'].render();u.setContent(gc,ec.subject);u.appendContent(fc,gc);}function hc(oc){return u.create('span',{'data-measureme':1},oc);}if(ec.is_filtered_content){var ic=pa[':fb:mercury:filtered-message'].build();u.appendContent(fc,hc(ic.getRoot()));return fc;}var jc=ec.body||'';if(n.shouldHideBody(ec))jc='';if(jc.substr(0,4)=='?OTR'){u.setContent(fc,hc("[encrypted message]"));s.addClass(fc,"_542c");}else{s.addClass(fc,gb(jc)?'direction_rtl':'direction_ltr');var kc=ia.formatMessageBody(jc);u.appendContent(fc,hc(kc));}if(ec.has_attachment){var lc=u.create('div'),mc=this._appendMessageAttachments(lc,ec);if(!ec.body&&!mc)return lc;u.appendContent(fc,ab(lc.childNodes));}if(ec.forward_count)u.appendContent(fc,ac(ec));if(ec.is_spoof_warning){var nc=u.create('div',{className:"_5wdb"});ma.renderComponent(ma.createDescriptor(oa,{authorID:ec.author}),nc);return u.create('div',null,[u.create('div',null,fc),nc]);}return fc;},_appendMessageAttachments:function(ec,fc){var gc=0,hc=fc.attachments;hc.sort(k.booleanLexicographicComparator([k.isPhotoAttachment,k.isShareAttachment,k.isFileAttachment,k.isErrorAttachment]));if(fc.raw_attachments&&fc.raw_attachments.length>0)hc=j.convertRaw(fc.raw_attachments);if(fc.attachments.length===0&&fc.preview_attachments&&fc.preview_attachments.length>0)db(hc,fc.preview_attachments);var ic=k.renderPhotoAttachments(hc.filter(k.isPhotoAttachment),fc,176,4);if(ic)u.appendContent(ec,u.create('div',{className:"_55pl"},ic));for(var jc=0;jc<hc.length;jc++){if(k.isPhotoAttachment(hc[jc])){gc=1;continue;}var kc=k.renderAttachment(true,hc[jc],fc,null,null,this._onStickerClick.bind(this));kc.error&&u.appendContent(ec,kc.error);kc.content&&u.appendContent(ec,kc.content);gc|=kc.bubblePreferred;}var lc=u.scry(ec,'img');lc.forEach(function(mc){this._subscriptions.addSubscriptions(v.listen(mc,'load',ib(this._thumbLoaded,this,mc)));}.bind(this));return !!gc;},_onStickerClick:function(ec,fc){if(!ec)return;l.log('StickersLoggerConfig',{event:'click_sticker',packid:ec,stickerid:fc});var gc=this.tabView;ra.onTrayDataReady(function(){if(ya(ra.getPackIDsInTray(),ec)){var hc=ra.getPack(ec);if(hc&&hc.isPromoted)qa.addPack(ec);gc.setStickersFlyoutPackID(ec);}else sa.showStore(ec);});},_thumbLoaded:function(ec){var fc=this.scrollContainer.scrollTop+this.scrollContainer.clientHeight;if(fc+ec.offsetHeight>=this.scrollContainer.scrollHeight)this.scrollToBottom();},_checkToAnimateSticker:function(){var ec=fb(this.scrollContainer);h.inform('chatScrolled/'+this.threadID,{scrollTop:this.scrollContainer.scrollTop,top:ec.y,viewHeight:ec.height});},setNewThreadID:function(ec){if(o.get('chat_react_user_messages')){this._store.setNewThreadID(ec);}else this._newThreadID=ec;}});if(!o.get('chat_react_user_messages')){pb.subscribe('messages-reordered',function(ec,fc){bc.forEach(function(gc){fc[gc.threadID]&&gc.rerender();});});pb.subscribe('messages-updated',function(ec,fc){bc.forEach(function(gc){fc[gc.threadID]&&gc.update(fc[gc.threadID]);});});pb.subscribe('messages-received',function(ec,fc){bc.forEach(function(gc){var hc=fc[gc.threadID];if(hc&&hc.length){gc._currentMessageCount+=hc.length;gc._appendNewMessages(hc);}if(gc._newThreadID){var ic=fc[gc._newThreadID];if(ic&&ic.length){gc._currentMessageCount+=ic.length;gc._appendNewMessages(ic);gc._newThreadID=null;}}});});h.subscribe(m.getArbiterType('chat_event'),function(ec,fc){if(dc(fc.obj)){var gc=(t.getID()==fc.obj.from)?fc.obj.to:fc.obj.from,hc=ob.getThreadIdForUser(gc),ic=bc.filter(function(lc){return lc.threadID===hc;});if(ic.length>0){var jc=ic[0],kc=lb.constructLogMessageObject(ea.CHAT_WEB,hc,da.VIDEO_CALL,fc.obj);kc.author='fbid:'+fc.obj.from;jc._appendNewMessages([kc]);}}});}function dc(ec){return (ec.event_name==='installing'||ec.event_name==='install_canceled');}e.exports=cc;},null);
__d("MercuryTypeahead",["Event","ArbiterMixin","DOM","DOMDimensions","Input","Keys","MercuryTypeaheadTemplates","Tokenizer","Typeahead","TypeaheadCore","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=function(t,u){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeOrID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._heightPrev=null;this._dataSource=t;this._view=u;};q(s.prototype,h);q(s.prototype,{setPlaceholder:function(t){this._placeholder=t;return this;},setExcludedParticipantsFromThreadMeta:function(t){if(!t)return;if(!t.former_participants){this.setExcludedParticipants(t.participants);return;}var u=t.former_participants.filter(function(v){return v.is_friend===false;}).map(function(v){return v.id;});this.setExcludedParticipants(u.concat(t.participants));},setExcludedParticipants:function(t){this._exclusions=[];t.forEach(function(u){var v=u.indexOf(':');if(u.substr(0,v)=='fbid')this._exclusions.push(u.substr(v+1));}.bind(this));return this;},setViewNodeID:function(t){this._viewNodeOrID=t;},setViewNode:function(t){this._viewNodeOrID=t;},setFullWidthView:function(t){var u=i.create('div',{className:"_4ck uiTypeaheadView"});i.setContent(t,u);this.setViewNode(u);},setViewOption:function(t,u){this._viewOptions[t]=u;},addTokenizerBehavior:function(t){this._tokenizerBehaviors.push(t);},build:function(t){if(this._domElement)return;var u=m[':fb:mercury:tokenizer'].build(),v=m[':fb:mercury:typeahead'].build();this._domElement=u.getRoot();i.appendContent(this._domElement,v.getRoot());var w=v.getNode('textfield');k.setPlaceholder(w,this._placeholder);w.setAttribute('data-placeholder',this._placeholder);this._input=w;var x={node_id:this._viewNodeOrID,ctor:this._view,options:this._viewOptions},y={ctor:p,options:{setValueOnSelect:true}};this._typeahead=new o(this._dataSource,x,y,v.getRoot());this._typeahead.init();var z={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new n(this._domElement,this._typeahead);this._tokenizer.init(u.getNode('tokenarea'),'participants',[],z);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],this._tokensChanged.bind(this));this._tokenizer.subscribe('resize',function(){this.inform('resize');}.bind(this));g.listen(w,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));g.listen(this._domElement,'click',this.focus.bind(this));g.listen(w,'keydown',this.keydown.bind(this));this._heightPrev=j.getElementDimensions(this._domElement).height;},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var t=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(u){t.push('fbid:'+u);});return t;},getTokens:function(){var t=[];if(this._tokenizer)t=this._tokenizer.getTokens();return t;},getTokenizer:function(){return this._tokenizer;},keydown:function(event){if(this._tokenizer.inline&&event.keyCode==l.ESC){if(k.isEmpty(this._input)){var t=this._tokenizer.getLastToken();if(t&&t.isRemovable())this._tokenizer.removeToken(t);}else this._typeahead.getCore().reset();return false;}if(k.isEmpty(this._input)&&this._tokenizer.inline&&event.keyCode===l.RETURN){event.preventDefault();return this.inform('tokens-return');}},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);},_tokensChanged:function(){this.inform('tokens-changed');}});e.exports=s;},null);
__d("ChatAddFriendsTabSheetRawRenderer",["ContextualTypeaheadView","DOM","Event","MercuryTypeahead","ChatTabTemplates","fbt","tx","MercuryDataSourceWrapper"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=b('MercuryDataSourceWrapper').source,o={render:function(p,q,r,s,t,u){var v=u?k[':fb:mercury:chat:tab-sheet:add-friends-empty-tab'].build():k[':fb:mercury:chat:tab-sheet:add-friends'].build(),w=new j(n,g);w.setExcludedParticipantsFromThreadMeta(s);if(!u)w.setPlaceholder("Add friends to this chat");w.build();h.replace(v.getNode('participantsTypeahead'),w.getElement());h.setContent(r,v.getRoot());w.getTokenizer().adjustWidth();var x=v.getNode('participantsTypeahead').getAttribute('data-labelid'),y=h.scry(w.getElement(),'input[type="text"]')[0];if(y)if(x){y.setAttribute('aria-labelledby',x);}else y.setAttribute('aria-label',"To");w.focus();if(!u){var z=function(){var aa=w.getSelectedParticipantIDs();if(aa.length)t(aa);q.close(p);};i.listen(v.getNode('doneButton'),'click',z);w.subscribe('tokens-return',function(){if(w.getTokens().length)z();});}return w;}};e.exports=o;},null);
__d("MultiChatController",["AsyncSignal","ChatOpenTab","copyProperties","Form","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j){var k=b('MercuryMessages').get(),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get();function n(){}i(n,{subscribe:function(o,p){o.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(o,p);}.bind(this));},createGroupThreadFromChooserDialog:function(o,p){var q=j.serialize(o.getRoot()),r=JSON.parse(q.profileChooserItems),s=[];for(var t in r)if(r[t])s.push(t);var u=n.createThreadForFBIDs(s);l.subscribe('update-thread-ids',function(v,w){for(var x in w)if(w[x]==u)new g('/ajax/groups/chat/log',{group_id:p,message_id:x}).send();});o.hide();},createThreadForTokens:function(o){if(!o.length)return;var p;if(o.length==1){p='user:'+o[0].split(':')[1];}else p='root:'+k.generateNewClientMessageID(Date.now());m.createNewLocalThread(p,o);h.openThread(p,'MultiChatController');},createThreadForFBIDs:function(o){var p=[];for(var q=0;q<o.length;q++)p.push("fbid:"+o[q]);return n.createThreadForTokens(p);}});e.exports=n;},null);
__d("ChatAddFriendsTabSheet",["ArbiterMixin","ChatAddFriendsTabSheetRawRenderer","ChatOpenTab","MercuryLogMessageType","MercurySourceType","MultiChatController","Style","copyProperties","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o=b('MercuryMessages').get(),p=b('MercuryThreads').get();function q(t,u,v){this._threadID=t;this._rootElement=u;this._sheetView=v;this._typeahead=null;}n(q.prototype,g,{render:function(){p.getThreadMeta(this._threadID,function(t){var u=t.is_canonical_user?r:s;this._typeahead=h.render(this,this._sheetView,this._rootElement,t,u.bind(null,t),p.isNewEmptyLocalThread(this._threadID));this._typeahead.subscribe('tokens-changed',function(){this.inform('chat/tokens-changed',{token_count:this._typeahead.getTokens().length});}.bind(this));this._typeahead.subscribe('resize',function(){this._sheetView.resize();}.bind(this));}.bind(this));},getParticipants:function(){if(!this._typeahead)return null;return this._typeahead.getSelectedParticipantIDs();},isPermanent:function(){return true;},isSheetWithInput:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);},getHeight:function(){return m.get(this._rootElement,'height');}});function r(t,u){var v=t.participants;l.createThreadForTokens(v.concat(u));}function s(t,u){var v=t.thread_id;if(p.isEmptyLocalThread(v)){p.addParticipantsToThreadLocally(v,u);}else o.sendMessage(o.constructLogMessageObject(k.CHAT_WEB,v,j.SUBSCRIBE,{added_participants:u}));i.openThread(v,'ChatAddFriendsTabSheet');}e.exports=q;},null);
__d("ChatNameConversationTabSheetRawRenderer",["DOM","Event","Input","Keys","ChatTabTemplates","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l){"use strict";var m={render:function(n,o,p,q,r,s){var t=k[':fb:mercury:chat:tab-sheet:name-conversation'].build(),u=t.getNode('nameInput'),v=t.getNode('doneButton'),w="Done",x="Hide",y=q.name;if(y){i.setValue(u,y);}else g.setContent(v,x);var z=function(){var aa=i.getValue(u);if(aa)r(aa);s();o.close(n);};h.listen(u,'input',function(){g.setContent(v,i.getValue(u).length===0?x:w);});h.listen(v,'click',z);h.listen(u,'keyup',function(aa){if(aa.keyCode===j.RETURN){z();return false;}});g.setContent(p,t.getRoot());!n.isAutomatic()&&u.focus();}};e.exports=m;},null);
__d("ChatNameConversationTabSheet",["AsyncRequest","ChatNameConversationTabSheetRawRenderer","MercuryAPIArgsSource","MercuryLogMessageType","MercurySourceType","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryMessages').get(),m=b('MercuryServerRequests').get(),n=b('MercuryThreads').get(),o='/ajax/chat/multichat/name_conversation/dismiss.php',p={};function q(r,s,t){"use strict";this.$ChatNameConversationTabSheet0=r;this.$ChatNameConversationTabSheet1=s;this.$ChatNameConversationTabSheet2=t;this.$ChatNameConversationTabSheet3=false;}q.prototype.render=function(){"use strict";n.getThreadMeta(this.$ChatNameConversationTabSheet0,function(r){h.render(this,this.$ChatNameConversationTabSheet2,this.$ChatNameConversationTabSheet1,r,this.$ChatNameConversationTabSheet4.bind(null,r),this.$ChatNameConversationTabSheet5.bind(this,r));this.$ChatNameConversationTabSheet2.resize();}.bind(this));};q.prototype.isPermanent=function(){"use strict";return true;};q.prototype.isSheetWithInput=function(){"use strict";return true;};q.prototype.getType=function(){"use strict";return 'name_conversation_type';};q.prototype.open=function(r){"use strict";this.$ChatNameConversationTabSheet3=r;if(!(this.$ChatNameConversationTabSheet3&&this.$ChatNameConversationTabSheet6()))this.$ChatNameConversationTabSheet2.open(this);};q.prototype.close=function(){"use strict";this.$ChatNameConversationTabSheet2.close(this);};q.prototype.isAutomatic=function(){"use strict";return this.$ChatNameConversationTabSheet3;};q.prototype.$ChatNameConversationTabSheet6=function(){"use strict";return !!p[this.$ChatNameConversationTabSheet0];};q.prototype.$ChatNameConversationTabSheet7=function(){"use strict";p[this.$ChatNameConversationTabSheet0]=true;};q.prototype.$ChatNameConversationTabSheet5=function(r){"use strict";if(!r.name_conversation_sheet_dismissed||!this.$ChatNameConversationTabSheet6()){this.$ChatNameConversationTabSheet7();m.getServerThreadID(r.thread_id,function(s){new g(o).setData({thread_id:s}).send();});}};q.prototype.$ChatNameConversationTabSheet4=function(r,s){"use strict";var t=r.name;if((s||t)&&(s!=t))l.sendMessage(l.constructLogMessageObject(k.CHAT_WEB,r.thread_id,j.THREAD_NAME,{name:s}),null,i.CHAT);};e.exports=q;},null);
__d("ChatNewMessagesTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:clickable-message-icon-sheet'].build();i.setContent(m.getNode('text'),i.tx._("Scroll down to see new messages."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getRoot(),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return true;},isSheetWithInput:function(){return true;},getType:function(){return 'new_messages_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;},null);
__d("ChatNoRecipientsTabSheet",["DOM","fbt","MercuryParticipants","ChatTabTemplates","copyProperties","MercuryThreadInformer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryThreadInformer').get(),m=b('MercuryThreads').get();function n(o,p,q){this._threadID=o;this._rootElement=p;this._sheetView=q;l.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}k(n.prototype,{render:function(){var o=j[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(o.getNode('text'),"Everyone has left the conversation.");g.setContent(this._rootElement,o.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){m.getThreadMeta(this._threadID,function(o){var p=i.user,q=o.participants.filter(function(r){return r!=p;});if(q.length<1&&!m.isNewEmptyLocalThread(this._threadID)){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=n;},null);
__d("ChatOfflineTabSheet",["ChatPrivacyActionController","ChatVisibility","CSS","DOM","Event","JSLogger","MercuryParticipants","ChatTabTemplates","copyProperties","cx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=b('MercuryThreads').get();function r(s,t,u){this._rootElement=t;this._sheetView=u;this._logger=l.create('blackbird');this._canonicalUser=q.getCanonicalUserInThread(s);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}o(r.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('offline_sheet_open_with_non_friend');return;}var s=n[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),t='fbid:'+this._canonicalUser;m.get(t,function(u){var v='fbChatGoOnlineLink',w=j.tx._("turn on chat"),x=j.create('a',{href:'#',className:v},w),y=j.tx._("To chat with {name} and other friends, {link}.",{name:u.short_name,link:x});j.setContent(s.getNode('text'),y);i.addClass(s.getRoot(),"_1sk1");j.setContent(this._rootElement,s.getRoot());k.listen(this._rootElement,'click',function(event){if(i.hasClass(event.getTarget(),v)){if(h.isOnline())this._logger.error('tab_sheet_already_online');this._privacyActionController.togglePrivacy();this._logger.log('tab_sheet_go_online',{tab_id:this._canonicalUser});return false;}}.bind(this));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(s){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(s){case g.OFFLINE:this._sheetView.open(this);break;case g.NORMAL:case g.BLOCKED:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'offline_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=r;},null);
__d("ChatUploadWarningTabSheet",["DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f,g,h,i){function j(k,l,m){this._threadID=k;this._rootElement=l;this._sheetView=m;}i(j.prototype,{render:function(){var k=h[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(k.getNode('text'),g.tx._("Please wait until the upload is complete before you send your message."));g.setContent(this._rootElement,k.getRoot());},isPermanent:function(){return false;},getType:function(){return 'upload_warning_type';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=j;},null);
__d("MercuryReadOnlyReason",["React","fbt"],function(a,b,c,d,e,f,g,h){var i={getReason:function(j){if(j.has_email_participant){return (h._("Sorry, this conversation isn't active anymore because messages can no longer be sent to email addresses. Messages sent to facebook.com email addresses will now be forwarded to primary email addresses, so you can continue this conversation over email. {Learn more}.",[h.param("Learn more",g.createDescriptor(g.DOM.a,{href:"/help/224049364288051"},"Learn more"))]));}else return ("You cannot reply to this conversation.");},getEarlyWarning:function(j){if(!j.has_email_participant)return null;return (h._("We're sorry, but soon you won't be able to reply to this conversation because it includes email addresses. Please message these people through their Facebook accounts or switch over to your email account to keep this conversation going. {Learn more}.",[h.param("Learn more",g.createDescriptor(g.DOM.a,{href:"/help/703286543026907"},"Learn more"))]));}};e.exports=i;},null);
__d("ChatReadOnlyEarlyWarningTabSheet",["React","MercuryReadOnlyReason","cx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){var j=b('MercuryThreads').get();function k(l,m,n){"use strict";this.$ChatReadOnlyEarlyWarningTabSheet0=l;this.$ChatReadOnlyEarlyWarningTabSheet1=m;this.$ChatReadOnlyEarlyWarningTabSheet2=n;}k.prototype.render=function(){"use strict";var l=h.getEarlyWarning(j.getThreadMetaNow(this.$ChatReadOnlyEarlyWarningTabSheet0));g.renderComponent(g.createDescriptor(g.DOM.div,{className:"_87-"},l),this.$ChatReadOnlyEarlyWarningTabSheet1);};k.prototype.isPermanent=function(){"use strict";return false;};k.prototype.getCloseTimeout=function(){"use strict";return 20000;};k.prototype.getType=function(){"use strict";return 'chat-thread-is-read-only-early-warning';};k.prototype.open=function(){"use strict";this.$ChatReadOnlyEarlyWarningTabSheet2.open(this);};k.prototype.close=function(){"use strict";this.$ChatReadOnlyEarlyWarningTabSheet2.open(this);};e.exports=k;},null);
__d("ChatThreadIsMutedTabSheet",["Event","ArbiterMixin","DOM","ChatTabTemplates","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k){function l(m,n,o){this._threadID=m;this._rootElement=n;this._sheetView=o;}k(l.prototype,h,{render:function(){var m=j[':fb:mercury:chat:tab-sheet:message-mute-sheet'].build();i.setContent(m.getNode('text'),i.tx._("This conversation is muted. Chat tabs will not pop up for it and push notifications are off."));i.setContent(this._rootElement,m.getRoot());g.listen(m.getNode('unmuteButton'),'click',function(){this.inform('clicked',this._threadID);}.bind(this));},isPermanent:function(){return false;},getType:function(){return 'chat-thread-is-muted';},open:function(){this._sheetView.open(this);},close:function(){this._sheetView.close(this);}});e.exports=l;},null);
__d("ChatUserBlockedTabSheet",["CSS","ChatPrivacyActionController","DOM","Event","GenderConst","JSLogger","MercuryParticipants","ChatTabTemplates","copyProperties","cx","tx","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=b('MercuryThreads').get();function s(t,u,v){this._rootElement=u;this._sheetView=v;this._logger=l.create('blackbird');this._canonicalUser=r.getCanonicalUserInThread(t);if(this._canonicalUser)this._privacyActionController=new h(this._canonicalUser,this._handlePrivacyChange.bind(this));}o(s.prototype,{render:function(){if(!this._canonicalUser){this._logger.error('user_blocked_sheet_open_with_non_friend');return;}var t=n[':fb:mercury:chat:tab-sheet:user-blocked'].build(),u='fbid:'+this._canonicalUser;m.get(u,function(v){var w=null;switch(v.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:w=q._("You turned off chat for {name} but you can still send her a message. ",{name:v.short_name});break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:w=q._("You turned off chat for {name} but you can still send him a message. ",{name:v.short_name});break;default:w=q._("You turned off chat for {name} but you can still send them a message. ",{name:v.short_name});}i.setContent(t.getNode('text'),w);var x=q._("Turn on chat for {name}?",{name:v.short_name});i.setContent(t.getNode('actionLink'),x);g.addClass(t.getRoot(),"_1sk0");i.setContent(this._rootElement,t.getRoot());j.listen(t.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));this._sheetView.resize();}.bind(this));},_handlePrivacyChange:function(t){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');if(t==h.BLOCKED){var u='fbid:'+this._canonicalUser;m.get(u,function(v){if(v.is_friend){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));return;}this._sheetView.close(this);},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';},destroy:function(){this._privacyActionController&&this._privacyActionController.destroy();}});e.exports=s;},null);
__d("MercurySheetPolicy",[],function(a,b,c,d,e,f){var g={canReplaceOpenSheet:function(h,i){if(h.isSheetWithInput&&h.isSheetWithInput())return i.getType()=='add_friends_type';if(h.getType()==i.getType())return false;if(h.isPermanent()&&!i.isPermanent())return false;return true;}};e.exports=g;},null);
__d("MercurySheetView",["Animation","ArbiterMixin","MercurySheetPolicy","CSS","DOM","Style","MercurySheetTemplates","Vector","copyProperties","cx","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=5000,s=function(t,u,v){this._threadID=t;this._rootElement=u;this._tabMainElement=v;this._openSheet=null;};o(s.prototype,h,{destroy:function(){k.empty(this._rootElement);},_openCommon:function(t,u){if(this._openSheet&&!i.canReplaceOpenSheet(this._openSheet,t)){if(t.couldNotReplace)t.couldNotReplace();return;}this.clear(function(){this._openSheet=t;var v=m[':fb:mercury:tab-sheet:loading'].build().getRoot();k.setContent(this._rootElement,v);j.show(v);j.show(this._rootElement);t.render();if(u){j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var w=n.getElementDimensions(this._rootElement).y;l.set(this._rootElement,'bottom',w+'px');this.resize();this._animation=new g(this._rootElement).to('bottom',0).duration(150).ease(g.ease.both).ondone(function(){j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this.resize();}.bind(this)).go();}else this.resize();if(!t.isPermanent()){var x=r;if(t.getCloseTimeout)x=t.getCloseTimeout();var y=this.getAutoCloseCallback(t);this._sheetCloseHandler=q(this.close.bind(this,t,y),x);if(t.timeoutCanBeReset)t.setResetTimeoutCallback(this.resetTimeout.bind(this));}}.bind(this));},getAutoCloseCallback:function(t){if(!t.autoCloseCallback)return null;return t.autoCloseCallback.bind(t);},resetTimeout:function(t,u){clearTimeout(this._sheetCloseHandler);var v=this.getAutoCloseCallback(t);this._sheetCloseHandler=q(this.close.bind(this,t,v),u);},set:function(t){return this._openCommon(t,false);},open:function(t){return this._openCommon(t,true);},close:function(t,u){if(this._openSheet!=t)return;if(!this._openSheet){u&&u();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}j.addClass(this._tabMainElement,'sheetSlide');j.addClass(this._tabMainElement,"_1sk4");var v=n.getElementDimensions(this._rootElement).y;this.resize();this._animation=new g(this._rootElement).to('bottom',v+'px').duration(100).ease(g.ease.begin).ondone(function(){k.empty(this._rootElement);j.hide(this._rootElement);j.removeClass(this._tabMainElement,'sheetSlide');j.removeClass(this._tabMainElement,"_1sk4");this._openSheet=null;this.resize();u&&u();}.bind(this)).go();},clear:function(t){this.close(this._openSheet,t);},resize:function(){this.inform('resize');}});e.exports=s;},null);
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatNameConversationTabSheet","ChatNewMessagesTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatUploadWarningTabSheet","ChatReadOnlyTabSheet","ChatReadOnlyEarlyWarningTabSheet","ChatThreadIsMutedTabSheet","ChatUserBlockedTabSheet","copyProperties","MercurySheetView","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=b('MercuryThreads').get(),t=function(u,v,w){this._sheetView=new r(u,v,w);this._addFriendsTabSheet=new g(u,v,this._sheetView);this._nameConversationTabSheet=new h(u,v,this._sheetView);this._userBlockedTabSheet=new p(u,v,this._sheetView);this._offlineTabSheet=new k(u,v,this._sheetView);this._newMessagesTabSheet=new i(u,v,this._sheetView);this._uploadWarningTabSheet=new l(u,v,this._sheetView);this._threadIsMutedTabSheet=new o(u,v,this._sheetView);this._readOnlyTabSheet=new m(u,v,this._sheetView);this._readOnlyEarlyWarningTabSheet=new n(u,v,this._sheetView);if(!s.getCanonicalUserInThread(u))this._noRecipientsTabSheet=new j(u,v,this._sheetView);};q(t.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},getAddFriendsTabSheet:function(){return this._addFriendsTabSheet;},getAddFriendsParticipants:function(){var u=this._addFriendsTabSheet.getParticipants();this._addFriendsTabSheet.close();return u;},openNameConversationSheet:function(u){this._nameConversationTabSheet.open(u);},openReadOnlySheet:function(){this._readOnlyTabSheet.open();},openReadOnlyEarlyWarningSheet:function(){this._readOnlyEarlyWarningTabSheet.open();},openNewMessagesSheet:function(){this._newMessagesTabSheet.open();},openUploadWarningTabSheet:function(){this._uploadWarningTabSheet.open();},openThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.open();},closeAutomaticNameConversationSheet:function(){if(this._nameConversationTabSheet.isAutomatic())this._nameConversationTabSheet.close();},closeThreadIsMutedTabSheet:function(){this._threadIsMutedTabSheet.close();},closeNewMessagesSheet:function(){this._newMessagesTabSheet.close();},closeUploadWarningTabSheet:function(){this._uploadWarningTabSheet.close();},onClickNewMessagesSheet:function(u){this._newMessageClickSub=this._newMessagesTabSheet.subscribe('clicked',u);},onClickThreadIsMutedSheet:function(u){this._threadIsMutedClickSub=this._threadIsMutedTabSheet.subscribe('clicked',u);},onResize:function(u){this._sheetView.subscribe('resize',u);},onTokensChanged:function(u){this._addFriendsTabSheet.subscribe('chat/tokens-changed',u);},destroy:function(){this._sheetView&&this._sheetView.destroy();this._offlineTabSheet&&this._offlineTabSheet.destroy();this._userBlockedTabSheet&&this._userBlockedTabSheet.destroy();this._newMessageClickSub&&this._newMessageClickSub.unsubscribe();this._threadIsMutedClickSub&&this._threadIsMutedClickSub.unsubscribe();}});e.exports=t;},null);
__d("ContentRollTypeaheadView.react",["BackgroundImage.react","ImageBlock.react","LegacyScrollableArea.react","React","TypeaheadViewItem","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=j.createClass({displayName:'ContentRollTypeaheadViewItem',mixins:[k.Mixin],propTypes:k.propTypes,render:function(){var p=this.props.entry,q=p.getSubtitle()?j.createDescriptor(j.DOM.div,{className:"_599q"},p.getSubtitle()):null;if(q&&p.getAuxiliaryData()&&p.getAuxiliaryData().icon)q=j.createDescriptor(h,{spacing:"small"},j.createDescriptor(g,{width:16,height:16,src:p.getAuxiliaryData().icon}),q);var r=p.getPhoto()?j.createDescriptor(g,{width:32,height:32,backgroundSize:"cover",src:p.getPhoto()}):j.createDescriptor(j.DOM.span,null),s=(("_5yww")+(!q?' '+"_5mne":'')+(this.props.highlighted?' '+"_599n":''));return (j.createDescriptor(j.DOM.li,{className:s,onMouseDown:this._onSelect,onMouseEnter:this._onHighlight},j.createDescriptor(h,{spacing:"medium"},r,j.createDescriptor(j.DOM.div,null,j.createDescriptor(j.DOM.div,{className:"_599p"},p.getTitle()),q))));}}),o=j.createClass({displayName:'ContentRollTypeaheadView',propTypes:{highlightedEntry:j.PropTypes.object,entries:j.PropTypes.array.isRequired,onSelect:j.PropTypes.func.isRequired,onHighlight:j.PropTypes.func,onRenderHighlight:j.PropTypes.func,scrollableAreaHeight:j.PropTypes.number.isRequired,scrollableAreaWidth:j.PropTypes.number.isRequired},_renderItem:function(p){var q=p===this.props.highlightedEntry;return (j.createDescriptor(n,{key:p.getUniqueID(),entry:p,highlighted:q,onSelect:this.props.onSelect,onHighlight:this.props.onHighlight,onRenderHighlight:this.props.onRenderHighlight}));},render:function(){var p=(("_2072")+(!this.props.entries.length?' '+"_599s":'')),q=this.props.entries,r={};q.forEach(function(v){r[v.getType()]=r[v.getType()]||[];r[v.getType()].push(v);});var s=[];for(var t in r){var u=null;switch(t){case 'recent':u="Recently Viewed Links";break;case 'saved':u="Saved Links";break;case 'bing':u="Bing Results";break;}if(u)s.push(j.createDescriptor(j.DOM.div,{className:"_1opo"},u));r[t].forEach(function(v){s.push(this._renderItem(v));},this);}return (j.createDescriptor(j.DOM.div,{className:p},j.createDescriptor(i,{height:this.props.scrollableAreaHeight,width:this.props.scrollableAreaWidth},j.createDescriptor(j.DOM.ul,null,s))));}});e.exports=o;},null);
__d("ContentRollTypeahead.react",["AbstractTypeahead.react","React","ReactPropTypes","WebAsyncSearchSource","ContentRollTypeaheadView.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=20,o='/ajax/metacomposer/attachment/og/typeahead/content_roll',p=h.createClass({displayName:'ContentRollTypeahead',propTypes:{className:i.string,onSelection:i.func.isRequired,scrollableAreaHeight:h.PropTypes.number.isRequired,scrollableAreaWidth:h.PropTypes.number.isRequired,userID:i.string.isRequired,useLayer:i.bool},getInitialState:function(){return {query:''};},_handleChange:function(event){this.setState({query:event.target.value});},_handleSelectAttempt:function(q){this.setState({query:''});var r={object_id:q.getUniqueID(),url:q.getURI(),source:q.getType(),query:q.getAuxiliaryData().query,subindex:q.getAuxiliaryData().subindex,subtotal:q.getAuxiliaryData().subtotal,index:q.getAuxiliaryData().index,total:q.getAuxiliaryData().total};this.props.onSelection(r);},_getSearchSource:function(){if(!this._searchSource)this._searchSource=new j({bootstrapRequests:[{uri:o,data:{viewer:this.props.userID}}],queryRequests:[{uri:o,data:{viewer:this.props.userID}}],getAllForEmptyQuery:true});return this._searchSource;},_getPlaceholder:function(){if(!this._placeholder)this._placeholder="Search for articles, videos, music, and more";return this._placeholder;},focusInput:function(){this.refs.typeahead.focusInput();},render:function(){var q={ViewRenderer:k,maxEntries:n,useLayer:this.props.useLayer,extraRendererProps:{scrollableAreaHeight:this.props.scrollableAreaHeight,scrollableAreaWidth:this.props.scrollableAreaWidth}};return (h.createDescriptor(g,{autoHighlight:true,className:this.props.className,focusedOnInit:true,inputClassName:"_55r1",onChange:this._handleChange,onSelectAttempt:this._handleSelectAttempt,placeholder:this._getPlaceholder(),presenter:q,queryString:this.state.query,ref:"typeahead",searchSource:this._getSearchSource(),showEntriesOnFocus:true}));}});e.exports=p;},null);
__d("ContentRollFlyout.react",["ContentRollTypeahead.react","Parent","React","ReactPropTypes","Toggler","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=i.createClass({displayName:'ContentRollFlyout',propTypes:{onSelection:j.func.isRequired,userID:j.string.isRequired},getInitialState:function(){return {showFlyout:false};},componentDidMount:function(){var n=this._getParentToggler();if(n)k.listen('show',n,function(){this.setState({showFlyout:true});}.bind(this));},_getParentToggler:function(){return h.byClass(this.getDOMNode(),'uiToggle');},_hideParentToggler:function(){var n=this._getParentToggler();if(n)k.hide(n);},_handleSelection:function(n){this._hideParentToggler();this.props.onSelection(n);},render:function(){if(!this.state.showFlyout)return i.createDescriptor(i.DOM.div,null);return (i.createDescriptor(g,{className:"_5j11",onSelection:this._handleSelection,scrollableAreaHeight:288,scrollableAreaWidth:256,userID:this.props.userID,useLayer:false}));}});e.exports=m;},null);
__d("EmoticonUtils",["EmoticonsList","Parent","endsWith","startsWith"],function(a,b,c,d,e,f,g,h,i,j){var k='emoticon_',l=g.symbols,m={getEmoteFromTarget:function(n){var o=h.byClass(n,'emoticon');if(!o)return null;var p=null;o.className.split(' ').forEach(function(q){if(j(q,k))p=q.substring(k.length);});return l[p]||null;},insertEmoticon:function(n,o,p){var q=o.substring(0,p.start),r=o.substring(p.end);if(p.start>0&&!i(q,' '))n=' '+n;if(!j(r,' '))n+=' ';var s=q+n+r;p.start+=n.length;p.end=p.start;return {result:s,start:p.start,end:p.end};}};e.exports=m;},null);
__d("MessagesEmoticonView",["DOM","EmoticonsList","Event","Focus","InputSelection","Keys","Parent","SubscriptionsHandler","TextAreaControl","Toggler","UserAgent","copyProperties","cx","endsWith","startsWith"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){var v=h.symbols;function w(z){return m.byClass(z,"_5r8h");}function x(z,aa,ba,ca){var da=m.byClass(z,'emoticon');if(!da)return;var ea='emoticon_',fa=null;da.className.split(' ').forEach(function(ma){if(u(ma,ea))fa=ma.substring(ea.length);});if(!v[fa])return;if(!ca)return true;var ga=o.getInstance(aa),ha=ga.getValue(),ia=v[fa],ja=ha.substring(0,ba.start),ka=ha.substring(ba.end);if(ba.start>0&&!t(ja,' '))ia=' '+ia;if(!u(ka,' '))ia+=' ';var la=ja+ia+ka;ba.start+=ia.length;ba.end=ba.start;ga.setValue(la);k.set(aa,ba.start,ba.end);return true;}function y(z,aa){var ba={start:0,end:0};function ca(){ba=k.get(aa);}var da=g.find(z,'.uiToggleFlyout');this._subscriptions=new n();this._subscriptions.addSubscriptions(p.subscribe('show',function(ea,fa){if(fa.active&&g.contains(z,fa.active)){k.set(aa,ba.start,ba.end);var ga=g.scry(da,'a.emoticon')[0];ga&&j.setWithoutOutline(ga);}}),i.listen(da,'click',function(event){var ea=x(event.getTarget(),aa,ba,true);ea&&p.hide(z);}),i.listen(da,'keyup',function(event){if(event.keyCode===l.ESC){p.hide(z);k.set(aa,ba.start,ba.end);}}),i.listen(aa,'keyup',ca),i.listen(aa,'click',ca));if(q.chrome()||q.ie()||q.opera())this._subscriptions.addSubscriptions(i.listen(da,'mousedown',function(event){var ea=i.listen(document.documentElement,'click',function(event){var fa=event.getTarget(),ga=x(fa,aa,ba,false),ha=w(fa);!ga&&!ha&&p.show(z);ea.remove();});}.bind(this)));}r(y.prototype,{destroy:function(){this._subscriptions&&this._subscriptions.release();this._subscriptions=null;}});r(y,{create:function(z,aa){return new y(z,aa);}});e.exports=y;},null);
__d("NubController",["ArbiterMixin","Dock","copyProperties"],function(a,b,c,d,e,f,g,h,i){function j(){}i(j.prototype,g,{init:function(k){this.el=k;h.registerNubController(k,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){h.hide(this.el);},show:function(){h.show(this.el);}});e.exports=j;},null);
__d("SelectionPosition",["Event","InputSelection","SubscriptionsHandler","merge"],function(a,b,c,d,e,f,g,h,i,j){function k(l){"use strict";this.$SelectionPosition0=l;this.$SelectionPosition1={start:0,end:0};this.$SelectionPosition2=new i();this.$SelectionPosition3=false;this.updatePos();this.enable();}k.prototype.getPos=function(){"use strict";return j(this.$SelectionPosition1);};k.prototype.setPos=function(l,m){"use strict";this.$SelectionPosition1={start:l,end:m};this.restore();};k.prototype.updatePos=function(){"use strict";this.$SelectionPosition1=h.get(this.$SelectionPosition0);};k.prototype.restore=function(){"use strict";h.set(this.$SelectionPosition0,this.$SelectionPosition1.start,this.$SelectionPosition1.end);};k.prototype.enable=function(){"use strict";if(!this.$SelectionPosition3){this.$SelectionPosition2.addSubscriptions(g.listen(this.$SelectionPosition0,'keyup',this.updatePos.bind(this)),g.listen(this.$SelectionPosition0,'click',this.updatePos.bind(this)));this.$SelectionPosition3=true;}};k.prototype.disable=function(){"use strict";if(this.$SelectionPosition3){this.$SelectionPosition2.release();this.$SelectionPosition3=false;}};e.exports=k;},null);
__d("XUIAmbientNUX.react",["XUIAmbientNUXTheme","ContextualDialog","ContextualDialogArrow","LayerAutoFocus","LayerRefocusOnHide","React","ReactLayer","XUICloseButton.react","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=l.PropTypes,q=300,r=380,s=m.createClass({displayName:'XUIAmbientNUX',immutableProps:{modal:null},createLayer:function(u){var v=this.getContextNode(),w={alignment:this.props.alignment,arrowBehavior:i,context:v,offsetX:this.props.offsetX,offsetY:this.props.offsetY,position:this.props.position,theme:g,width:this.getWidth(this.props)},x=new h(w,u);x.disableBehavior(j);x.disableBehavior(k);x.conditionShow(this.props.shown);return x;},receiveProps:function(u){var v=this.getContextNode();this.layer.setContext(v);this.layer.setPosition(u.position).setAlignment(u.alignment).setOffsetX(u.offsetX).setOffsetY(u.offsetY).setWidth(this.getWidth(u)).conditionShow(u.shown);},getContextNode:function(){if(this.props.context)return this.props.context;var u=this.props.owner.getSiblingByRef(this.props.contextRef);return u&&u.getDOMNode();},getWidth:function(u){switch(u.width){case 'wide':return r;case 'custom':return u.customwidth;case 'auto':return null;default:return q;}}}),t=l.createClass({displayName:'XUIAmbientNUX',propTypes:{context:p.object,contextRef:p.string,position:p.oneOf(['above','below','left','right']),alignment:p.oneOf(['left','center','right']),offsetX:p.number,offsetY:p.number,width:p.oneOf(['wide','normal','auto','custom']),customwidth:p.number,shown:p.bool,onCloseButtonClick:p.func},render:function(){return (l.createDescriptor(s,Object.assign({},this.props,{owner:this}),l.createDescriptor(l.DOM.div,{className:"_36gm"},l.createDescriptor(n,{shade:"light",className:"_36gl",onClick:this.props.onCloseButtonClick}),l.createDescriptor(l.DOM.div,{className:"_36gn"},this.props.children))));}});e.exports=t;},null);
__d("StickerSearchNUX.react",["CSS","React","ReactLayeredComponentMixin","StickerServerRequests","XUIAmbientNUX.react","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=h.createClass({displayName:'StickerSearchNUX',mixins:[i],getInitialState:function(){return {nuxShown:true};},componentDidMount:function(){j.markSeenSearchTooltipNUX();},hideNUX:function(){this.setState({nuxShown:false});},onCloseButtonClicked:function(){this.hideNUX();this.props.showIndicatorFunc();},renderLayers:function(){return {stickerSearchNUX:h.createDescriptor(k,{ref:"NUX",contextRef:"container",shown:this.state.nuxShown,position:"above",width:"auto",onCloseButtonClick:this.onCloseButtonClicked},"New! Search for stickers to match your mood")};},render:function(){return (h.createDescriptor(h.DOM.span,{ref:"container"}));}});e.exports=n;},null);
__d("rebound",[],function(a,b,c,d,e,f){var g={},h=g.SpringSystem=function t(){this._springRegistry={};this._activeSprings=[];this._listeners=[];this._idleSpringIndices=[];this._boundFrameCallback=r(this._frameCallback,this);};s(h,{});s(h.prototype,{_springRegistry:null,_isIdle:true,_lastTimeMillis:-1,_activeSprings:null,_listeners:null,_idleSpringIndices:null,_frameCallback:function(){this.loop();},_frameCallbackId:null,createSpring:function(t,u){var v=new i(this);this.registerSpring(v);if(typeof t==='undefined'||typeof u==='undefined'){v.setSpringConfig(k.DEFAULT_ORIGAMI_SPRING_CONFIG);}else{var w=k.fromOrigamiTensionAndFriction(t,u);v.setSpringConfig(w);}return v;},getIsIdle:function(){return this._isIdle;},getSpringById:function(t){return this._springRegistry[t];},getAllSprings:function(){return Object.values(this._springRegistry);},registerSpring:function(t){this._springRegistry[t.getId()]=t;},deregisterSpring:function(t){m(this._activeSprings,t);delete this._springRegistry[t.getId()];},advance:function(t,u){while(this._idleSpringIndices.length>0)this._idleSpringIndices.pop();for(var v=0,w=this._activeSprings.length;v<w;v++){var x=this._activeSprings[v];if(x.systemShouldAdvance()){x.advance(t/1000,u/1000);}else this._idleSpringIndices.push(this._activeSprings.indexOf(x));}while(this._idleSpringIndices.length>0){var y=this._idleSpringIndices.pop();y>=0&&this._activeSprings.splice(y,1);}},loop:function(){var t,u=Date.now();if(this._lastTimeMillis===-1)this._lastTimeMillis=u-1;var v=u-this._lastTimeMillis;this._lastTimeMillis=u;var w=0,x=this._listeners.length;for(w=0;w<x;w++){t=this._listeners[w];t.onBeforeIntegrate&&t.onBeforeIntegrate(this);}this.advance(u,v);if(this._activeSprings.length===0){this._isIdle=true;this._lastTimeMillis=-1;}for(w=0;w<x;w++){t=this._listeners[w];t.onAfterIntegrate&&t.onAfterIntegrate(this);}n(this._frameCallbackId);if(!this._isIdle)this._frameCallbackId=o(this._boundFrameCallback);},activateSpring:function(t){var u=this._springRegistry[t];if(this._activeSprings.indexOf(u)==-1)this._activeSprings.push(u);if(this.getIsIdle()){this._isIdle=false;n(this._frameCallbackId);this._frameCallbackId=o(this._boundFrameCallback);}},addListener:function(t){this._listeners.push(t);},removeListener:function(t){m(this._listeners,t);},removeAllListeners:function(){this._listeners=[];}});var i=g.Spring=function t(u){this._id=t._ID++;this._springSystem=u;this._listeners=[];this._currentState=new j();this._previousState=new j();this._tempState=new j();};s(i,{_ID:0,MAX_DELTA_TIME_SEC:.064,SOLVER_TIMESTEP_SEC:.001});s(i.prototype,{_id:0,_springConfig:null,_overshootClampingEnabled:false,_currentState:null,_previousState:null,_tempState:null,_startValue:0,_endValue:0,_wasAtRest:true,_restSpeedThreshold:.001,_displacementFromRestThreshold:.001,_listeners:null,_timeAccumulator:0,_springSystem:null,destroy:function(){this._listeners=[];this._springSystem.deregisterSpring(this);},getId:function(){return this._id;},setSpringConfig:function(t){this._springConfig=t;return this;},getSpringConfig:function(){return this._springConfig;},setCurrentValue:function(t){this._startValue=t;this._currentState.position=t;for(var u=0,v=this._listeners.length;u<v;u++){var w=this._listeners[u];w.onSpringUpdate&&w.onSpringUpdate(this);}return this;},getStartValue:function(){return this._startValue;},getCurrentValue:function(){return this._currentState.position;},getCurrentDisplacementDistance:function(){return this.getDisplacementDistanceForState(this._currentState);},getDisplacementDistanceForState:function(t){return Math.abs(this._endValue-t.position);},setEndValue:function(t){if(this._endValue==t&&this.isAtRest())return this;this._startValue=this.getCurrentValue();this._endValue=t;this._springSystem.activateSpring(this.getId());for(var u=0,v=this._listeners.length;u<v;u++){var w=this._listeners[u];w.onSpringEndStateChange&&w.onSpringEndStateChange(this);}return this;},getEndValue:function(){return this._endValue;},setVelocity:function(t){this._currentState.velocity=t;return this;},getVelocity:function(){return this._currentState.velocity;},setRestSpeedThreshold:function(t){this._restSpeedThreshold=t;return this;},getRestSpeedThreshold:function(){return this._restSpeedThreshold;},setRestDisplacementThreshold:function(t){this._displacementFromRestThreshold=t;},getRestDisplacementThreshold:function(){return this._displacementFromRestThreshold;},setOvershootClampingEnabled:function(t){this._overshootClampingEnabled=t;return this;},isOvershootClampingEnabled:function(){return this._overshootClampingEnabled;},isOvershooting:function(){return (this._startValue<this._endValue&&this.getCurrentValue()>this._endValue)||(this._startValue>this._endValue&&this.getCurrentValue()<this._endValue);},advance:function(t,u){var v=this.isAtRest();if(v&&this._wasAtRest)return;var w=u;if(u>i.MAX_DELTA_TIME_SEC)w=i.MAX_DELTA_TIME_SEC;this._timeAccumulator+=w;var x=this._springConfig.tension,y=this._springConfig.friction,z=this._currentState.position,aa=this._currentState.velocity,ba=this._tempState.position,ca=this._tempState.velocity,da,ea,fa,ga,ha,ia,ja,ka,la,ma;while(this._timeAccumulator>=i.SOLVER_TIMESTEP_SEC){this._timeAccumulator-=i.SOLVER_TIMESTEP_SEC;if(this._timeAccumulator<i.SOLVER_TIMESTEP_SEC){this._previousState.position=z;this._previousState.velocity=aa;}da=aa;ea=(x*(this._endValue-ba))-y*aa;ba=z+da*i.SOLVER_TIMESTEP_SEC*.5;ca=aa+ea*i.SOLVER_TIMESTEP_SEC*.5;fa=ca;ga=(x*(this._endValue-ba))-y*ca;ba=z+fa*i.SOLVER_TIMESTEP_SEC*.5;ca=aa+ga*i.SOLVER_TIMESTEP_SEC*.5;ha=ca;ia=(x*(this._endValue-ba))-y*ca;ba=z+ha*i.SOLVER_TIMESTEP_SEC*.5;ca=aa+ia*i.SOLVER_TIMESTEP_SEC*.5;ja=ca;ka=(x*(this._endValue-ba))-y*ca;la=1/6*(da+2*(fa+ha)+ja);ma=1/6*(ea+2*(ga+ia)+ka);z+=la*i.SOLVER_TIMESTEP_SEC;aa+=ma*i.SOLVER_TIMESTEP_SEC;}this._tempState.position=ba;this._tempState.velocity=ca;this._currentState.position=z;this._currentState.velocity=aa;if(this._timeAccumulator>0)this.interpolate(this._timeAccumulator/i.SOLVER_TIMESTEP_SEC);if(this.isAtRest()||this._overshootClampingEnabled&&this.isOvershooting()){this._startValue=this._endValue;this._currentState.position=this._endValue;this.setVelocity(0);v=true;}var na=false;if(this._wasAtRest){this._wasAtRest=false;na=true;}var oa=false;if(v){this._wasAtRest=true;oa=true;}for(var pa=0,qa=this._listeners.length;pa<qa;pa++){var ra=this._listeners[pa];if(na)ra.onSpringActivate&&ra.onSpringActivate(this);ra.onSpringUpdate&&ra.onSpringUpdate(this);if(oa)ra.onSpringAtRest&&ra.onSpringAtRest(this);}},systemShouldAdvance:function(){return !this.isAtRest()||!this.wasAtRest();},wasAtRest:function(){return this._wasAtRest;},isAtRest:function(){return Math.abs(this._currentState.velocity)<this._restSpeedThreshold&&this.getDisplacementDistanceForState(this._currentState)<=this._displacementFromRestThreshold;},setAtRest:function(){this._endValue=this._currentState.position;this._tempState.position=this._currentState.position;this._currentState.velocity=0;return this;},interpolate:function(t){this._currentState.position=this._currentState.position*t+this._previousState.position*(1-t);this._currentState.velocity=this._currentState.velocity*t+this._previousState.velocity*(1-t);},addListener:function(t){this._listeners.push(t);return this;},removeListener:function(t){m(this._listeners,t);return this;},removeAllListeners:function(){this._listeners=[];return this;},currentValueIsApproximately:function(t){return Math.abs(this.getCurrentValue()-t)<=this.getRestDisplacementThreshold();}});var j=function t(){};s(j.prototype,{position:0,velocity:0});var k=g.SpringConfig=function t(u,v){this.tension=u;this.friction=v;},l={tensionFromOrigamiValue:function(t){return (t-30)*3.62+194;},origamiValueFromTension:function(t){return (t-194)/3.62+30;},frictionFromOrigamiValue:function(t){return (t-8)*3+25;},origamiFromFriction:function(t){return (t-25)/3+8;}};s(k,{fromOrigamiTensionAndFriction:function(t,u){return new k(l.tensionFromOrigamiValue(t),l.frictionFromOrigamiValue(u));}});k.DEFAULT_ORIGAMI_SPRING_CONFIG=k.fromOrigamiTensionAndFriction(40,7);s(k.prototype,{friction:0,tension:0});g.MathUtil={mapValueInRange:function(t,u,v,w,x){var y=v-u,z=x-w,aa=(t-u)/y;return w+(aa*z);}};function m(t,u){var v=t.indexOf(u);v!=-1&&t.splice(v,1);}function n(t){return typeof window!='undefined'&&window.cancelAnimationFrame&&window.cancelAnimationFrame(t);}function o(t){var u=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;return u(t);}var p=Array.prototype.concat,q=Array.prototype.slice;function r(t,u){var v=q.call(arguments,2);return function(){t.apply(u,p.call(v,q.call(arguments)));};}function s(t,u){for(var v in u)if(u.hasOwnProperty(v))t[v]=u[v];}e.exports=g;},null);
__d("StickerTriggerImage.react",["React","Image.react","rebound"],function(a,b,c,d,e,f,g,h,i){'use strict';var j=g.createClass({displayName:'StickerTriggerImage',propTypes:{stickers:g.PropTypes.array},getDefaultProps:function(){return {stickers:[]};},getInitialState:function(){return {index:0};},componentWillMount:function(){this._springSystem=new i.SpringSystem();this._spring=this._springSystem.createSpring(50,3);this._spring.addListener({onSpringUpdate:function(k){var l=k.getCurrentValue();l=i.MathUtil.mapValueInRange(l,0,1,1,.5);this._scale(this.getDOMNode(),l);}.bind(this)});this._spring.setEndValue(0);},componentDidMount:function(){this._stopIntervalID=setInterval(this.incrementIndex,3000);},componentWillUnmount:function(){clearInterval(this._stopIntervalID);},componentWillUpdate:function(k,l){if(this.props.stickers.length===0&&k.stickers.length>=0){this._spring.setEndValue(1);setTimeout(function(){return this._spring.setEndValue(0);}.bind(this),100);}},_scale:function(k,l){if(k)k.style.mozTransform=k.style.msTransform=k.style.webkitTransform=k.style.transform='scale3d('+l+', '+l+', 1)';},incrementIndex:function(){var k=this.state.index;if(k<this.props.stickers.length-1){k++;}else k=0;this.setState({index:k});},render:function(){if(this.props.stickers.length===0)return null;return (g.createDescriptor(h,{className:"stickerTriggerImage",src:this.props.stickers[this.state.index].triggerSourceURI}));}});e.exports=j;},null);
__d("md5",["str2rstr"],function(a,b,c,d,e,f,g){function h(u,v){var w=u[0],x=u[1],y=u[2],z=u[3];w=j(w,x,y,z,v[0],7,-680876936);z=j(z,w,x,y,v[1],12,-389564586);y=j(y,z,w,x,v[2],17,606105819);x=j(x,y,z,w,v[3],22,-1044525330);w=j(w,x,y,z,v[4],7,-176418897);z=j(z,w,x,y,v[5],12,1200080426);y=j(y,z,w,x,v[6],17,-1473231341);x=j(x,y,z,w,v[7],22,-45705983);w=j(w,x,y,z,v[8],7,1770035416);z=j(z,w,x,y,v[9],12,-1958414417);y=j(y,z,w,x,v[10],17,-42063);x=j(x,y,z,w,v[11],22,-1990404162);w=j(w,x,y,z,v[12],7,1804603682);z=j(z,w,x,y,v[13],12,-40341101);y=j(y,z,w,x,v[14],17,-1502002290);x=j(x,y,z,w,v[15],22,1236535329);w=k(w,x,y,z,v[1],5,-165796510);z=k(z,w,x,y,v[6],9,-1069501632);y=k(y,z,w,x,v[11],14,643717713);x=k(x,y,z,w,v[0],20,-373897302);w=k(w,x,y,z,v[5],5,-701558691);z=k(z,w,x,y,v[10],9,38016083);y=k(y,z,w,x,v[15],14,-660478335);x=k(x,y,z,w,v[4],20,-405537848);w=k(w,x,y,z,v[9],5,568446438);z=k(z,w,x,y,v[14],9,-1019803690);y=k(y,z,w,x,v[3],14,-187363961);x=k(x,y,z,w,v[8],20,1163531501);w=k(w,x,y,z,v[13],5,-1444681467);z=k(z,w,x,y,v[2],9,-51403784);y=k(y,z,w,x,v[7],14,1735328473);x=k(x,y,z,w,v[12],20,-1926607734);w=l(w,x,y,z,v[5],4,-378558);z=l(z,w,x,y,v[8],11,-2022574463);y=l(y,z,w,x,v[11],16,1839030562);x=l(x,y,z,w,v[14],23,-35309556);w=l(w,x,y,z,v[1],4,-1530992060);z=l(z,w,x,y,v[4],11,1272893353);y=l(y,z,w,x,v[7],16,-155497632);x=l(x,y,z,w,v[10],23,-1094730640);w=l(w,x,y,z,v[13],4,681279174);z=l(z,w,x,y,v[0],11,-358537222);y=l(y,z,w,x,v[3],16,-722521979);x=l(x,y,z,w,v[6],23,76029189);w=l(w,x,y,z,v[9],4,-640364487);z=l(z,w,x,y,v[12],11,-421815835);y=l(y,z,w,x,v[15],16,530742520);x=l(x,y,z,w,v[2],23,-995338651);w=m(w,x,y,z,v[0],6,-198630844);z=m(z,w,x,y,v[7],10,1126891415);y=m(y,z,w,x,v[14],15,-1416354905);x=m(x,y,z,w,v[5],21,-57434055);w=m(w,x,y,z,v[12],6,1700485571);z=m(z,w,x,y,v[3],10,-1894986606);y=m(y,z,w,x,v[10],15,-1051523);x=m(x,y,z,w,v[1],21,-2054922799);w=m(w,x,y,z,v[8],6,1873313359);z=m(z,w,x,y,v[15],10,-30611744);y=m(y,z,w,x,v[6],15,-1560198380);x=m(x,y,z,w,v[13],21,1309151649);w=m(w,x,y,z,v[4],6,-145523070);z=m(z,w,x,y,v[11],10,-1120210379);y=m(y,z,w,x,v[2],15,718787259);x=m(x,y,z,w,v[9],21,-343485551);u[0]=s(w,u[0]);u[1]=s(x,u[1]);u[2]=s(y,u[2]);u[3]=s(z,u[3]);}function i(u,v,w,x,y,z){v=s(s(v,u),s(x,z));return s((v<<y)|(v>>>(32-y)),w);}function j(u,v,w,x,y,z,aa){return i((v&w)|((~v)&x),u,v,y,z,aa);}function k(u,v,w,x,y,z,aa){return i((v&x)|(w&(~x)),u,v,y,z,aa);}function l(u,v,w,x,y,z,aa){return i(v^w^x,u,v,y,z,aa);}function m(u,v,w,x,y,z,aa){return i(w^(v|(~x)),u,v,y,z,aa);}function n(u){var v=u.length,w=[1732584193,-271733879,-1732584194,271733878],x;for(x=64;x<=u.length;x+=64)h(w,o(u.substring(x-64,x)));u=u.substring(x-64);var y=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(x=0;x<u.length;x++)y[x>>2]|=u.charCodeAt(x)<<((x&3)<<3);y[x>>2]|=128<<((x&3)<<3);if(x>55){h(w,y);for(x=0;x<16;x++)y[x]=0;}y[14]=v*8;h(w,y);return w;}function o(u){var v=[],w=0;while(w<64)v[w>>2]=u.charCodeAt(w++)|(u.charCodeAt(w++)<<8)|(u.charCodeAt(w++)<<16)|(u.charCodeAt(w++)<<24);return v;}var p='0123456789abcdef'.split('');function q(u){var v='',w=0;for(;w<4;w++)v+=p[(u>>((w<<3)+4))&15]+p[(u>>(w<<3))&15];return v;}function r(u){for(var v=0;v<u.length;v++)u[v]=q(u[v]);return u.join('');}var s=function(u,v){return (u+v)&4294967295;};function t(u){if(null===u||undefined===u){return null;}else{for(var v=0;v<u.length;v++)if(u[v]>"\u007F"){u=g(u);break;}return r(n(u));}}if(t('hello')!='5d41402abc4b2a76b9719d911017c592')s=function(u,v){var w=(u&65535)+(v&65535),x=(u>>16)+(v>>16)+(w>>16);return (x<<16)|(w&65535);};e.exports=t;},null);
__d("WaterfallIDGenerator",["CurrentUser","md5"],function(a,b,c,d,e,f,g,h){function i(){var l=2147483647;return Math.random()*l;}function j(){return Math.floor(Date.now()/1000);}var k={generate:function(){return h([g.getID(),j(),i()].join(':'));}};e.exports=k;},null);
__d("XStickerReplyNUXControllerURIBuilder",["XControllerURIBuilder"],function(a,b,c,d,e,f){e.exports=b('XControllerURIBuilder').create("\/stickers\/tooltip\/",{});},null);
__d("ChatTabView",["Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AsyncSignal","AvailableListConstants","ChatBehavior","ChatConfig","ChatContextualDialogController","ChatFileUploader.react","ChatOpenTab","ChatPhotoEditorContextualDialog","ChatPhotoUploader.react","ChatPrivacyActionController","ChatQuietLinks","ChatShareLinkUploader","ChatStickerButton.react","ChatTabMenu.react","ChatTabMessagesView","ChatTabSheetController","ChatVisibility","MercuryConstants","ContentRollFlyout.react","CurrentUser","CSS","CurrentLocale","Dialog","Dock","DOM","DOMQuery","DragDropTarget","EmoticonsList","EmoticonUtils","Event","Focus","Input","Keys","Locale","MercuryConfig","MercuryIDs","MercuryFileUploader","MercuryLogMessageType","MercuryParticipants","MercurySourceType","MercuryThreadMetadataRawRenderer","MercuryThreadMuter","MercuryTypingReceiver","MessagesEmoticonView","NubController","Parent","PhotosUploadWaterfall","PresencePrivacy","PresenceStatus","React","Run","SelectionPosition","StickerActions","StickerConstants","StickersFlyout.react","StickerState","StickerSearch","StickerSearchNUX.react","StickerTriggerImage.react","Style","SubscriptionsHandler","ChatTabTemplates","TextAreaControl","Toggler","Tooltip","TypingDetectorController","URI","UserAgent","VideoCallCore","WaterfallIDGenerator","XStickerReplyNUXControllerURIBuilder","copyProperties","cx","csx","fbt","getActiveElement","isEmpty","setIntervalAcrossTransitions","throttle","tx","OrionTrigger","MercuryMessages","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,rb,sb,tb,ub,vb,wb,xb,yb,zb,ac,bc,cc,dc,ec,fc,gc,hc,ic,jc,kc,lc){"use strict";var mc=b('OrionTrigger').module,nc=b('MercuryMessages').get(),oc=b('MercuryServerRequests').get(),pc=b('MercuryThreadInformer').get(),qc=b('MercuryThreadMetadataRenderer').get(),rc=b('MercuryThreads').get(),sc=/^\s*$/,tc={},uc=null,vc,wc=10;function xc(sd,td){var ud=ia.create('div');td=td&&td.filter(function(xd){return xd!=wa.user;});if(ic(td))return wb.remove(sd);var vd=td.length,wd=vd-wc;if(wd>1)td=td.slice(0,wc);wa.getMulti(td,function(xd){for(var yd in xd){var zd=xd[yd],ae=tb[':fb:mercury:chat:multichat-tooltip-item'].build();ia.setContent(ae.getNode('name'),zd.name);var be=wa.getUserID(yd),ce=be&&gb.get(be)==l.ACTIVE;ea.conditionShow(ae.getNode('icon'),ce);ea.conditionClass(ae.getNode('name'),'tooltipItemWithIcon',ce);ia.appendContent(ud,ae.getRoot());}if(wd>1){var de=gc._("and {number of hidden chat participants} more.",[gc.param("number of hidden chat participants",wd)]);ia.appendContent(ud,ia.create('div',{},de));}wb.set(sd,ud,'above');});}var yc={},zc=null,ad=false;function bd(sd,td,ud){if(ud){yc[sd]=td;if(!zc)zc=jc(cd,600);}else{ea.removeClass(td,'highlightTitle');delete yc[sd];}}function cd(){for(var sd in yc){var td=yc[sd];if(td.parentNode){ea.conditionClass(td,'highlightTitle',ad);}else delete yc[sd];}ad=!ad;if(!Object.keys(yc).length){clearInterval(zc);zc=null;}}function dd(sd){var td=oc.tokenizeThreadID(sd);switch(td.type){case 'user':return tb[':fb:mercury:chat:user-tab'].build();}return tb[':fb:mercury:chat:multichat-tab'].build();}function ed(sd){var td=sd._tabTemplate.getNode('input').value||'',ud=sd._fileUploader.getAttachments();if(kd(sd))gd(sd,td,ud,function(vd){var wd=sd._fileUploader.getImageFiles();if(wd.length>0){vd.image_ids=wd;vd.has_attachment=true;}var xd=sd._fileUploader.getVideoFiles();if(xd.length>0){vd.video_ids=xd;vd.has_attachment=true;}nc.sendMessage(vd);sd._fileUploader.removeAttachments();sd._shareLinkUploader.clear();sd._getNode('input').value='';sd._typingDetector&&sd._typingDetector.resetState();sd._messagesView&&sd._messagesView.scrollToBottom();});}function fd(sd,td){if(td===0)return;nd(sd,eb.POST_PUBLISHED,{count:td});sd._waterfallID=bc.generate();}function gd(sd,td,ud,vd){rc.getThreadMeta(sd._threadID,function(wd){var xd=nc.constructUserGeneratedMessageObject(td,xa.CHAT_WEB,sd._threadID);if(ud.length>0){xd.has_attachment=true;xd.raw_attachments=ud;}var yd=sd._shareLinkUploader.getAttachData();if(yd){xd.has_attachment=true;xd.content_attachment=yd;}if(rc.isNewEmptyLocalThread(sd._threadID)){var zd=sd._sheetController.getAddFriendsParticipants();if(zd===null||zd.length===0){return;}else if(zd.length===1){var ae='user:'+wa.getUserID(zd[0]);xd.thread_id=ae;}else rc.addParticipantsToThreadLocally(sd._threadID,zd);}if(rc.isEmptyLocalThread(sd._threadID)){var be=oc.tokenizeThreadID(sd._threadID);xd.message_id=be.value;xd.specific_to_list=wd.participants;}if(typeof xd!='undefined')xd.signatureID=sd._signatureID;xd.ui_push_phase=ba.UIPushPhase;vd(xd);if(sd._threadID!==xd.thread_id&&!sd._photoUploader.isUploading()){od.inform('closed-tab',sd._threadID);q.openThread(xd.thread_id,'ChatTabView');}});}function hd(sd){sd._blocked=true;sd._sheetController.openUploadWarningTabSheet();}function id(sd){return (sd._fileUploader.isUploading()||sd._photoUploader.isUploading());}function jd(sd){return sd._fileUploader.isUploading();}function kd(sd){var td=sd._tabTemplate.getNode('input').value||'';if(!sc.test(td))return true;if(sd._fileUploader.getAttachments().length>0||sd._fileUploader.getImageFiles().length>0||sd._fileUploader.getVideoFiles().length>0)return true;if(sd._shareLinkUploader.getAttachData())return true;return false;}function ld(sd){if(sd._blocked){if(jd(sd))return;sd._blocked=false;ed(sd);sd._sheetController.closeUploadWarningTabSheet();}}function md(sd){sd._nubController.flyoutContentChanged();sd._attachmentsDiv.scrollTop=sd._attachmentsDiv.scrollHeight;}function nd(sd,td,ud){eb.sendSignal(dc({qn:sd._waterfallID,step:td,uploader:eb.APP_CHAT},ud||{}));}function od(sd,td,ud){if(td)oc.ensureThreadIsFetched(td);this._threadID=sd;this._signatureID=ud;this._eventListeners=[];this._isDragDropActive=false;this._tabTemplate=dd(sd);this._tabElem=this._tabTemplate.getRoot();this._titlebar=this._getNode('nubFlyoutTitlebar');this._iconsContainerNode=this._getNode('iconsContainer');this._inputContainerNode=this._getNode('inputContainer');this._waterfallID=bc.generate();this._subscriptionsHandler=new sb();this._initializeAutoSendPhotoUploader();this._stickersFlyoutShown=false;var vd=ja.scry(this._tabElem,"._1ia");if(vd&&vd.length>0&&sa.DragDropAttachmentsGK){this._dropTarget=new ka(vd[0]);this._dropTarget.setOnFilesDropCallback(this._filesDropped.bind(this));this._dropTarget.setOnURLDropCallback(this._linkDropped.bind(this));this._dropTarget.enable();}this._attachmentsDiv=this._getNode('attachmentShelf');this._shareLinkUploader=new v(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('input'),this.focus.bind(this));this._initializeUploader(this._shareLinkUploader);this._sheetController=new z(this._threadID,this._getNode('sheet'),this._tabElem);if(n.get('chat_react_option_menu')){this._initializeReactMenu(this._tabTemplate.getNode('attachmentShelf'));}else{this._fileUploader=new ua(this._tabTemplate.getNode('attachmentShelf'),this._tabTemplate.getNode('attachButtonForm'),this._tabTemplate.getNode('fileInput'),this._tabTemplate.getNode('attachID'));this._initializeUploader(this._fileUploader);}this._sheetController.onClickNewMessagesSheet(function(){this._messagesView&&this._messagesView.scrollToBottom();this.focus();od.inform('read',this._threadID);}.bind(this));this._sheetController.onClickThreadIsMutedSheet(function(){rc.updateThreadMuteSetting(this._threadID,0);this.focus();}.bind(this));this._nubController=new cb().init(this._tabElem);this._sheetController.onResize(this._nubController.flyoutContentChanged.bind(this._nubController));this._sheetController.onTokensChanged(function(he,ie){rc.getThreadMeta(this._threadID,function(je){this._updateControls(je,ie.token_count);}.bind(this));}.bind(this));this._contextualDialogController=new o(this._threadID,this._getNode('videoCallLink'));if(uc===null)uc=!n.get('seen_autosend_photo_nux');this._messagesView=null;var wd=this._getNode('titlebarText'),xd=function(he){wd.setAttribute('href',he);wd.removeAttribute('rel');ea.removeClass(wd,'noLink');};if(n.get('chat_react_option_menu')){qc.getWebMessengerURL(sd,function(he){return xd(he);});}else{var yd=this._getNode('conversationLink');ea.hide(yd);qc.renderWebMessengerLink(sd,yd,function(){ea.show(yd);xd(yd.href);});}if(!rc.getCanonicalUserInThread(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var zd=this._getCanonicalUserID();if(this._getCanonicalUserID()){wa.get(wa.getIDForUser(zd),function(he){if(he.href)xd(he.href);});}else if(n.get('chat_react_option_menu')&&this._reactChatTabMenu.props.fullURL){xd(this._reactChatTabMenu.props.fullURL);}else if(yd&&yd.href)xd(yd.href);var ae=this._inputContainerNode.clientHeight;ub.getInstance(this._getNode('input')).subscribe('resize',function(){var he=this._inputContainerNode.clientHeight;if(he!=ae)this._nubController.flyoutContentChanged();ae=he;}.bind(this));this._nubController.subscribe('resize',function(){this._resizeInputContainer();}.bind(this));this._setNameConversationLink();this._listen('closeButton','click',this._closeClicked);this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('titlebarCloseButton','keyup',this._closeEnter);this._listen('titlebarCloseButton','mousedown',this._closePreClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('inputContainer','click',this._inputContainerClicked);this._listen('addFriendLink','click',this._addFriendLinkClicked,true);this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);this._listen('nameConversationLink','click',this._nameConversationLinkClicked,true);this._listen('clearWindowLink','click',this._clearHistory,true);this._listen('unsubscribeLink','click',this._unsubscribeLinkClicked,true);this._listen('videoCallLink','click',this._callClicked,true);this._listen('reportSpamLink','click',this._reportSpamClicked,true);this._listen('createGroupLink','click',this._createGroupClicked,true);this._listen('enableDesktopNotif','click',this._enableDesktopNotif,true);this._listen('muteThreadLink','click',za.showMuteChangeDialog.bind(null,this._threadID),true);this._listen('unmuteThreadLink','click',function(){rc.updateThreadMuteSetting(this._threadID,0);vb.hide();}.bind(this),true);this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._listen('input','paste',this._inputPasted);this._listen('sheet','keydown',function(event){if(!event.getModifiers().any&&event.keyCode===qa.TAB){this._getNode('input').focus();event.kill();}}.bind(this));var be=this._getNode('emoticons');this._emoticonView=null;if(be){this._emoticonView=new bb(be,this._getNode('input'));this._stickersFlyoutToggler=be;}if(sa.WebStickerTrigger){this._triggeredWord=null;this._stickerTriggerImage=hb.renderComponent(hb.createDescriptor(qb,null),this._getNode('stickersTriggerImageContainer'));this._subscriptionsHandler.addSubscriptions(vb.listen('show',this._stickersFlyoutToggler,function(event){if(this._triggeredWord&&!this._userUsedTrigger){this._userUsedTrigger=true;this._stickersFlyout.setProps({packID:lb.SEARCH_PACK_ID,trigger:this._triggeredWord});this._stickerTriggerImage.setProps({stickers:[]});}}.bind(this)));this._listen('input','keyup',kc(this._inputChanged,1000,this));}if(nb.shouldShowStickerSearchNUXIndicator()){this._addStickerSearchNUXIndicator();this._listen('emoticons','click',function(){if(nb.shouldShowStickerSearchNUXIndicator()){kb.selectPack(lb.SEARCH_PACK_ID);nb.clearShowStickerSearchNUXIndicator();}g.inform('stickerSearchNUXIndicator/hide');},true);g.subscribeOnce('stickerSearchNUXIndicator/hide',function(){this._clearStickerSearchNUXIndicator();this._clearStickerSearchNUXTooltip();}.bind(this));od.subscribe('lower-activated',function(he,ie){if(ie===this._threadID&&nb.shouldShowStickerSearchNUXIndicator()){this._clearStickerSearchNUXTooltip();this._addStickerSearchNUXIndicator();}}.bind(this));}this._stickersFlyoutPackID=null;if(n.get('chat_react_sticker_button')){this._selectionPosition=new jb(this._getNode('input'));this._stickerButton=hb.renderComponent(hb.createDescriptor(w,{onFlyoutShown:function(he){this._stickersFlyoutShown=true;if(he)this.focus();}.bind(this),onFlyoutHidden:function(){return this._stickersFlyoutShown=false;}.bind(this),onStickerSelect:this._stickerSelected.bind(this),onEmoticonSelect:this._emoticonSelected.bind(this)}),this._getNode('stickerButtonContainer'));this._eventListeners.push(nb.addListener(nb.PACK_SELECTED,function(he){if(this._stickerButton&&this._stickerButton.isMounted())this._stickerButton.setProps({packID:he});}.bind(this)));}else{var ce=this._getNode('stickers');if(ce)this._stickersFlyout=hb.renderComponent(hb.createDescriptor(mb,{onStickerSelect:function(he){this._stickerSelected(he);}.bind(this),onShown:function(){return this._stickersFlyoutShown=true;}.bind(this),onHidden:function(){return this._stickersFlyoutShown=false;}.bind(this),onEscKeyDown:this._hideStickersFlyoutIfShown.bind(this)}),ce);this._eventListeners.push(nb.addListener(nb.PACK_SELECTED,function(he){if(this._stickersFlyout&&this._stickersFlyout.isMounted())this._stickersFlyout.setProps({packID:he});}.bind(this)));}if(mc){this._orionTriggerContainer=this._getNode('orionTriggerContainer');this._orionTrigger=hb.renderComponent(hb.createDescriptor(mc,{onTrigger:this._orionTriggered.bind(this)}),this._orionTriggerContainer);}var de=this._getNode('contentRoll');if(de)hb.renderComponent(hb.createDescriptor(ca,{onSelection:function(he){this._shareLinkUploader&&this._shareLinkUploader.loadShare(he.url,{content_roll_entry:he});this.focus();}.bind(this),userID:da.getID()}),de);if(zb.firefox()&&fa.get()=='ko_KR'){this._listen('input','keyup',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._privacyLink=this._getNode('privacyLink');if(this._privacyLink){this._privacyActionController=new t(zd,this._updatePrivacyLink.bind(this));this._eventListeners.push(na.listen(this._privacyLink,'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController)));}rc.getThreadMeta(this._threadID,function(he){oc.getServerThreadID(this._threadID,function(je){this._typingDetector=new xb(zd,this._getNode('input'),'mercury-chat',null,je);}.bind(this));this._setUpMutingSettings(he);if(sa.PicassoWebChatGK){var ie=this._tabTemplate.getNode('photoAttachmentMenu');new r(this._tabTemplate.getNode('photoAttachLink'),this._tabTemplate.getNode('editPhotoLink'),this._tabTemplate.getNode('newPhotoLink'),ie,this._threadID);}}.bind(this));var ee=this._getNode('muteGroupLink');if(ee){var fe=rc.getCanonicalGroupInThread(this._threadID);if(fe)ee.setAttribute('ajaxify',yb(ee.getAttribute('ajaxify')).addQueryData({id:fe}));}u.removeEmptyHrefs(this._tabElem);tc[sd]=this;this.updateAvailableStatus();this.updateTab();this._setCloseTooltip(false);var ge={threadID:sd,userID:zd,signatureID:this._signatureID};new k('/ajax/chat/opentab_tracking.php',ge).send();ib.onBeforeUnload(function(){if(this._hasUnfinishedPost())return "You haven't sent your message yet. Do you want to leave without sending?";if(nc.getNumberLocalMessages(this._threadID))return "Your message is still being sent. Are you sure you want to leave?";return null;}.bind(this),false);ib.onUnload(function(){pd(this);}.bind(this));}function pd(sd){if(sd._photoUploader.isUploading())nd(sd,eb.CANCEL_DURING_UPLOAD);}function qd(){for(var sd in tc){tc[sd].updateAvailableStatus();tc[sd].updateMultichatTooltip();}}g.subscribe(['buddylist/availability-changed'],qd);fb.subscribe(['privacy-changed','privacy-availability-changed'],qd);m.subscribe(m.ON_CHANGED,function(){for(var sd in tc)rc.getThreadMeta(sd,function(td){tc[sd]._updateUnreadCount(td);});});ab.addRetroactiveListener('state-changed',function(sd){for(var td in sd){var ud=sd[td]&&sd[td].length,vd=tc[td];vd&&vd.showTypingIndicator(ud);}});pc.subscribe('threads-updated',function(sd,td){for(var ud in tc){var vd=tc[ud];td[ud]&&vd.updateTab();if(vd._newThreadIDFromPhotoUpload&&!vd._photoUploader.isUploading()&&td[vd._newThreadIDFromPhotoUpload]){od.inform('closed-tab',vd._threadID);q.openThread(vd._newThreadIDFromPhotoUpload,'ChatTabView');vd._newThreadIDFromPhotoUpload=null;}}});pc.subscribe('threads-deleted',function(sd,td){for(var ud in tc)td[ud]&&od.inform('thread-deleted',ud);});dc(od,h,{get:function(sd){return tc[sd];}});dc(od.prototype,{getThreadID:function(){return this._threadID;},showAddFriend:function(){setTimeout((function(){this._sheetController.openAddFriendsSheet();}).bind(this),0);},showNameConversation:function(sd){setTimeout((function(){this._sheetController.openNameConversationSheet(sd);}).bind(this),0);},hideAutomaticNameConversation:function(){setTimeout((function(){this._sheetController.closeAutomaticNameConversationSheet();}).bind(this),0);},isVisible:function(){return ea.shown(this._tabElem);},setVisibleState:function(sd,td){var ud=ea.shown(this._tabElem),vd=ea.hasClass(this._tabElem,'opened');ea.conditionShow(this._tabElem,sd);ea.conditionClass(this._tabElem,'opened',td);if(!(ud&&vd)&&sd&&td){if(!this._messagesView)this._messagesView=new y(this._threadID,this._sheetController,this._getNode('chatConv'),this._getNode('conversation'),this._getNode('loadingIndicator'),this._getNode('lastMessageIndicator'),this._getNode('typingIndicator'),this);this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(ud&&vd&&!(sd&&td))this._contextualDialogController.tabNotActive();},focus:function(){var sd=ea.hasClass(this._tabElem,'opened')?'input':'dockButton';this._getNode(sd).focus();},isFocused:function(){var sd=hc();return db.byClass(sd,"_50mz")===this._tabElem;},hasEmptyInput:function(){return sc.test(this._getNode('input').value);},getInputElem:function(){return this._getNode('input');},setInput:function(sd){this._getNode('input').value=sd;},setStickersFlyoutPackID:function(sd){if(this._stickerButton){this._setPackIDReact(sd);}else this._setPackIDLegacy(sd);},_linkDropped:function(sd){this._shareLinkUploader.loadShare(sd);},_filesDropped:function(sd){if(this._fileUploader)this._fileUploader.addDroppedFiles(sd);},showStickerSearchNUXTooltip:function(){this._clearStickerSearchNUXIndicator();this._stickerSearchNUXTooltip=hb.renderComponent(hb.createDescriptor(pb,{showIndicatorFunc:this._addStickerSearchNUXIndicator.bind(this)}),this._getNode('tooltipNUXContainer'));},_setPackIDLegacy:function(sd){var td=this._stickersFlyout;if(!this._stickersFlyoutToggler||!td||!td.isMounted())return;kb.selectPack(sd);this._toggleStickersFlyoutShownLegacy(true);},_setPackIDReact:function(sd){if(!this._stickerButton.isMounted())return;kb.selectPack(sd);this._toggleStickersFlyoutShownReact(true);},_toggleStickersFlyoutShownReact:function(sd){this._stickerButton.setProps({shown:sd});this._stickersFlyoutShown=sd;},_toggleStickersFlyoutShownLegacy:function(sd){if(sd){vb.show(this._stickersFlyoutToggler);}else vb.hide(this._stickersFlyoutToggler);this._stickersFlyoutShown=sd;},_hideStickersFlyoutIfShown:function(){if(this._stickersFlyoutToggler&&this._stickersFlyout&&this._stickersFlyoutShown)this._toggleStickersFlyoutShownLegacy(false);},showStickerReplyNUX:function(){if(vc)return;var sd=this._getNode('stickerButtonContainer')||this._getNode('emoticons');new j(new cc().getURI()).setRelativeTo(sd).setData({thread_id:this._threadID}).setHandler(function(td){nb.clearShowStickerReplyNUX();}).send();},insertBefore:function(sd){ia.insertBefore(sd._tabElem,this._tabElem);},appendTo:function(sd){ia.appendContent(sd,this._tabElem);},nextTabIs:function(sd){var td=sd&&sd._tabElem;return this._tabElem.nextSibling==td;},getScrollTop:function(){return ia.find(this._tabElem,'.fbNubFlyoutBody.scrollable').scrollTop;},setScrollTop:function(sd){ia.find(this._tabElem,'.fbNubFlyoutBody.scrollable').scrollTop=sd;},destroy:function(){ia.remove(this._tabElem);this._emoticonView&&this._emoticonView.destroy();while(this._eventListeners.length)this._eventListeners.pop().remove();if(this._dropTarget)this._dropTarget.disable();this._messagesView&&this._messagesView.destroy();this._sheetController&&this._sheetController.destroy();if(n.get('chat_react_option_menu')){hb.unmountComponentAtNode(this._getNode('menuContainer'));}else this._fileUploader&&this._fileUploader.destroy();hb.unmountComponentAtNode(this._getNode('photoUploaderContainer'));hb.unmountComponentAtNode(this._getNode('stickers'));this._subscriptionsHandler&&this._subscriptionsHandler.release();this._contextualDialogController&&this._contextualDialogController.destroy();this._privacyActionController&&this._privacyActionController.destroy();delete tc[this._threadID];ha.unregisterNubController(this._nubController);pa.reset(this._getNode('input'));},updateAvailableStatus:function(){rc.getThreadMeta(this._threadID,function(sd){var td=l.OFFLINE,ud=this._getCanonicalUserID();if(ud){td=gb.get(ud);}else{var vd=sd.participants.map(function(xd){return wa.getUserID(xd);});td=gb.getGroup(vd);}if(!aa.isOnline())td=l.OFFLINE;if(ud)this._updateCallLink(td);ea.conditionClass(this._tabElem,"_5238",td===l.ACTIVE);ea.conditionClass(this._tabElem,"_42nw",td===l.IDLE);ea.conditionClass(this._tabElem,"_5239",td===l.MOBILE);var wd=this._getNode('presenceIndicator');switch(td){case l.ACTIVE:wd.setAttribute('alt',"Online");break;case l.MOBILE:wd.setAttribute('alt',"Mobile");break;default:wd.removeAttribute('alt');break;}}.bind(this));},updateTab:function(){this._setNameConversationLink();rc.getThreadMeta(this._threadID,function(sd){qc.renderAndSeparatedParticipantList(this._threadID,[this._getNode('name'),this._getNode('titlebarText')],{names_renderer:ya.renderShortNames,check_length:true});this._updateControls(sd);this._updateMutingSettings(sd);this._updateUnreadCount(sd);this.updateMultichatTooltip();this._updateArchiveWarning(sd);this._updateNewThread(sd);this._updateNameConversationSheet(sd);this._updateReadOnlySheet(sd);}.bind(this));},_setNameConversationLink:function(){var sd=this._getNode('nameConversationLink');if(sd)rc.isEmptyLocalThread(this._threadID)?ea.hide(sd):ea.show(sd);},_updateNameConversationSheet:function(sd){if(rc.canReply(sd.thread_id)&&!sd.name&&!sd.is_canonical&&!sd.name_conversation_sheet_dismissed&&!sd.has_email_participant&&!sd.read_only&&!rc.isEmptyLocalThread(sd.thread_id)){this.showNameConversation(true);}else this.hideAutomaticNameConversation();},_updateReadOnlySheet:function(sd){var td=rc.canReply(sd.thread_id),ud=rc.isEmptyLocalThread(sd.thread_id);if(!td&&!ud){this._sheetController.openReadOnlySheet();}else if(td&&!ud&&sa.ReadOnlyEmailThreadsEarlyWarning&&sd.has_email_participant)this._sheetController.openReadOnlyEarlyWarningSheet();},updateSignatureID:function(sd){this._signatureID=sd;},_showPhotoNUXIfNecessary:function(){if(uc){uc=false;new j('/ajax/chat/photo_nux.php').setRelativeTo(this._getNode('photoUploaderContainer')).setData({threadID:this._threadID}).send();return true;}},_setUpMutingSettings:function(sd){var td=za.isThreadMuted(sd);if(td)this._sheetController.openThreadIsMutedTabSheet();this._updateActionMenu(td);},_updateMutingSettings:function(sd){var td=za.isThreadMuted(sd),ud;if(n.get('chat_react_option_menu')){ud=this._reactChatTabMenu.props.isMuted;}else ud=ea.shown(this._getNode('unmuteThreadLink').parentNode);if(td&&!ud){this._sheetController.openThreadIsMutedTabSheet();}else if(!td&&ud)this._sheetController.closeThreadIsMutedTabSheet();this._updateActionMenu(td);},_updateActionMenu:function(sd){if(n.get('chat_react_option_menu')){this._reactChatTabMenu.setProps({isMuted:sd});}else{ea.conditionShow(this._getNode('muteThreadLink').parentNode,!sd);ea.conditionShow(this._getNode('unmuteThreadLink').parentNode,sd);}},_updateArchiveWarning:function(sd){var td=false;wa.get(wa.user,function(ud){td=ud.employee;if(td)wa.getMulti(sd.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_updateControls:function(sd,td){var ud=rc.canReply(sd.thread_id)&&(!ic(sd.participants)||td);ea.conditionShow(this._inputContainerNode,ud);ea.conditionShow(this._iconsContainerNode,ud);this._updateOrionTrigger(ud);if(!n.get('chat_react_option_menu')){ea.conditionShow(this._getNode('dropdown'),ud);}else this._reactChatTabMenu.setProps({show:ud});ea.conditionShow(this._getNode('addToThreadLink'),ud);this._resizeInputContainer();},_updateOrionTrigger:function(sd){if(this._orionTrigger){var td=this._sheetController.getAddFriendsTabSheet(),ud=td.getParticipants(),vd=this._getCanonicalUserID(),wd=null;if(!ud&&vd){wd=wa.getIDForUser(this._getCanonicalUserID());}else if(ud&&ud.length===1)wd=ud[0];ea.conditionShow(this._orionTriggerContainer,wd);if(wd){wa.get(wd,function(xd){xd.userId=wa.getUserID(wd);this._orionTrigger.setProps({receiver:xd,disabled:!xd.orion_eligible});}.bind(this));}else this._orionTrigger.setProps({receiver:null});}},showOrionNUXTooltip:function(){if(this._orionTrigger)this._orionTrigger.setShouldShowNUXTooltip();},_resizeInputContainer:function(){var sd=this._tabElem.clientWidth,td=2,ud=sd-(this._inputContainerNode.clientWidth+td),vd=ra.isRTL()?'left':'right';rb.set(this._iconsContainerNode,vd,ud+'px');ub.getInstance(this._getNode('input')).update();},_updateNewThread:function(sd){if(rc.isNewEmptyLocalThread(sd.thread_id))this.showAddFriend();},_showArchiveWarningIfAllParticipantsAreEmployees:function(sd){var td=true;for(var ud in sd)td=td&&sd[ud].employee;var vd=this._getNode('titanArchiveWarning');if(vd){if(this._titlebarTooltipAnchor)ea.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',td);ea.conditionShow(vd,td);}},updateMultichatTooltip:function(){rc.getThreadMeta(this._threadID,function(sd){if(!sd.is_canonical)xc(this._titlebarTooltipAnchor,sd.participants);}.bind(this));},_getNode:function(sd){return this._tabTemplate.getNode(sd);},_getCanonicalUserID:function(){return rc.getCanonicalUserInThread(this._threadID);},_listen:function(sd,event,td,ud){var vd=this._getNode(sd);if(vd){this._eventListeners.push(na.listen(vd,event,td.bind(this)));}else if(!ud)throw new Error('Could not find node "'+sd+'"');},_closePreClicked:function(sd){this._closeMouseDown=true;},_closeClicked:function(sd){pd(this);od.inform('closed-tab',this._threadID);sd.kill();},_closeEnter:function(sd){if(sd.keyCode===qa.RETURN)this._closeClicked(sd);},_nubClicked:function(sd){if(!this._isDragDropActive){sd.kill();return od.inform('nub-activated',this._threadID);}},_dockKeyDown:function(event){if(event.keyCode===qa.RETURN||event.keyCode===qa.SPACE){od.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===qa.ESC){this._handleEscape();event.kill();}else if(event.keyCode===qa.TAB&&!event.ctrlKey){var sd=od.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!sd&&event.kill();}},_handleEscape:function(){if(this._stickersFlyoutShown){this._stickerButton?this._toggleStickersFlyoutShownReact(false):this._toggleStickersFlyoutShownLegacy(false);return;}pd(this);if(this.hasEmptyInput()){od.inform('esc-pressed',this._threadID);}else{var sd="Are you sure you want to close this chat window?",td="You haven't sent your message.",ud=new ga().setTitle(sd).setBody(td).setButtons([ga.CLOSE,ga.CANCEL]).setHandler(od.inform.bind(od,'esc-pressed',this._threadID,null)).setModal(true).show(),vd=ud.getButtonElement('yes');vd&&oa.set(vd);}},_titleClicked:function(event){var sd=event.getTarget();if(!db.byClass(sd,'titlebarText')&&!db.byClass(sd,'uiSelector')&&!db.byClass(sd,'addToThread')&&!db.byClass(sd,'optionMenu')&&!this._isDragDropActive){od.inform('lower-activated',this._threadID);event.kill();}},_callClicked:function(sd){var td=this._getCanonicalUserID();if(ac.availableForCall(td)){var ud='chat_tab_icon';if(sd.target&&ea.hasClass(sd.target,'video_call_promo')){ud='chat_tab_icon_promo';}else if(sd.target&&ea.hasClass(sd.target,'video_call_tour'))ud='chat_tab_icon_tour';od.inform('video-call-clicked',{threadID:this._threadID,userID:td,clickSource:ud});}return false;},_addFriendLinkClicked:function(){this.showAddFriend();},_nameConversationLinkClicked:function(){this.showNameConversation();},_showParticipantsClicked:function(){oc.getServerThreadID(this._threadID,function(sd){i.send(new j(yb('/ajax/browser/dialog/multichat_members/').addQueryData({id:sd})));});},_clearHistory:function(){var sd=rc.getThreadMetaNow(this._threadID);if(sd){var td=this._getCanonicalUserID();oc.clearChat(this._threadID,td,sd.timestamp);}},_unsubscribeLinkClicked:function(){var sd=[];sd.push({name:'unsubscribe',label:"Leave Conversation",handler:this._unsubscribeToThread.bind(this)});sd.push(ga.CANCEL);new ga().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(sd).show();},_getUserParticipants:function(sd){var td=[];sd.forEach(function(ud){var vd=wa.getUserID(ud);vd&&td.push(vd);});return td;},_createGroupClicked:function(){rc.getThreadMeta(this._threadID,function(sd){if(!sd.is_canonical){var td=yb('/ajax/groups/create_get.php').addQueryData({ref:'web_messenger_dock',parent_id:'0'}),ud=this._getUserParticipants(sd.participants);td.addQueryData({members:ud});if(sd.name)td.addQueryData({name:sd.name});i.send(new j(td));}}.bind(this));},_enableDesktopNotif:function(){Notification.requestPermission();},_reportSpamClicked:function(){var sd=this._getCanonicalUserID(),td=yb('/ajax/chat/report.php').addQueryData({id:sd}).addQueryData({src:'top_report_link'});i.send(new j(td));},_inputPasted:function(event){if(zb.chrome()){var sd=event.clipboardData||event.originalEvent.clipboardData;if(!sd||!sd.items||sd.items.length<1)return;var td=sd.items[0].type;if(td!=='image/png')return;if(sd.items[0].getAsFile){var ud=sd.items[0].getAsFile();this._photoUploader.uploadFile(ud);}}},_focusTab:function(){ea.addClass(this._tabElem,'focusedTab');this.tryMarkAsRead();this._contextualDialogController.tabFocused();if(!vc&&this._showPhotoNUXIfNecessary())g.subscribe(['ChatNUX/show','ChatNUX/hide'],function(event){vc=event==='ChatNUX/show';});this._closeMouseDown=false;this._setCloseTooltip(true);od.inform('focus-tab',this._threadID);},_blurTab:function(){ea.removeClass(this._tabElem,'focusedTab');!this._closeMouseDown&&this._setCloseTooltip(false);},_setCloseTooltip:function(sd){var td=this._getNode('titlebarCloseButton'),ud=sd?"Press Esc to close":"Close tab";wb.set(td,ud,'above');},_inputKeyDown:function(event){this.tryMarkAsRead();this._inputKeyDownForStickerTrigger(event);if(event.keyCode===qa.RETURN&&!event.shiftKey){if(jd(this)){hd(this);event.kill();return;}ed(this);event.kill();return;}if(event.keyCode===qa.DOWN&&event.shiftKey&&this._getNode('input').value===''){od.inform('lower-activated',this._threadID);event.kill();return;}this._handleHotkeyPressed(event);},_inputKeyDownForStickerTrigger:function(event){if(event.keyCode===qa.RETURN&&!event.shiftKey){this._persistTrigger=true;}else if(this._persistTrigger){this._persistTrigger=false;this._userUsedTrigger=false;}},_inputChanged:function(event){if(!this._userUsedTrigger&&!this._persistTrigger){var sd=event.target.value;nb.onTrayDataReady(function(){ob.findTagForInput(sd,function(td,ud){this._triggeredWord=ud;this._stickerTriggerImage.setProps({stickers:td});}.bind(this));}.bind(this));}},_hasUnfinishedPost:function(){return kd(this)||id(this);},tryMarkAsRead:function(){if(!this._messagesView||this._messagesView.isScrolledToBottom()){od.inform('read',this._threadID);return true;}return false;},_chatConvClicked:function(sd){this.tryMarkAsRead();if(db.byTag(sd.getTarget(),'a')||ia.getSelection())return;this.focus();},_inputContainerClicked:function(sd){this.tryMarkAsRead();this.focus();},showTypingIndicator:function(sd){ea.conditionClass(this._tabElem,'typing',sd);},_updateUnreadCount:function(sd){var td=sd.unread_count;if(typeof td!='undefined'){var ud=!!td&&(!m.showsTabUnreadUI||m.showsTabUnreadUI()),vd=this._getNode('numMessages');ea.conditionShow(vd,ud);ea.conditionClass(this._tabElem,'highlightTab',ud);bd(this._threadID,this._tabElem,ud);ia.setContent(vd,td);}},_updateCallLink:function(sd){var td=this._getNode('videoCallLink');if(aa.isOnline()){var ud=this._getCanonicalUserID(),vd='fbid:'+ud;wa.get(vd,function(wd){if(ac.availableForCall(ud)){wb.set(td,lc._("Start a video call with {firstname}",{firstname:wd.short_name}));}else{wb.set(td,lc._("{firstname} is currently unavailable for video calling",{firstname:wd.short_name}));this._hideVideoCallouts();}}.bind(this));}else{wb.set(td,"You must be online to make a call.");this._hideVideoCallouts();}},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_updatePrivacyLink:function(sd){var td;if(sd==t.OFFLINE){td="Go online";if(n.get('chat_react_option_menu')){this._reactChatTabMenu.setProps({privacyText:td});}else ia.setContent(this._privacyLink,td);return;}var ud=this._getCanonicalUserID();if(!ud)return;var vd='fbid:'+ud;wa.get(vd,function(wd){if(sd==t.BLOCKED){td=lc._("Turn On Chat for {name}",{name:wd.short_name});}else td=lc._("Turn Off Chat for {name}",{name:wd.short_name});if(n.get('chat_react_option_menu')){this._reactChatTabMenu.setProps({privacyText:td});}else ia.setContent(this._privacyLink,td);}.bind(this));},_unsubscribeToThread:function(){if(!rc.isEmptyLocalThread(this._threadID)){var sd=nc.constructLogMessageObject(xa.CHAT_WEB,this._threadID,va.UNSUBSCRIBE,{removed_participants:[wa.user]});nc.sendMessage(sd);}od.inform('unsubscribed',this._threadID);return true;},_initializeUploader:function(sd){this._subscriptionsHandler.addSubscriptions(sd.subscribe(['all-uploads-completed','upload-canceled'],function(){ld(this);}.bind(this)),sd.subscribe('dom-updated',function(){md(this);}.bind(this)),sd.subscribe('submit',function(){this._getNode('input').focus();}.bind(this)));},_initializeReactMenu:function(sd){var td=this._getNode('menuContainer'),ud=ta.isMultichat(this._threadID),vd=this._sheetController.openAddFriendsSheet.bind(this._sheetController);if(td)this._reactChatTabMenu=hb.renderComponent(hb.createDescriptor(x,{onFileUploaderMounted:this.setFileUploader.bind(this),updatePrivacyLinkFunc:this._updatePrivacyLink.bind(this),nameConversationFunc:this._nameConversationLinkClicked.bind(this),showParticipantsFunc:this._showParticipantsClicked.bind(this),leaveConversationFunc:this._unsubscribeLinkClicked.bind(this),clearHistoryFunc:this._clearHistory.bind(this),reportSpamFunc:this._reportSpamClicked.bind(this),createGroupFunc:this._createGroupClicked.bind(this),isMultichat:ud,showAddFriend:vd,threadID:this._threadID,attachmentsShelf:sd,onUploadFinished:ld.bind(this,this),onUpdateAttachmentsShelf:md.bind(this,this),onSubmit:function(){this._getNode('input').focus();}.bind(this),enableDesktopNotif:function(){this._enableDesktopNotif();}.bind(this)}),td);},_initializeReactFileUploader:function(sd){this._fileUploader=hb.renderComponent(hb.createDescriptor(p,{onFileUploaderMount:this.setFileUploader.bind(this),attachmentsShelf:sd,onUploadFinished:ld.bind(this,this),onUpdateAttachmentsShelf:md.bind(this,this),onSubmit:function(){this._getNode('input').focus();}.bind(this)}),this._getNode('fileUploaderContainer'));},setFileUploader:function(sd){this._fileUploader=sd;},_initializeAutoSendPhotoUploader:function(){this._photoUploader=hb.renderComponent(hb.createDescriptor(s,{onSubmit:this._handlePUSubmit.bind(this),onAllUploadsComplete:this._handlePUAllUploadsCompleted.bind(this),onLastUploadFail:this._handlePULastUploadFailed.bind(this),onLastUploadCancel:this._handlePULastUploadCanceled.bind(this)}),this._getNode('photoUploaderContainer'));},_handlePUSubmit:function(sd,td){nd(this,eb.UPLOAD_START,td);gd(this,'',[],function(ud){if(this._threadID!==ud.thread_id){this._newThreadIDFromPhotoUpload=ud.thread_id;if(this._messagesView)this._messagesView.setNewThreadID(ud.thread_id);}ud.content_attachment=null;nc.updateNewMessage(ud,td.upload_id,td);nc.sendMessage(ud);}.bind(this));this._getNode('input').focus();},_handlePULastUploadFailed:function(sd,td){nd(this,eb.CLIENT_ERROR,td);rd(td);var ud="Photo Upload Failed",vd="Please try again. Make sure you are uploading a valid photo.";new ga().setTitle(ud).setBody(vd).setButtons(ga.OK).show();},_handlePULastUploadCanceled:function(sd,td){nd(this,eb.CANCEL_DURING_UPLOAD,td);rd(td);},_handlePUAllUploadsCompleted:function(sd,td){nd(this,eb.ALL_UPLOADS_DONE,td);var ud=nc.updateMessageAfterUpload(td.upload_id,td);nc.clearUploadedMessage(td.upload_id);nc.sendMessage(ud);var vd=td.image_ids.length||td.attachments.length;fd(this,vd);},_stickerSelected:function(sd){gd(this,'',[],function(td){td.has_attachment=true;td.sticker_id=sd;nc.sendMessage(td);this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_emoticonSelected:function(sd){var td=la.symbols[sd];if(!td)return;var ud=ub.getInstance(this._getNode('input')),vd=ud.getValue(),wd=ma.insertEmoticon(td,vd,this._selectionPosition.getPos());ud.setValue(wd.result);this._selectionPosition.setPos(wd.start,wd.end);},_clearStickerSearchNUXIndicator:function(){ea.removeClass(this._getNode('nuxIndicator'),'nux');},_orionTriggered:function(){gd(this,'',[],function(sd){this.focus();}.bind(this));this._messagesView&&this._messagesView.scrollToBottom();},_addStickerSearchNUXIndicator:function(){ea.addClass(this._getNode('nuxIndicator'),'nux');},_clearStickerSearchNUXTooltip:function(){this._stickerSearchNUXTooltip&&this._stickerSearchNUXTooltip.hideNUX();}});function rd(sd){var td=nc.updateMessageAfterUpload(sd.upload_id,sd);nc.clearUploadedMessage(sd.upload_id);nc.deleteMessages(td.thread_id,[td.message_id]);nc.deleteLocalMessage(td.thread_id);}e.exports=od;},null);
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryParticipants","tx","MercuryMessages","MercuryThreads"],function(a,b,c,d,e,f,g,h,i){var j=b('MercuryMessages').get(),k=b('MercuryThreads').get();function l(m,n){g.isThreadID(m);k.getThreadMeta(m,function(o){j.getThreadMessagesRange(m,0,1,function(p){var q=p.length&&p[p.length-1];if(q&&q.author!=h.user){h.get(q.author,function(r){if(o.name){n(i._("{senderName} messaged {groupName}",{senderName:r.short_name,groupName:o.name}));}else n(i._("{name} messaged you",{name:r.short_name}));});}else n("New message!");});});}e.exports={renderDocumentTitle:l};},null);
__d("ChatTitleBarBlinker",["ChatActivity","DocumentTitle","JSLogger","MercuryNotificationRenderer","PresenceState","MercuryThreadInformer","MercuryTimestampTracker"],function(a,b,c,d,e,f,g,h,i,j,k){var l=b('MercuryThreadInformer').get(),m=b('MercuryTimestampTracker').get(),n=i.create('chat_title'),o=null,p=0,q=false;function r(){if(o){o.stop();o=null;return true;}return false;}function s(x){var y=x||m.getLastUserMessageTimestamp();if(p<=y){p=y;if(r()||q)k.doSync();}}var t={blink:function(x,y){if(!o&&p<y)j.renderDocumentTitle(x,function(z){if(!o)o=h.blink(z);});},stopBlinking:function(){s();},blinkingElsewhere:function(){q=true;}};function u(x){var y=k.verifyNumber(x.sb2);if(!y||y<=p)return null;return y;}function v(x){var y=x&&u(x);if(y){p=y;n.debug('load',p);r();q=false;}}function w(x){var y=u(x);if(!y){n.debug('store',p);x.sb2=p;q=false;}return x;}k.registerStateStorer(w);k.registerStateLoader(v);l.subscribe('thread-read-changed',function(x,y){var z=m.getLastUserMessageTimestamp(),aa=0;for(var ba in y)if(y[ba].mark_as_read&&y[ba].timestamp>=z&&y[ba].timestamp>aa)aa=y[ba].timestamp;aa&&s(aa);});g.subscribe('activity',function(){s();});(function(){var x=k.getInitial();if(x)p=u(x)||0;})();e.exports=t;},null);
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","MercuryParticipants","MercuryThreadMuter","MessagingTag","Sound","copyProperties","MercuryThreads"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=b('MercuryThreads').get();o.init(['audio/ogg','audio/mpeg']);function r(t){if(j.getSetting('sound'))o.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],t,false);}var s={messageReceived:function(t){if(t.author==l.user||!t.is_unread||(t.folder!=n.INBOX&&t.folder!=n.ARCHIVED))return;var u=t.thread_id,v=h.isActive();if(v){var w=false;s.inform('before-alert',{threadID:u,cancelAlert:function(){w=true;}});}q.getThreadMeta(u,function(x){var y=m.isThreadMuted(x);if(y)return;var z=t.timestamp;if(v){!w&&r(z);}else{k.blink(u,z);r(z);}k.blinkingElsewhere();}.bind(this));}};e.exports=p(s,g);},null);
__d("ChatTabLRUManager",["ChatTabView","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f,g,h){var i=b('MercuryThreads').get(),j={getLRUVisibleTab:function(k){if(k.hasRoomForRaisedTab())return undefined;var l=Object.keys(k.getTabsToShow()||{}),m=1*60,n=null,o=Infinity;for(var p=0;p<l.length;p++){var q=l[p],r=i.getThreadMetaNow(q);if(h.isTabPromoted(q))continue;if(!g.get(q).hasEmptyInput()||!r)continue;var s=(h.getServerTime()-r.timestamp)/1000;if(!r.timestamp||(r.timestamp&&r.timestamp<o&&s>m)){n=r.thread_id;o=r.timestamp;}}return n;}};e.exports=j;},null);
__d("MercuryUnseenState",["TimestampConverter","KeyedCallbackManager","LogHistory","MercuryActionTypeConstants","MercuryConfig","MercurySingletonMixin","MercuryThreadlistConstants","MessagingTag","ReportState","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMuter","MercuryThreads","copyProperties","createObjectFrom","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){var w=m.MAX_UNSEEN_COUNT,x='unseen_thread_hash',y='unseen_thread_list',z=i.getInstance('mercury_unseen_state');function aa(sa){this._fbid=sa;this._serverRequests=p.getForFBID(this._fbid);this._threads=s.getForFBID(this._fbid);this._threadInformer=q.getForFBID(this._fbid);this._initialUnseenCount=null;this._lastSeenTimestamp=0;this._maxCount=false;this._unseenResources=new h();this._serverRequests.subscribe('update-unseen',function(ta,ua){fa(this,ua);}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(ta,ua){qa(this,ua);}.bind(this));}t(aa.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){z.error('unguarded_unseen_count_fetch',{});return 0;}return ea(this)||0;},exceedsMaxCount:function(){return this._maxCount||(ea(this)>w);},markAsSeen:function(){var sa=ea(this);if(sa===null||sa>0||this._maxCount){this._serverRequests.markSeen();var ta;if(k.MercuryActionIDGK){ta=this._serverRequests.getLastActionTimestamp();}else ta=g.convertActionIDToTimestamp(this._serverRequests.getLastActionID());ia(this,ta,[]);}},markThreadSeen:function(sa,ta){if(k.MercuryActionIDGK){var ua={};ua[sa]=0;ma(this,ua,ta);}else{var va={};va[sa]=null;la(this,va,ta);}}});t(aa,l);function ba(sa,ta){sa._unseenResources.setResource(x,ta);sa._unseenResources.setResource(y,Object.keys(ta));}function ca(sa,ta){var ua=sa._unseenResources.executeOrEnqueue(x,ta),va=sa._unseenResources.getUnavailableResources(ua);if(va.length)sa._serverRequests.fetchUnseenThreadIDs();}function da(sa){return sa._unseenResources.getResource(x);}function ea(sa){var ta=sa._unseenResources.getResource(y);if(ta){return ta.length;}else return sa._initialUnseenCount;}function fa(sa,ta){if(k.MercuryFBIDGK){ha(sa,ta);}else ga(sa,ta);}function ga(sa,ta){var ua=ra(ta);if(ta.unseen_thread_ids){ta.unseen_thread_ids.forEach(function(fb){if(fb.folder!=n.INBOX)return;var gb=pa(sa,fb.thread_ids),hb=sa._lastSeenTimestamp;if(ua&&ua.seen_timestamp)hb=ua.seen_timestamp;ia(sa,hb,gb);if(ua&&ua.unseen_count>w)sa._maxCount=true;});}else if(ua&&ua.seen_timestamp){sa._lastSeenTimestamp=ua.seen_timestamp;if(ua.unseen_count>w){sa._maxCount=true;ba(sa,{});}else{sa._initialUnseenCount=ua.unseen_count;if(sa._initialUnseenCount===0)ba(sa,{});}}else{if(sa._maxCount)return;var va=ta.actions;if(!va||!(va.length))return;var wa={},xa={};for(var ya=0;ya<va.length;ya++){var za=va[ya];if(za.is_forward)continue;var ab=za.action_type,bb=za.action_id,cb=za.thread_id?za.thread_id:za.server_thread_id,db=za.folder===undefined||za.folder==n.INBOX;if(!db)continue;if(ab==j.USER_GENERATED_MESSAGE||ab==j.LOG_MESSAGE){var eb=g.isGreaterThan(bb,wa[cb]);if(za.is_unread&&(!wa[cb]||eb))sa._threads.getThreadMeta(cb,function(fb){var gb=false;if(fb&&fb.last_read_timestamp)if(fb.last_read_timestamp>=za.timestamp)gb=true;if(!r.isThreadMuted(fb)&&!gb)wa[cb]=bb;});}else if(ab==j.CHANGE_READ_STATUS&&za.mark_as_read)xa[cb]=bb;}ja(sa,wa);la(sa,xa);}}function ha(sa,ta){var ua=ra(ta);if(ta.unseen_thread_fbids){ta.unseen_thread_fbids.forEach(function(ib){if(ib.folder!=n.INBOX)return;var jb=ib.thread_fbids||[];jb=jb.concat(ib.other_user_fbids||[]);var kb=pa(sa,jb),lb=sa._lastSeenTimestamp;if(ua&&ua.seen_timestamp)lb=ua.seen_timestamp;ia(sa,lb,kb);if(ua&&ua.unseen_count>w)sa._maxCount=true;});}else if(ua&&ua.seen_timestamp){sa._lastSeenTimestamp=ua.seen_timestamp;if(ua.unseen_count>w){sa._maxCount=true;ba(sa,{});}else{sa._initialUnseenCount=ua.unseen_count;if(sa._initialUnseenCount===0)ba(sa,{});}}else{if(sa._maxCount)return;var va=ta.actions;if(!va||!(va.length))return;var wa={},xa={},ya={},za={};for(var ab=0;ab<va.length;ab++){var bb=va[ab];if(bb.is_forward)continue;var cb=bb.action_type,db=bb.other_user_fbid?bb.other_user_fbid:bb.thread_fbid,eb=bb.thread_id?bb.thread_id:db,fb=bb.folder===undefined||bb.folder==n.INBOX;if(!fb)continue;if(cb==j.USER_GENERATED_MESSAGE||cb==j.LOG_MESSAGE){var gb,hb;if(k.MercuryActionIDGK){gb=ya[eb]?bb.timestamp>ya[eb]:false;hb=gb||!ya[eb];}else{gb=g.isGreaterThan(bb.action_id,wa[eb]);hb=!wa[eb]||gb;}if(bb.is_unread&&hb)sa._threads.getThreadMeta(eb,function(ib){var jb=false;if(ib&&ib.last_read_timestamp)if(ib.last_read_timestamp>=bb.timestamp)jb=true;if(!r.isThreadMuted(ib)&&!jb)if(k.MercuryActionIDGK){ya[eb]=bb.timestamp;}else wa[eb]=bb.action_id;});}else if(cb==j.CHANGE_READ_STATUS&&bb.mark_as_read)if(k.MercuryActionIDGK){za[eb]=bb.timestamp;}else xa[eb]=bb.action_id;}if(k.MercuryActionIDGK){ka(sa,ya);ma(sa,za);}else{ja(sa,wa);la(sa,xa);}}}function ia(sa,ta,ua){var va=da(sa);if(va===undefined||ta>sa._lastSeenTimestamp||sa._maxCount){sa._lastSeenTimestamp=ta;ua=ua||[];if(ua.length<=w)sa._maxCount=false;var wa={},xa=da(sa)||{};for(var ya in xa)if(xa[ya]!==true)if(k.MercuryActionIDGK){var za=xa[ya];if(oa(sa,za))wa[ya]=za;}else{var ab=xa[ya];if(na(sa,ab))wa[ya]=ab;}var bb=t(u(ua,true),wa);ba(sa,bb);sa._threadInformer.updatedUnseenState();}}function ja(sa,ta){if(sa._maxCount)return;var ua={},va=false;for(var wa in ta){var xa=ta[wa];if(na(sa,xa)){ua[wa]=xa;va=true;}}if(!va)return;ca(sa,function(ya){for(var za in ua){var ab=ua[za];if(!ya[za]&&na(sa,ab))ya[za]=ua[za];}ba(sa,ya);sa._threadInformer.updatedUnseenState();});}function ka(sa,ta){if(sa._maxCount)return;var ua={},va=false;for(var wa in ta){var xa=ta[wa];if(oa(sa,xa)){ua[wa]=xa;va=true;}}if(!va)return;ca(sa,function(ya){for(var za in ua){var ab=ua[za];if(!ya[za]&&oa(sa,ab))ya[za]=ua[za];}ba(sa,ya);sa._threadInformer.updatedUnseenState();});}function la(sa,ta,ua){var va=false;for(var wa in ta){va=true;break;}if(va)ca(sa,function(xa){var ya=false;for(var za in ta){var ab=ta[za],bb=g.isGreaterThan(ab,xa[za]);if(xa[za]&&(!ab||bb)){delete xa[za];ya=true;}}if(ya){ba(sa,xa);sa._threadInformer.updatedUnseenState();if(ua&&ea(sa)===0)sa._serverRequests.markSeen();}});}function ma(sa,ta,ua){var va=false;if(!v(ta))va=true;if(va)ca(sa,function(wa){var xa=false;for(var ya in ta){var za=ta[ya],ab=za>wa[ya];if(wa[ya]&&(!za||ab)){delete wa[ya];xa=true;}}if(xa){ba(sa,wa);sa._threadInformer.updatedUnseenState();if(ua&&ea(sa)===0)sa._serverRequests.markSeen();}});}function na(sa,ta){var ua=g.convertActionIDToTimestamp(ta);return ua>sa._lastSeenTimestamp;}function oa(sa,ta){return ta>sa._lastSeenTimestamp;}function pa(sa,ta){return ta.map(sa._serverRequests.convertThreadIDIfAvailable,sa._serverRequests);}function qa(sa,ta){var ua=da(sa);if(!ua)return;for(var va in ta){var wa=ta[va];if(ua[va]){ua[wa]=ua[va];delete ua[va];}}ba(sa,ua);}function ra(sa){var ta=(sa.message_counts||[]);for(var ua=0;ua<ta.length;ua++)if(ta[ua].folder==n.INBOX)return ta[ua];return null;}o.registerCallback('mercury-unseen-state',function(){var sa={};sa.unseen={};sa.unseen_max_count={};sa.unseen_time={};var ta=aa._getInstances();for(var ua in ta){sa.unseen[ua]=t({},da(ta[ua]));sa.unseen_max_count[ua]=ta[ua]._maxCount;sa.unseen_time[ua]=ta[ua]._lastSeenTimestamp;}return sa;});e.exports=aa;},null);
__d("ChatTabViewSelector",["Event","Arbiter","CSS","DataStore","DOM","MenuDeprecated","NubController","ChatTabTemplates","Toggler","copyProperties","MercuryThreadInformer","MercuryThreads","MercuryThreadMetadataRenderer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=b('MercuryThreadInformer').get(),r=b('MercuryThreads').get(),s=b('MercuryThreadMetadataRenderer').get();function t(u){var v=n[':fb:chat:tab:selector'].build(),w=v.getRoot(),x=v.getNode('menu'),y=k.find(x,'.uiMenuInner'),z={},aa=new m().init(w);i.hide(w);k.insertBefore(u,w);function ba(ea){var fa=0;for(var ga in z){var ha=z[ga],ia=r.getThreadMetaNow(ga),ja=ha.getNode('unreadCount'),ka=(ia&&ia.unread_count)||0;fa+=ka;if(ka>9)ka='+';i.conditionClass(ja,'invisible_elem',!ka);k.setContent(ja,ka);}var la=v.getNode('numMessages');i.conditionShow(la,fa);k.setContent(la,fa);}this.setTabData=function(ea){z={};if(ea.length<1){i.hide(w);return;}i.show(w);k.empty(y);ea.forEach(function(fa){var ga=n[':fb:chat:tab:selector:item'].build();z[fa.id]=ga;var ha=ga.getNode('content');s.renderAndSeparatedParticipantList(fa.id,ha);k.prependContent(y,ga.getRoot());j.set(ga.getRoot(),'threadID',fa.id);var ia=ga.getNode('closeButton');g.listen(ia,'click',function(event){t.inform('selector/close-tab',fa.id);event.kill();});});aa.flyoutContentChanged();k.setContent(v.getNode('numTabs'),ea.length);ba();};function ca(event,ea){if(ea.menu!=x)return;var fa=j.get(ea.item,'threadID');t.inform('selected',fa);o.hide(w);}function da(event,ea){l.register(x);}l.subscribe('select',ca.bind(this));o.listen('show',w,function(){h.inform('layer_shown',{type:'ChatTabSelector'});da();});o.listen('hide',w,function(){h.inform('layer_hidden',{type:'ChatTabSelector'});});q.subscribe('threads-updated',ba);}p(t,new h());e.exports=t;},null);
__d("ChatTabViewCoordinator",["Arbiter","BanzaiODS","Bootloader","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","JSLogger","Style","Rect","VideoCallCore","copyProperties"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s=n.create('chat_tab_coordinator'),t,u;function v(w,x){var y=new l(w),z={},aa={},ba=false;function ca(){var oa=j.get(),pa={};oa.tabs.forEach(function(ra){pa[ra.id]=1;});s.log('process_tab_changed',{model_tabs:Object.keys(pa),view_tabs:Object.keys(z)});for(var qa in z)if(!pa[qa]){s.log('remove_tab',{tab_id:qa});z[qa].destroy();delete(z[qa]);}da(oa);ma(oa);if(oa.tabNeedsFocus&&!oa.tabNeedsFocus.isFocused())oa.tabNeedsFocus.focus();}function da(oa){var pa=null;oa.tabs.forEach(function(qa){var ra=qa.id,sa=false;if(!z[ra]){s.log('add_tab',{tab_id:ra});z[ra]=new k(ra,qa.server_id,qa.signatureID);sa=true;}else z[ra].updateSignatureID(qa.signatureID);if(z[ra].isFocused())oa.tabNeedsFocus=z[ra];if(sa||!z[ra].nextTabIs(pa)){var ta=z[ra].getScrollTop();if(pa){z[ra].insertBefore(pa);}else z[ra].appendTo(w);if(ta)z[ra].setScrollTop(ta);}pa=z[ra];});}function ea(){var oa=x.getShowingTabsOrder();if(!oa||!oa.length)return;var pa=z[oa[0].id]._tabElem,qa=z[oa[oa.length-1].id]._tabElem,ra=parseInt(o.get(qa,'margin-left'),10)||0,sa=p.getElementBounds(qa).l-2*ra;sa=sa>0?sa:0;t&&t.setBoundingBox(new p(0,p.getElementBounds(pa).r,0,sa));}function fa(oa,pa){var qa=false;pa.forEach(function(ta){if(ta.raised){if(aa[ta.id]){qa=true;delete aa[ta.id];}}else if(!aa[ta.id]){qa=true;aa[ta.id]=true;}});if(qa)return true;if(!t)return true;var ra=ga()||[];if(ra.length!==oa.length)return true;for(var sa=0;sa<oa.length;sa++)if(ra[sa]!==oa[sa].id)return true;return false;}function ga(){var oa=t&&t.getOrder();oa&&oa.reverse();return oa;}function ha(){var oa=ga();if(oa){h.bumpEntityKey('chat.web','tab.drag_order_changed');g.inform('chat/tabs-order-changed',oa);}}function ia(oa,pa,qa){if(z[qa]._scrollTop!=null)z[qa].setScrollTop(z[qa]._scrollTop);}function ja(oa,pa){u=pa;z[pa]._isDragDropActive=true;z[pa]._scrollTop=z[pa].getScrollTop();o.set(z[pa]._tabElem,'z-index',1);ea();h.bumpEntityKey('chat.web','tab.drag_started');}function ka(oa){o.set(z[oa]._tabElem,'z-index','');if(z[oa]._scrollTop!=null)z[oa].setScrollTop(z[oa]._scrollTop);z[oa]._scrollTop=null;u=null;setTimeout(function(){z[oa]._isDragDropActive=false;},0);}function la(oa){i.loadModules(["SortableGroup"],function(pa){var qa=x.getShowingTabsOrder(),ra=fa(qa,oa);if(qa.length<=1){t&&t.removeAllSortables();return;}if(ra){if(t){t.removeAllSortables();}else t=new pa().setBeforeGrabCallback(ja).setDragOverCallback(ia).setDropCallback(ka).setOrderChangeHandler(ha).setUseScroller(false).setDragOverHorizontally();for(var sa=0;sa<qa.length;sa++){var ta=qa[sa];t.addSortable(ta.id,z[ta.id]._tabElem,aa[ta.id]?null:z[ta.id]._titlebar);}}});}function ma(oa){var pa=x.getTabsToShow(oa),qa=[],ra=false;oa.tabs.forEach(function(sa){if(!pa[sa.id]){z[sa.id].setVisibleState(false,sa.raised);qa.push(sa);}});oa.tabs.forEach(function(sa){if(pa[sa.id]){z[sa.id].setVisibleState(true,sa.raised);ra|=sa.raised;}});y.setTabData(qa);na(ra);la(oa.tabs);}function na(oa){if(!oa&&ba){g.inform('layer_hidden',{type:'ChatTab'});ba=false;}else if(oa&&!ba){g.inform('layer_shown',{type:'ChatTab'});ba=true;}}if(q.isSupported())m.addClass(w,'videoCallEnabled');x.subscribe('tabs-changed',ca);ca();}r(v.prototype,{forceDrop:function(){if(t&&u){t.forceDrop(u);u=null;return true;}return false;}});e.exports=v;},null);
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryActionTypeConstants","MercuryConfig","MercuryGlobalActionType","MercuryPayloadSource","MercurySendLogger","MessagingReliabilityLogger","MessagingEvent","MessagingTag","MercuryParticipants","PresenceUtil","copyProperties","MercuryMessages","MercuryServerRequests","MercuryThreadInformer"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s){var t=b('MercuryMessages').get(),u=b('MercuryServerRequests').get(),v=b('MercuryThreadInformer').get();function w(bb,cb){if(j.MercuryFBIDGK){y(bb,cb);}else x(bb,cb);}function x(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj||!cb.obj.message){n.addEntry('channel_receive','invalid_data');return;}var db=cb.obj.message,eb={author:db.mercury_author_id,author_email:db.mercury_author_email,body:db.body,subject:db.subject,has_attachment:db.has_attachment,attachments:db.attachments,html_body:db.html_body,thread_id:db.tid,message_id:db.mid,coordinates:db.mercury_coordinates,is_spoof_warning:db.is_spoof_warning,source:db.mercury_source,source_tags:db.mercury_source_tags,threading_id:db.threading_id,timestamp:db.timestamp,timestamp_absolute:db.timestamp_absolute,timestamp_relative:db.timestamp_relative,timestamp_time_passed:db.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:db.is_unread,action_id:db.action_id,is_forward:false,forward_count:db.forward_count||db.forward,forward_message_ids:db.forward_msg_ids,location_text:db.location_text,folder:cb.obj.folder};if("sync_id" in db){eb.sync_id=db.sync_id;}else eb.action_id=db.action_id;var fb=[s({},eb)];fb=fb.concat(db.forward_actions||[]);var gb=l.CLIENT_CHANNEL_MESSAGE;u.handleUpdateWaitForThread({actions:fb,payload_source:gb},db.tid);if(!db.is_unread&&db.mercury_author_id===q.user){var hb={};hb[db.tid]=cb.obj.folder;z(h.getArbiterType('messaging'),{obj:{event:o.READ,tids:[db.tid],folder_info:hb,timestamp:db.timestamp}});}if(db.mercury_author_id===q.user)if(t.getMessagesFromIDs([db.threading_id]).length)m.log(m.CLIENT_CHANNEL_ECHO,db.threading_id,{canonical:!db.group_thread_info});n.addEntry('channel_receive','success',[eb.thread_id,eb.message_id,r.getSessionID()]);}function y(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj||!cb.obj.message){n.addEntry('channel_receive','invalid_data');return;}var db=cb.obj.message,eb=db.other_user_fbid?db.other_user_fbid:db.thread_fbid,fb={author:db.mercury_author_id,author_email:db.mercury_author_email,body:db.body,subject:db.subject,has_attachment:db.has_attachment,attachments:db.attachments,html_body:db.html_body,thread_id:db.tid,thread_fbid:db.thread_fbid,other_user_fbid:db.other_user_fbid,message_id:db.mid,coordinates:db.mercury_coordinates,is_spoof_warning:db.is_spoof_warning,source:db.mercury_source,source_tags:db.mercury_source_tags,threading_id:db.threading_id,timestamp:db.timestamp,timestamp_absolute:db.timestamp_absolute,timestamp_relative:db.timestamp_relative,timestamp_time_passed:db.timestamp_time_passed,action_type:i.USER_GENERATED_MESSAGE,is_unread:db.is_unread,is_forward:false,forward_count:db.forward_count||db.forward,forward_message_ids:db.forward_msg_ids,location_text:db.location_text,folder:cb.obj.folder};if("sync_id" in db){fb.sync_id=db.sync_id;}else fb.action_id=db.action_id;var gb=[s({},fb)];gb=gb.concat(db.forward_actions||[]);var hb=l.CLIENT_CHANNEL_MESSAGE;u.handleUpdateWaitForThread({actions:gb,payload_source:hb},eb);if(!db.is_unread&&db.mercury_author_id===q.user){var ib={};ib[eb]=cb.obj.folder;z(h.getArbiterType('messaging'),{obj:{event:o.READ,thread_fbids:db.thread_fbid?[db.thread_fbid]:[],other_user_fbids:db.other_user_fbid?[db.other_user_fbid]:[],folder_info:ib,timestamp:db.timestamp}});}if(db.mercury_author_id===q.user)if(t.getMessagesFromIDs([db.threading_id]).length)m.log(m.CLIENT_CHANNEL_ECHO,db.threading_id,{canonical:!db.group_thread_info});n.addEntry('channel_receive','success',[eb,fb.message_id,r.getSessionID()]);}function z(bb,cb){if(j.MercuryFBIDGK){ba(bb,cb);}else aa(bb,cb);}function aa(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj||!cb.obj.tids)return;var db=[],eb=cb.obj.event==o.READ;(cb.obj.tids||[]).forEach(function(fb){db.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_id:fb,mark_as_read:eb,timestamp:cb.obj.timestamp||0,folder:cb.obj.folder_info[fb]});});u.handleUpdate({actions:db,payload_source:l.CLIENT_CHANNEL_MESSAGE});}function ba(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj||(!cb.obj.thread_fbids&&!cb.obj.other_user_fbids))return;var db=[],eb=cb.obj.event==o.READ;(cb.obj.thread_fbids||[]).forEach(function(fb){db.push({action_type:i.CHANGE_READ_STATUS,action_id:null,thread_fbid:fb,mark_as_read:eb,timestamp:cb.obj.timestamp||0,folder:cb.obj.folder_info[fb]});});(cb.obj.other_user_fbids||[]).forEach(function(fb){db.push({action_type:i.CHANGE_READ_STATUS,action_id:null,other_user_fbid:fb,mark_as_read:eb,timestamp:cb.obj.timestamp||0,folder:cb.obj.folder_info[fb]});});u.handleUpdate({actions:db,payload_source:l.CLIENT_CHANNEL_MESSAGE});}function ca(bb,cb){if(j.MercuryFBIDGK){ea(bb,cb);}else da(bb,cb);}function da(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj||!cb.obj.tids)return;var db=[];(cb.obj.tids||[]).forEach(function(eb){db.push({action_type:i.DELETE_THREAD,action_id:null,thread_id:eb});});u.handleUpdate({actions:db,payload_source:l.CLIENT_CHANNEL_MESSAGE});}function ea(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj||!(cb.obj.thread_fbids||cb.obj.other_user_fbids))return;var db=[];(cb.obj.thread_fbids||[]).forEach(function(eb){db.push({action_type:i.DELETE_THREAD,action_id:null,thread_fbid:eb});});(cb.obj.other_user_fbids||[]).forEach(function(eb){db.push({action_type:i.DELETE_THREAD,action_id:null,other_user_fbid:eb});});u.handleUpdate({actions:db,payload_source:l.CLIENT_CHANNEL_MESSAGE});}function fa(bb,cb){if(j.MercuryFBIDGK){ha(bb,cb);}else ga(bb,cb);}function ga(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj||!cb.obj.tids||!cb.obj.mids)return;var db=cb.obj.tids[0],eb={action_type:i.DELETE_MESSAGES,action_id:null,thread_id:db,message_ids:cb.obj.mids};u.handleUpdate({actions:[eb],threads:[cb.obj.updated_thread],payload_source:l.CLIENT_CHANNEL_MESSAGE});}function ha(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj||(!cb.obj.thread_fbids&&!cb.obj.other_user_fbids)||!cb.obj.mids)return;var db=cb.obj.thread_fbids.length?cb.obj.thread_fbids[0]:null,eb=cb.obj.other_user_fbids.length?cb.obj.other_user_fbids[0]:null,fb={action_type:i.DELETE_MESSAGES,action_id:null,thread_fbid:db,other_user_fbid:eb,message_ids:cb.obj.mids};u.handleUpdate({actions:[fb],threads:[cb.obj.updated_thread],payload_source:l.CLIENT_CHANNEL_MESSAGE});}function ia(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj||!cb.obj.folder)return;var db={action_type:k.MARK_ALL_READ,action_id:cb.obj.action_id,folder:cb.obj.folder};u.handleUpdate({global_actions:[db]});}function ja(bb,cb){if(j.MercuryFBIDGK){la(bb,cb);}else ka(bb,cb);}function ka(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj.tids)return;var db=l.CLIENT_CHANNEL_MESSAGE;(cb.obj.tids||[]).forEach(function(eb){var fb={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:eb,archived:cb.obj.state};u.handleUpdateWaitForThread({actions:[s({},fb)],payload_source:db},eb);});}function la(bb,cb){if(bb!=h.getArbiterType('messaging')||(!cb.obj.thread_fbids&&!cb.obj.other_user_fbids))return;var db=l.CLIENT_CHANNEL_MESSAGE;(cb.obj.thread_fbids||[]).forEach(function(eb){var fb={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:eb,other_user_fbid:null,archived:cb.obj.state};u.handleUpdateWaitForThread({actions:[s({},fb)],payload_source:db},eb);});(cb.obj.other_user_fbids||[]).forEach(function(eb){var fb={action_type:i.CHANGE_ARCHIVED_STATUS,action_id:null,thread_fbid:null,other_user_fbid:eb,archived:cb.obj.state};u.handleUpdateWaitForThread({actions:[s({},fb)],payload_source:db},eb);});}function ma(bb,cb){if(j.MercuryFBIDGK){oa(bb,cb);}else na(bb,cb);}function na(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj.tids)return;var db=l.CLIENT_CHANNEL_MESSAGE,eb;(cb.obj.tids||[]).forEach(function(fb){if(cb.obj.event==o.TAG){eb=cb.obj.tag;}else eb=cb.obj.marked_as_spam?p.SPAM:p.INBOX;var gb={action_type:i.CHANGE_FOLDER,action_id:null,thread_id:fb,new_folder:eb};u.handleUpdateWaitForThread({actions:[s({},gb)],payload_source:db},fb);});}function oa(bb,cb){if(bb!=h.getArbiterType('messaging')||(!cb.obj.thread_fbids&&!cb.obj.other_user_fbids))return;var db=l.CLIENT_CHANNEL_MESSAGE,eb;(cb.obj.thread_fbids||[]).forEach(function(fb){if(cb.obj.event==o.TAG){eb=cb.obj.tag;}else eb=cb.obj.marked_as_spam?p.SPAM:p.INBOX;var gb={action_type:i.CHANGE_FOLDER,action_id:null,thread_fbid:fb,other_user_fbid:null,new_folder:eb};u.handleUpdateWaitForThread({actions:[s({},gb)],payload_source:db},fb);});(cb.obj.other_user_fbids||[]).forEach(function(fb){if(cb.obj.event==o.TAG){eb=cb.obj.tag;}else eb=cb.obj.marked_as_spam?p.SPAM:p.INBOX;var gb={action_type:i.CHANGE_FOLDER,action_id:null,other_user_fbid:fb,thread_fbid:null,new_folder:eb};u.handleUpdateWaitForThread({actions:[s({},gb)],payload_source:db},fb);});}function pa(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj.tag)return;switch(cb.obj.tag){case p.ACTION_ARCHIVED:ja(bb,cb);break;case p.INBOX:case p.OTHER:ma(bb,cb);break;}}function qa(bb,cb){if(j.MercuryFBIDGK){sa(bb,cb);}else ra(bb,cb);}function ra(bb,cb){if(bb!=h.getArbiterType('inbox')||!cb.obj||!cb.obj.seen_timestamp)return;u.handleUpdate({message_counts:[{seen_timestamp:cb.obj.seen_timestamp,folder:p.INBOX}],unseen_thread_ids:[{thread_ids:[],folder:p.INBOX}],payload_source:l.CLIENT_CHANNEL_MESSAGE});}function sa(bb,cb){if(bb!=h.getArbiterType('inbox')||!cb.obj||!cb.obj.seen_timestamp)return;u.handleUpdate({message_counts:[{seen_timestamp:cb.obj.seen_timestamp,folder:p.INBOX}],unseen_thread_fbids:[{thread_fbids:[],other_user_fbids:[],folder:p.INBOX}],payload_source:l.CLIENT_CHANNEL_MESSAGE});}function ta(bb,cb){if(bb!=h.getArbiterType('mercury')||!cb.obj)return;v.synchronizeInforms(function(){var db=cb.obj,eb=[];(db.actions||[]).forEach(function(fb){var gb=i.USER_GENERATED_MESSAGE;if(fb.action_type==i.LOG_MESSAGE){var hb=l.CLIENT_CHANNEL_MESSAGE,ib;if(j.MercuryFBIDGK){ib=fb.other_user_fbid||fb.thread_fbid;}else ib=fb.thread_id;u.handleUpdateWaitForThread({actions:[s({},fb)],payload_source:hb},ib);}else if(fb.action_type!=gb)eb.push(fb);});db.actions=eb;db.payload_source=l.CLIENT_CHANNEL_MESSAGE;u.handleUpdate(db);});}function ua(bb,cb){u.handleRoger(cb.obj);}function va(bb,cb){if(j.MercuryFBIDGK){xa(bb,cb);}else wa(bb,cb);}function wa(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj||cb.obj.mute_settings===undefined||!cb.obj.thread_id)return;var db=i.CHANGE_MUTE_SETTINGS,eb=[{action_type:db,action_id:null,thread_id:cb.obj.thread_id,mute_settings:cb.obj.mute_settings}];u.handleUpdate({actions:eb,payload_source:l.CLIENT_CHANNEL_MESSAGE});}function xa(bb,cb){if(bb!=h.getArbiterType('messaging')||!cb.obj||cb.obj.mute_settings===undefined||(!cb.obj.thread_fbid&&!cb.obj.other_user_fbid))return;var db=i.CHANGE_MUTE_SETTINGS,eb=[{action_type:db,action_id:null,thread_fbid:cb.obj.thread_fbid,other_user_fbid:cb.obj.other_user_fbid,mute_settings:cb.obj.mute_settings}];u.handleUpdate({actions:eb,payload_source:l.CLIENT_CHANNEL_MESSAGE});}function ya(bb,cb){switch(cb.obj.event){case o.DELIVER:w(bb,cb);break;case o.READ:case o.UNREAD:z(bb,cb);break;case o.READ_ALL:ia(bb,cb);break;case o.DELETE:ca(bb,cb);break;case o.DELETE_MESSAGES:fa(bb,cb);break;case o.TAG:pa(bb,cb);break;case o.REPORT_SPAM:ma(bb,cb);break;case o.READ_RECEIPT:ua(bb,cb);break;case o.CHANGE_MUTE_SETTINGS:va(bb,cb);break;}}var za=[],ab={turnOn:function(){if(!za.length){var bb={mercury:ta,messaging:ya,inbox:qa};for(var cb in bb)za.push(g.subscribe(h.getArbiterType(cb),bb[cb]));}},turnOff:function(){if(za.length){za.forEach(g.unsubscribe);za=[];}}};ab.turnOn();e.exports=ab;},null);
__d("MercuryStateCheck",["Arbiter","ChannelConstants","MercuryFolders","MessagingTag","URI","copyProperties","MercuryServerRequests"],function(a,b,c,d,e,f,g,h,i,j,k,l){var m=b('MercuryServerRequests').get(),n=l(new g(),{initialize:function(){g.subscribe(h.ON_INVALID_HISTORY,o);d(['ChannelConnection'],function(p){p.subscribe(p.CONNECTED,function(q,r){if(!r.init)o();});});}});function o(){var p;if(k.getRequestURI().getPath().search(/messages/)!==-1){p=i.getSupportedFolders();}else p=[j.INBOX];m.fetchMissedMessages(p);}n.initialize();e.exports=n;},null);
__d("ChatApp",["CSS","JSLogger"],function(a,b,c,d,e,f,g,h){var i={init:function(j,k,l){if(this._isInitialized){h.create('chat_app').error('repeated_init');return;}this._rootElem=j;d(['TabsViewport','ChatTabController','ChatTabViewCoordinator','MercuryServerRequests','MercuryChannelHandler','MercuryStateCheck'],function(m,n,o,p,q,r){p.get().handleUpdate(l);this.tabsViewport=new m(k);this.tabViewCoordinator=new o(k,this.tabsViewport);this.tabController=new n(this.tabsViewport,this.tabViewCoordinator);this._isInitialized=this._isLoaded=true;}.bind(this));},isInitialized:function(){return !!this._isInitialized;},isHidden:function(){return !this._isInitialized||this._isHidden;},hide:function(){if(this.isHidden())return;g.hide(this._rootElem);this._isHidden=true;},unhide:function(){if(this._isInitialized){if(this._isHidden){g.show(this._rootElem);this.tabsViewport.checkWidth();d(['Dock'],function(j){j.resizeAllFlyouts();});this._isHidden=false;}}else if(!this._isLoaded){d(['UIPagelet'],function(j){j.loadFromEndpoint('ChatTabsPagelet','ChatTabsPagelet');j.loadFromEndpoint('BuddylistPagelet','BuddylistPagelet');});this._isLoaded=true;}}};e.exports=i;},null);
__d("ChatTypeaheadConstants",[],function(a,b,c,d,e,f){var g={USER_TYPE:'user',THREAD_TYPE:'thread',FRIEND_TYPE:'friend',NON_FRIEND_TYPE:'non_friend',FB4C_TYPE:'fb4c',HEADER_TYPE:'header'};e.exports=g;},null);
__d("ChatTypeaheadBehavior",["ChatOpenTab","CSS","MercuryConfig","Parent","Rect","copyProperties","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(p,q){var r=j.byClass(p,"_4oes");if(r)h.conditionClass(r,"_5q83",q);}function o(p){"use strict";this._typeahead=p;}o.prototype.enable=function(){"use strict";var p=this._typeahead;this._subscriptions=[p.subscribe('focus',function(){p.getData().refreshData();n(p.getElement(),true);}),p.subscribe('blur',function(q){p.getCore().reset();n(p.getElement(),false);}),p.subscribe('respond',function(q,r){if(r.value&&r.value===p.getCore().getValue()){if(!r.results.length){var s=r.value.toLowerCase(),t=p.getData().getQueryCache();if(!r.isAsync&&!t.hasOwnProperty(s))return;p.getView().showNoResults();}h.addClass(p.getElement(),'hasValue');}}),p.subscribe('reset',function(){h.removeClass(p.getElement(),'hasValue');}),p.subscribe('select',function(q,r){var s=r.selected.uid;if(i.MercuryFBIDGK&&r.selected.mercury_thread&&!r.selected.mercury_thread.is_canonical)s=r.selected.mercury_thread.thread_fbid;p.getView().hide();g.openTabByType(s,r.selected.type,'typeahead');}),p.subscribe('highlight',function(q,r){if(r.index>=0){var s=p.getView().getItems()[r.index];if(s){var t=new k(s),u=s.offsetParent,v=t.boundWithin(new k(u)).getPositionVector();t.getPositionVector().sub(v).scrollElementBy(u);}}})];};o.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(p){this._typeahead.unsubscribe(p);},this);this._subscriptions=null;};l(o.prototype,{_subscriptions:null});e.exports=o;},null);
__d("DropdownContextualHelpLink",["DOM","ge"],function(a,b,c,d,e,f,g,h){var i={set:function(j){var k=h('navHelpCenter');if(k!==null)g.replace(k,j);}};e.exports=i;},null);